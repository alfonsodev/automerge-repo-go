var Uu=Object.defineProperty;var Di=re=>{throw TypeError(re)};var Pu=(re,X,ie)=>X in re?Uu(re,X,{enumerable:!0,configurable:!0,writable:!0,value:ie}):re[X]=ie;var Z=(re,X,ie)=>Pu(re,typeof X!="symbol"?X+"":X,ie),Es=(re,X,ie)=>X.has(re)||Di("Cannot "+ie);var h=(re,X,ie)=>(Es(re,X,"read from private field"),ie?ie.call(re):X.get(re)),z=(re,X,ie)=>X.has(re)?Di("Cannot add the same private member more than once"):X instanceof WeakSet?X.add(re):X.set(re,ie),te=(re,X,ie,Je)=>(Es(re,X,"write to private field"),Je?Je.call(re,ie):X.set(re,ie),ie),V=(re,X,ie)=>(Es(re,X,"access private method"),ie);var Li=(re,X,ie,Je)=>({set _(Wt){te(re,X,Wt,ie)},get _(){return h(re,X,Je)}});let Du=(async()=>{var Cn,le,De,On,St,nn,Hn,ue,_t,Ti,Mi,wr,Bi,ot,He,Le,it,It,at,Ft,ks,Fi,ze,mt,lr,gr,rn,be,At,ct,sn,$t,ht,$i,Vi,Ni,zi,ut,Ie,Vt,me,on,an,pr,cn,se,jn,q,Wi,Ji,Gi,_r,Ki,qi,vr,xr,Cs,zt,Os,Et,hn,Rn,dt,Hs,Yi,js,Te,un,Nt,we,Me,Ye,kt,ce,Ln,Qi,Un,Zi,Ct,Xi,ea,dn,Pn,yr,Dn,Rs,wt,je;const re=""+new URL("automerge.wasm",import.meta.url).href,X=Symbol.for("_am_meta"),ie=Symbol.for("_am_trace"),Je=Symbol.for("_am_objectId"),Wt=Symbol.for("_am_isProxy"),Us=Symbol.for("_am_clearCache"),ta=Symbol.for("_am_uint"),na=Symbol.for("_am_int"),ra=Symbol.for("_am_f64"),Ps=Symbol.for("_am_counter"),Ds=Symbol.for("_am_immutableString");class Sr{constructor(t){this.value=t||0,Reflect.defineProperty(this,Ps,{value:!0})}valueOf(){return this.value}toString(){return this.valueOf().toString()}toJSON(){return this.value}increment(t){throw new Error("Counters should not be incremented outside of a change callback")}decrement(t){throw new Error("Counters should not be decremented outside of a change callback")}}class sa extends Sr{constructor(t,e,r,s,o){super(t),this.context=e,this.path=r,this.objectId=s,this.key=o}increment(t){return t=typeof t=="number"?t:1,this.context.increment(this.objectId,this.key,t),this.value+=t,this.value}decrement(t){return this.increment(typeof t=="number"?-t:-1)}}function oa(n,t,e,r,s){return new sa(n,t,e,r,s)}var Ls;class Ts{constructor(t){this[Ls]=!0,this.val=t}toString(){return this.val}toJSON(){return this.val}}Ls=Ds;function Ze(n){if(typeof n=="string"&&/^[0-9]+$/.test(n)&&(n=parseInt(n,10)),typeof n!="number")return n;if(n<0||isNaN(n)||n===1/0||n===-1/0)throw new RangeError("A list index must be positive, but you passed "+n);return n}function Ee(n,t){const{context:e,objectId:r,path:s}=n,o=e.getWithType(r,t);if(o===null)return;const i=o[0],a=o[1];switch(i){case void 0:return;case"map":return ln(e,a,[...s,t]);case"list":return Bn(e,a,[...s,t]);case"text":return e.text(a);case"str":return new Ts(a);case"uint":return a;case"int":return a;case"f64":return a;case"boolean":return a;case"null":return null;case"bytes":return a;case"timestamp":return a;case"counter":return oa(a,e,s,r,t);default:throw RangeError(`datatype ${i} unimplemented`)}}function Tn(n,t,e){const r=typeof n;switch(r){case"object":if(n==null)return[null,"null"];if(n[ta])return[n.value,"uint"];if(n[na])return[n.value,"int"];if(n[ra])return[n.value,"f64"];if(n[Ps])return[n.value,"counter"];if(n instanceof Date)return[n.getTime(),"timestamp"];if(Fs(n))return[n.toString(),"str"];if(n instanceof Uint8Array)return[n,"bytes"];if(n instanceof Array)return[n,"list"];if(Object.prototype.toString.call(n)==="[object Object]")return[n,"map"];throw Mn(n,e)?new RangeError("Cannot create a reference to an existing document object"):new RangeError(`Cannot assign unknown object: ${n}`);case"boolean":return[n,"boolean"];case"number":return Number.isInteger(n)?[n,"int"]:[n,"f64"];case"string":return[n,"text"];case"undefined":throw new RangeError([`Cannot assign undefined value at ${Bs(t)}, `,"because `undefined` is not a valid JSON data type. ","You might consider setting the property's value to `null`, ","or using `delete` to remove it altogether."].join(""));default:throw new RangeError([`Cannot assign ${r} value at ${Bs(t)}. `,"All JSON primitive datatypes (object, array, string, number, boolean, null) ",`are supported in an Automerge document; ${r} values are not. `].join(""))}}function Mn(n,t){var e,r;return n instanceof Date?!1:!!(n&&((r=(e=n[X])===null||e===void 0?void 0:e.handle)===null||r===void 0?void 0:r.__wbg_ptr)===t.__wbg_ptr)}const ia={get(n,t){const{context:e,objectId:r,cache:s}=n;return t===Symbol.toStringTag?n[Symbol.toStringTag]:t===Je?r:t===Wt?!0:t===ie?n.trace:t===X?{handle:e}:(s[t]||(s[t]=Ee(n,t)),s[t])},set(n,t,e){const{context:r,objectId:s,path:o}=n;if(n.cache={},Mn(e,r))throw new RangeError("Cannot create a reference to an existing document object");if(t===ie)return n.trace=e,!0;if(t===Us)return!0;const[i,a]=Tn(e,[...o,t],r);switch(a){case"list":{const c=r.putObject(s,t,[]),d=Bn(r,c,[...o,t]);for(let l=0;l<i.length;l++)d[l]=i[l];break}case"text":{r.putObject(s,t,i);break}case"map":{const c=r.putObject(s,t,{}),d=ln(r,c,[...o,t]);for(const l in i)d[l]=i[l];break}default:r.put(s,t,i,a)}return!0},deleteProperty(n,t){const{context:e,objectId:r}=n;return n.cache={},e.delete(r,t),!0},has(n,t){return this.get(n,t)!==void 0},getOwnPropertyDescriptor(n,t){const e=this.get(n,t);if(typeof e<"u")return{configurable:!0,enumerable:!0,value:e}},ownKeys(n){const{context:t,objectId:e}=n,r=t.keys(e);return[...new Set(r)]}},Ms={get(n,t){const{context:e,objectId:r}=n;return t=Ze(t),t===Symbol.hasInstance?s=>Array.isArray(s):t===Symbol.toStringTag?n[Symbol.toStringTag]:t===Je?r:t===Wt?!0:t===ie?n.trace:t===X?{handle:e}:t==="length"?e.length(r):typeof t=="number"?Ee(n,t):Ir(n)[t]},set(n,t,e){const{context:r,objectId:s,path:o}=n;if(t=Ze(t),Mn(e,r))throw new RangeError("Cannot create a reference to an existing document object");if(t===Us)return!0;if(t===ie)return n.trace=e,!0;if(typeof t=="string")throw new RangeError("list index must be a number");const[i,a]=Tn(e,[...o,t],r);switch(a){case"list":{let c;t>=r.length(s)?c=r.insertObject(s,t,[]):c=r.putObject(s,t,[]),Bn(r,c,[...o,t]).splice(0,0,...i);break}case"text":{t>=r.length(s)?r.insertObject(s,t,i):r.putObject(s,t,i);break}case"map":{let c;t>=r.length(s)?c=r.insertObject(s,t,{}):c=r.putObject(s,t,{});const d=ln(r,c,[...o,t]);for(const l in i)d[l]=i[l];break}default:t>=r.length(s)?r.insert(s,t,i,a):r.put(s,t,i,a)}return!0},deleteProperty(n,t){const{context:e,objectId:r}=n;t=Ze(t);const s=e.get(r,t);if(s!=null&&s[0]=="counter")throw new TypeError("Unsupported operation: deleting a counter from a list");return e.delete(r,t),!0},has(n,t){const{context:e,objectId:r}=n;return t=Ze(t),typeof t=="number"?t<e.length(r):t==="length"},getOwnPropertyDescriptor(n,t){const{context:e,objectId:r}=n;return t==="length"?{writable:!0,value:e.length(r)}:t===Je?{configurable:!1,enumerable:!1,value:r}:(t=Ze(t),{configurable:!0,enumerable:!0,value:Ee(n,t)})},getPrototypeOf(n){return Object.getPrototypeOf(n)},ownKeys(){const n=[];return n.push("length"),n}};Object.assign({},Ms,{get(n,t){const{context:e,objectId:r}=n;return t=Ze(t),t===Symbol.hasInstance?s=>Array.isArray(s):t===Symbol.toStringTag?n[Symbol.toStringTag]:t===Je?r:t===Wt?!0:t===ie?n.trace:t===X?{handle:e}:t==="length"?e.length(r):typeof t=="number"?Ee(n,t):ca(n)[t]||Ir(n)[t]},getPrototypeOf(){return Object.getPrototypeOf(new Text)}});function ln(n,t,e){const r={context:n,objectId:t,path:e||[],cache:{}},s={};return Object.assign(s,r),new Proxy(s,ia)}function Bn(n,t,e){const r={context:n,objectId:t,path:e||[],cache:{}},s=[];return Object.assign(s,r),new Proxy(s,Ms)}function aa(n){return ln(n,"_root",[])}function Ir(n){const{context:t,objectId:e,path:r}=n;return{at(s){return Ee(n,s)},deleteAt(s,o){return typeof o=="number"?t.splice(e,s,o):t.delete(e,s),this},fill(s,o,i){const[a,c]=Tn(s,[...r,o],t),d=t.length(e);o=Ze(o||0),i=Ze(i||d);for(let l=o;l<Math.min(i,d);l++)c==="list"||c==="map"||c==="text"?t.putObject(e,l,a):t.put(e,l,a,c);return this},indexOf(s,o=0){const i=t.length(e);for(let a=o;a<i;a++){const c=t.getWithType(e,a);if(!c)continue;const[d,l]=c;if(!["map","list","text"].includes(d)){if(l===s)return a;continue}if(d==="text"&&typeof s=="string"&&s===Ee(n,a)||s[Je]===l)return a}return-1},insertAt(s,...o){return this.splice(s,0,...o),this},pop(){const s=t.length(e);if(s==0)return;const o=Ee(n,s-1);return t.delete(e,s-1),o},push(...s){const o=t.length(e);return this.splice(o,0,...s),t.length(e)},shift(){if(t.length(e)==0)return;const s=Ee(n,0);return t.delete(e,0),s},splice(s,o,...i){s=Ze(s),typeof o!="number"&&(o=t.length(e)-s),o=Ze(o);for(const d of i)if(Mn(d,t))throw new RangeError("Cannot create a reference to an existing document object");const a=[];for(let d=0;d<o;d++){const l=Ee(n,s);l!==void 0&&a.push(l),t.delete(e,s)}const c=i.map((d,l)=>{try{return Tn(d,[...r],t)}catch(g){throw g instanceof RangeError?new RangeError(`${g.message} (at index ${l} in the input)`):g}});for(const[d,l]of c){switch(l){case"list":{const g=t.insertObject(e,s,[]);Bn(t,g,[...r,s]).splice(0,0,...d);break}case"text":{t.insertObject(e,s,d);break}case"map":{const g=t.insertObject(e,s,{}),f=ln(t,g,[...r,s]);for(const u in d)f[u]=d[u];break}default:t.insert(e,s,d,l)}s+=1}return a},unshift(...s){return this.splice(0,0,...s),t.length(e)},entries(){let s=0;return{next:()=>{const o=Ee(n,s);return o===void 0?{value:void 0,done:!0}:{value:[s++,o],done:!1}},[Symbol.iterator](){return this}}},keys(){let s=0;const o=t.length(e);return{next:()=>s<o?{value:s++,done:!1}:{value:void 0,done:!0},[Symbol.iterator](){return this}}},values(){let s=0;return{next:()=>{const o=Ee(n,s++);return o===void 0?{value:void 0,done:!0}:{value:o,done:!1}},[Symbol.iterator](){return this}}},toArray(){const s=[];let o;do o=Ee(n,s.length),o!==void 0&&s.push(o);while(o!==void 0);return s},map(s){return this.toArray().map(s)},toString(){return this.toArray().toString()},toLocaleString(){return this.toArray().toLocaleString()},forEach(s){return this.toArray().forEach(s)},concat(s){return this.toArray().concat(s)},every(s){return this.toArray().every(s)},filter(s){return this.toArray().filter(s)},find(s){let o=0;for(const i of this){if(s(i,o))return i;o+=1}},findIndex(s){let o=0;for(const i of this){if(s(i,o))return o;o+=1}return-1},includes(s){return this.find(o=>o===s)!==void 0},join(s){return this.toArray().join(s)},reduce(s,o){return this.toArray().reduce(s,o)},reduceRight(s,o){return this.toArray().reduceRight(s,o)},lastIndexOf(s,o=1/0){return this.toArray().lastIndexOf(s,o)},slice(s,o){return this.toArray().slice(s,o)},some(s){let o=0;for(const i of this){if(s(i,o))return!0;o+=1}return!1},[Symbol.iterator]:function*(){let s=0,o=Ee(n,s);for(;o!==void 0;)yield o,s+=1,o=Ee(n,s)}}}function ca(n){const{context:t,objectId:e}=n;return{set(r,s){return this[r]=s},get(r){return this[r]},toString(){return t.text(e).replace(/ï¿¼/g,"")},toSpans(){const r=[];let s="";const o=t.length(e);for(let i=0;i<o;i++){const a=this[i];typeof a=="string"?s+=a:(s.length>0&&(r.push(s),s=""),r.push(a))}return s.length>0&&r.push(s),r},toJSON(){return this.toString()},indexOf(r,s=0){return t.text(e).indexOf(r,s)},insertAt(r,...s){s.every(o=>typeof o=="string")?t.splice(e,r,0,s.join("")):Ir(n).insertAt(r,...s)}}}function Bs(n){const t=n.map(e=>{if(typeof e=="number")return e.toString();if(typeof e=="string")return e.replace(/~/g,"~0").replace(/\//g,"~1")});return n.length===0?"":"/"+t.join("/")}function Fs(n){return typeof n=="object"&&n!==null&&Object.prototype.hasOwnProperty.call(n,Ds)}let v,Be=0,gn=null;function Fn(){return(gn===null||gn.byteLength===0)&&(gn=new Uint8Array(v.memory.buffer)),gn}const $n=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ha=typeof $n.encodeInto=="function"?function(n,t){return $n.encodeInto(n,t)}:function(n,t){const e=$n.encode(n);return t.set(e),{read:n.length,written:e.length}};function Xe(n,t,e){if(e===void 0){const a=$n.encode(n),c=t(a.length,1)>>>0;return Fn().subarray(c,c+a.length).set(a),Be=a.length,c}let r=n.length,s=t(r,1)>>>0;const o=Fn();let i=0;for(;i<r;i++){const a=n.charCodeAt(i);if(a>127)break;o[s+i]=a}if(i!==r){i!==0&&(n=n.slice(i)),s=e(s,r,r=i+n.length*3,1)>>>0;const a=Fn().subarray(s+i,s+r),c=ha(n,a);i+=c.written,s=e(s,r,i,1)>>>0}return Be=i,s}let Ot=null;function Fe(){return(Ot===null||Ot.buffer.detached===!0||Ot.buffer.detached===void 0&&Ot.buffer!==v.memory.buffer)&&(Ot=new DataView(v.memory.buffer)),Ot}function de(n){const t=v.__externref_table_alloc();return v.__wbindgen_export_4.set(t,n),t}function Ge(n,t){try{return n.apply(this,t)}catch(e){const r=de(e);v.__wbindgen_exn_store(r)}}const $s=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&$s.decode();function Re(n,t){return n=n>>>0,$s.decode(Fn().subarray(n,n+t))}function ee(n){return n==null}function Ar(n){const t=typeof n;if(t=="number"||t=="boolean"||n==null)return`${n}`;if(t=="string")return`"${n}"`;if(t=="symbol"){const s=n.description;return s==null?"Symbol":`Symbol(${s})`}if(t=="function"){const s=n.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(n)){const s=n.length;let o="[";s>0&&(o+=Ar(n[0]));for(let i=1;i<s;i++)o+=", "+Ar(n[i]);return o+="]",o}const e=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(e&&e.length>1)r=e[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function U(n){const t=v.__wbindgen_export_4.get(n);return v.__externref_table_dealloc(n),t}function Ht(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`)}function ua(n){const t=v.create(n);if(t[2])throw U(t[1]);return et.__wrap(t[0])}function da(n,t){const e=v.load(n,t);if(e[2])throw U(e[1]);return et.__wrap(e[0])}function fa(n){const t=v.encodeChange(n);if(t[2])throw U(t[1]);return U(t[0])}function la(n){const t=v.decodeChange(n);if(t[2])throw U(t[1]);return U(t[0])}function ga(){const n=v.initSyncState();return $e.__wrap(n)}function pa(n){const t=v.importSyncState(n);if(t[2])throw U(t[1]);return $e.__wrap(t[0])}function ya(n){return Ht(n,$e),v.exportSyncState(n.__wbg_ptr)}function ba(n){const t=v.encodeSyncMessage(n);if(t[2])throw U(t[1]);return U(t[0])}function ma(n){const t=v.decodeSyncMessage(n);if(t[2])throw U(t[1]);return U(t[0])}function wa(n){return Ht(n,$e),v.encodeSyncState(n.__wbg_ptr)}function _a(n){const t=v.decodeSyncState(n);if(t[2])throw U(t[1]);return $e.__wrap(t[0])}const Vs=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>v.__wbg_automerge_free(n>>>0,1));class et{static __wrap(t){t=t>>>0;const e=Object.create(et.prototype);return e.__wbg_ptr=t,Vs.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,Vs.unregister(this),t}free(){const t=this.__destroy_into_raw();v.__wbg_automerge_free(t,0)}static new(t){var e=ee(t)?0:Xe(t,v.__wbindgen_malloc,v.__wbindgen_realloc),r=Be;const s=v.automerge_new(e,r);if(s[2])throw U(s[1]);return et.__wrap(s[0])}clone(t){var e=ee(t)?0:Xe(t,v.__wbindgen_malloc,v.__wbindgen_realloc),r=Be;const s=v.automerge_clone(this.__wbg_ptr,e,r);if(s[2])throw U(s[1]);return et.__wrap(s[0])}fork(t,e){var r=ee(t)?0:Xe(t,v.__wbindgen_malloc,v.__wbindgen_realloc),s=Be;const o=v.automerge_fork(this.__wbg_ptr,r,s,e);if(o[2])throw U(o[1]);return et.__wrap(o[0])}pendingOps(){return v.automerge_pendingOps(this.__wbg_ptr)}commit(t,e){var r=ee(t)?0:Xe(t,v.__wbindgen_malloc,v.__wbindgen_realloc),s=Be;return v.automerge_commit(this.__wbg_ptr,r,s,!ee(e),ee(e)?0:e)}merge(t){Ht(t,et);const e=v.automerge_merge(this.__wbg_ptr,t.__wbg_ptr);if(e[2])throw U(e[1]);return U(e[0])}rollback(){return v.automerge_rollback(this.__wbg_ptr)}keys(t,e){const r=v.automerge_keys(this.__wbg_ptr,t,ee(e)?0:de(e));if(r[2])throw U(r[1]);return U(r[0])}text(t,e){let r,s;try{const a=v.automerge_text(this.__wbg_ptr,t,ee(e)?0:de(e));var o=a[0],i=a[1];if(a[3])throw o=0,i=0,U(a[2]);return r=o,s=i,Re(o,i)}finally{v.__wbindgen_free(r,s,1)}}spans(t,e){const r=v.automerge_spans(this.__wbg_ptr,t,ee(e)?0:de(e));if(r[2])throw U(r[1]);return U(r[0])}splice(t,e,r,s){const o=v.automerge_splice(this.__wbg_ptr,t,e,r,s);if(o[1])throw U(o[0])}updateText(t,e){const r=v.automerge_updateText(this.__wbg_ptr,t,e);if(r[1])throw U(r[0])}updateSpans(t,e){const r=v.automerge_updateSpans(this.__wbg_ptr,t,e);if(r[1])throw U(r[0])}push(t,e,r){const s=v.automerge_push(this.__wbg_ptr,t,e,r);if(s[1])throw U(s[0])}pushObject(t,e){let r,s;try{const a=v.automerge_pushObject(this.__wbg_ptr,t,e);var o=a[0],i=a[1];if(a[3])throw o=0,i=0,U(a[2]);return r=o,s=i,Re(o,i)}finally{v.__wbindgen_free(r,s,1)}}insert(t,e,r,s){const o=v.automerge_insert(this.__wbg_ptr,t,e,r,s);if(o[1])throw U(o[0])}splitBlock(t,e,r){const s=v.automerge_splitBlock(this.__wbg_ptr,t,e,r);if(s[1])throw U(s[0])}joinBlock(t,e){const r=v.automerge_joinBlock(this.__wbg_ptr,t,e);if(r[1])throw U(r[0])}updateBlock(t,e,r){const s=v.automerge_updateBlock(this.__wbg_ptr,t,e,r);if(s[1])throw U(s[0])}getBlock(t,e,r){const s=v.automerge_getBlock(this.__wbg_ptr,t,e,ee(r)?0:de(r));if(s[2])throw U(s[1]);return U(s[0])}insertObject(t,e,r){let s,o;try{const c=v.automerge_insertObject(this.__wbg_ptr,t,e,r);var i=c[0],a=c[1];if(c[3])throw i=0,a=0,U(c[2]);return s=i,o=a,Re(i,a)}finally{v.__wbindgen_free(s,o,1)}}put(t,e,r,s){const o=v.automerge_put(this.__wbg_ptr,t,e,r,s);if(o[1])throw U(o[0])}putObject(t,e,r){const s=v.automerge_putObject(this.__wbg_ptr,t,e,r);if(s[2])throw U(s[1]);return U(s[0])}increment(t,e,r){const s=v.automerge_increment(this.__wbg_ptr,t,e,r);if(s[1])throw U(s[0])}get(t,e,r){const s=v.automerge_get(this.__wbg_ptr,t,e,ee(r)?0:de(r));if(s[2])throw U(s[1]);return U(s[0])}getWithType(t,e,r){const s=v.automerge_getWithType(this.__wbg_ptr,t,e,ee(r)?0:de(r));if(s[2])throw U(s[1]);return U(s[0])}objInfo(t,e){const r=v.automerge_objInfo(this.__wbg_ptr,t,ee(e)?0:de(e));if(r[2])throw U(r[1]);return U(r[0])}getAll(t,e,r){const s=v.automerge_getAll(this.__wbg_ptr,t,e,ee(r)?0:de(r));if(s[2])throw U(s[1]);return U(s[0])}enableFreeze(t){const e=v.automerge_enableFreeze(this.__wbg_ptr,t);if(e[2])throw U(e[1]);return e[0]!==0}registerDatatype(t,e,r){const s=v.automerge_registerDatatype(this.__wbg_ptr,t,e,r);if(s[1])throw U(s[0])}applyPatches(t,e){const r=v.automerge_applyPatches(this.__wbg_ptr,t,e);if(r[2])throw U(r[1]);return U(r[0])}applyAndReturnPatches(t,e){const r=v.automerge_applyAndReturnPatches(this.__wbg_ptr,t,e);if(r[2])throw U(r[1]);return U(r[0])}diffIncremental(){const t=v.automerge_diffIncremental(this.__wbg_ptr);if(t[2])throw U(t[1]);return U(t[0])}updateDiffCursor(){v.automerge_updateDiffCursor(this.__wbg_ptr)}resetDiffCursor(){v.automerge_resetDiffCursor(this.__wbg_ptr)}diff(t,e){const r=v.automerge_diff(this.__wbg_ptr,t,e);if(r[2])throw U(r[1]);return U(r[0])}isolate(t){const e=v.automerge_isolate(this.__wbg_ptr,t);if(e[1])throw U(e[0])}integrate(){v.automerge_integrate(this.__wbg_ptr)}length(t,e){const r=v.automerge_length(this.__wbg_ptr,t,ee(e)?0:de(e));if(r[2])throw U(r[1]);return r[0]}delete(t,e){const r=v.automerge_delete(this.__wbg_ptr,t,e);if(r[1])throw U(r[0])}save(){return v.automerge_save(this.__wbg_ptr)}saveIncremental(){return v.automerge_saveIncremental(this.__wbg_ptr)}saveSince(t){const e=v.automerge_saveSince(this.__wbg_ptr,t);if(e[2])throw U(e[1]);return U(e[0])}saveNoCompress(){return v.automerge_saveNoCompress(this.__wbg_ptr)}saveAndVerify(){const t=v.automerge_saveAndVerify(this.__wbg_ptr);if(t[2])throw U(t[1]);return U(t[0])}loadIncremental(t){const e=v.automerge_loadIncremental(this.__wbg_ptr,t);if(e[2])throw U(e[1]);return e[0]}applyChanges(t){const e=v.automerge_applyChanges(this.__wbg_ptr,t);if(e[1])throw U(e[0])}getChanges(t){const e=v.automerge_getChanges(this.__wbg_ptr,t);if(e[2])throw U(e[1]);return U(e[0])}getChangesMeta(t){const e=v.automerge_getChangesMeta(this.__wbg_ptr,t);if(e[2])throw U(e[1]);return U(e[0])}getChangeByHash(t){const e=v.automerge_getChangeByHash(this.__wbg_ptr,t);if(e[2])throw U(e[1]);return U(e[0])}getChangeMetaByHash(t){const e=v.automerge_getChangeMetaByHash(this.__wbg_ptr,t);if(e[2])throw U(e[1]);return U(e[0])}getDecodedChangeByHash(t){const e=v.automerge_getDecodedChangeByHash(this.__wbg_ptr,t);if(e[2])throw U(e[1]);return U(e[0])}getChangesAdded(t){return Ht(t,et),v.automerge_getChangesAdded(this.__wbg_ptr,t.__wbg_ptr)}getHeads(){return v.automerge_getHeads(this.__wbg_ptr)}getActorId(){let t,e;try{const r=v.automerge_getActorId(this.__wbg_ptr);return t=r[0],e=r[1],Re(r[0],r[1])}finally{v.__wbindgen_free(t,e,1)}}getLastLocalChange(){return v.automerge_getLastLocalChange(this.__wbg_ptr)}dump(){v.automerge_dump(this.__wbg_ptr)}getMissingDeps(t){const e=v.automerge_getMissingDeps(this.__wbg_ptr,ee(t)?0:de(t));if(e[2])throw U(e[1]);return U(e[0])}receiveSyncMessage(t,e){Ht(t,$e);const r=v.automerge_receiveSyncMessage(this.__wbg_ptr,t.__wbg_ptr,e);if(r[1])throw U(r[0])}generateSyncMessage(t){return Ht(t,$e),v.automerge_generateSyncMessage(this.__wbg_ptr,t.__wbg_ptr)}toJS(t){const e=v.automerge_toJS(this.__wbg_ptr,t);if(e[2])throw U(e[1]);return U(e[0])}materialize(t,e,r){const s=v.automerge_materialize(this.__wbg_ptr,t,ee(e)?0:de(e),r);if(s[2])throw U(s[1]);return U(s[0])}getCursor(t,e,r,s){let o,i;try{const d=v.automerge_getCursor(this.__wbg_ptr,t,e,ee(r)?0:de(r),s);var a=d[0],c=d[1];if(d[3])throw a=0,c=0,U(d[2]);return o=a,i=c,Re(a,c)}finally{v.__wbindgen_free(o,i,1)}}getCursorPosition(t,e,r){const s=v.automerge_getCursorPosition(this.__wbg_ptr,t,e,ee(r)?0:de(r));if(s[2])throw U(s[1]);return s[0]}emptyChange(t,e){var r=ee(t)?0:Xe(t,v.__wbindgen_malloc,v.__wbindgen_realloc),s=Be;return v.automerge_emptyChange(this.__wbg_ptr,r,s,!ee(e),ee(e)?0:e)}mark(t,e,r,s,o){const i=v.automerge_mark(this.__wbg_ptr,t,e,r,s,o);if(i[1])throw U(i[0])}unmark(t,e,r){const s=v.automerge_unmark(this.__wbg_ptr,t,e,r);if(s[1])throw U(s[0])}marks(t,e){const r=v.automerge_marks(this.__wbg_ptr,t,ee(e)?0:de(e));if(r[2])throw U(r[1]);return U(r[0])}marksAt(t,e,r){const s=v.automerge_marksAt(this.__wbg_ptr,t,e,ee(r)?0:de(r));if(s[2])throw U(s[1]);return U(s[0])}hasOurChanges(t){return Ht(t,$e),v.automerge_hasOurChanges(this.__wbg_ptr,t.__wbg_ptr)!==0}topoHistoryTraversal(){return v.automerge_topoHistoryTraversal(this.__wbg_ptr)}stats(){return v.automerge_stats(this.__wbg_ptr)}}const Ns=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>v.__wbg_syncstate_free(n>>>0,1));class $e{static __wrap(t){t=t>>>0;const e=Object.create($e.prototype);return e.__wbg_ptr=t,Ns.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,Ns.unregister(this),t}free(){const t=this.__destroy_into_raw();v.__wbg_syncstate_free(t,0)}get sharedHeads(){return v.syncstate_sharedHeads(this.__wbg_ptr)}get lastSentHeads(){return v.syncstate_lastSentHeads(this.__wbg_ptr)}set lastSentHeads(t){const e=v.syncstate_set_lastSentHeads(this.__wbg_ptr,t);if(e[1])throw U(e[0])}set sentHashes(t){const e=v.syncstate_set_sentHashes(this.__wbg_ptr,t);if(e[1])throw U(e[0])}clone(){const t=v.syncstate_clone(this.__wbg_ptr);return $e.__wrap(t)}}async function va(n,t){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,t)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const e=await n.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(n,t);return e instanceof WebAssembly.Instance?{instance:e,module:n}:e}}function zs(){const n={};return n.wbg={},n.wbg.__wbg_String_8f0eb39a4a4c2f66=function(t,e){const r=String(e),s=Xe(r,v.__wbindgen_malloc,v.__wbindgen_realloc),o=Be;Fe().setInt32(t+4,o,!0),Fe().setInt32(t+0,s,!0)},n.wbg.__wbg_apply_eb9e9b97497f91e4=function(){return Ge(function(t,e,r){return Reflect.apply(t,e,r)},arguments)},n.wbg.__wbg_assign_3627b8559449930a=function(t,e){return Object.assign(t,e)},n.wbg.__wbg_buffer_609cc3eee51ed158=function(t){return t.buffer},n.wbg.__wbg_call_672a4d21634d4a24=function(){return Ge(function(t,e){return t.call(e)},arguments)},n.wbg.__wbg_call_7cccdd69e0791ae2=function(){return Ge(function(t,e,r){return t.call(e,r)},arguments)},n.wbg.__wbg_concat_9de968491c4340cf=function(t,e){return t.concat(e)},n.wbg.__wbg_crypto_574e78ad8b13b65f=function(t){return t.crypto},n.wbg.__wbg_defineProperty_a3ddad9901e2d29e=function(t,e,r){return Object.defineProperty(t,e,r)},n.wbg.__wbg_deleteProperty_96363d4a1d977c97=function(){return Ge(function(t,e){return Reflect.deleteProperty(t,e)},arguments)},n.wbg.__wbg_done_769e5ede4b31c67b=function(t){return t.done},n.wbg.__wbg_entries_3265d4158b33e5dc=function(t){return Object.entries(t)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(t,e){let r,s;try{r=t,s=e,console.error(Re(t,e))}finally{v.__wbindgen_free(r,s,1)}},n.wbg.__wbg_for_4ff07bddd743c5e7=function(t,e){return Symbol.for(Re(t,e))},n.wbg.__wbg_freeze_ef6d70cf38e8d948=function(t){return Object.freeze(t)},n.wbg.__wbg_from_2a5d3e218e67aa85=function(t){return Array.from(t)},n.wbg.__wbg_getRandomValues_b8f5dbd5f3995a9e=function(){return Ge(function(t,e){t.getRandomValues(e)},arguments)},n.wbg.__wbg_getTime_46267b1c24877e30=function(t){return t.getTime()},n.wbg.__wbg_get_67b2ba62fc30de12=function(){return Ge(function(t,e){return Reflect.get(t,e)},arguments)},n.wbg.__wbg_get_b9b93047fe3cf45b=function(t,e){return t[e>>>0]},n.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc=function(t){let e;try{e=t instanceof ArrayBuffer}catch{e=!1}return e},n.wbg.__wbg_instanceof_Date_e9a9be8b9cea7890=function(t){let e;try{e=t instanceof Date}catch{e=!1}return e},n.wbg.__wbg_instanceof_Object_7f2dcef8f78644a4=function(t){let e;try{e=t instanceof Object}catch{e=!1}return e},n.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(t){let e;try{e=t instanceof Uint8Array}catch{e=!1}return e},n.wbg.__wbg_isArray_a1eab7e0d067391b=function(t){return Array.isArray(t)},n.wbg.__wbg_iterator_9a24c88df860dc65=function(){return Symbol.iterator},n.wbg.__wbg_keys_5c77a08ddc2fb8a6=function(t){return Object.keys(t)},n.wbg.__wbg_length_a446193dc22c12f8=function(t){return t.length},n.wbg.__wbg_length_d56737991078581b=function(t){return t.length},n.wbg.__wbg_length_e2d2a49132c1b256=function(t){return t.length},n.wbg.__wbg_log_1ae1e9f741096e91=function(t,e){console.log(t,e)},n.wbg.__wbg_log_c222819a41e063d3=function(t){console.log(t)},n.wbg.__wbg_msCrypto_a61aeb35a24c1329=function(t){return t.msCrypto},n.wbg.__wbg_new_1ab78df5e132f715=function(t,e){return new RangeError(Re(t,e))},n.wbg.__wbg_new_31a97dac4f10fab7=function(t){return new Date(t)},n.wbg.__wbg_new_405e22f390576ce2=function(){return new Object},n.wbg.__wbg_new_78feb108b6472713=function(){return new Array},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_new_a12002a7f91c75be=function(t){return new Uint8Array(t)},n.wbg.__wbg_new_c68d7209be747379=function(t,e){return new Error(Re(t,e))},n.wbg.__wbg_newnoargs_105ed471475aaf50=function(t,e){return new Function(Re(t,e))},n.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(t,e,r){return new Uint8Array(t,e>>>0,r>>>0)},n.wbg.__wbg_newwithlength_a381634e90c276d4=function(t){return new Uint8Array(t>>>0)},n.wbg.__wbg_next_25feadfc0913fea9=function(t){return t.next},n.wbg.__wbg_next_6574e1a8a62d1055=function(){return Ge(function(t){return t.next()},arguments)},n.wbg.__wbg_node_905d3e251edff8a2=function(t){return t.node},n.wbg.__wbg_ownKeys_3930041068756f1f=function(){return Ge(function(t){return Reflect.ownKeys(t)},arguments)},n.wbg.__wbg_process_dc0fbacc7c1c06f7=function(t){return t.process},n.wbg.__wbg_push_737cfc8c1432c2c6=function(t,e){return t.push(e)},n.wbg.__wbg_randomFillSync_ac0988aba3254290=function(){return Ge(function(t,e){t.randomFillSync(e)},arguments)},n.wbg.__wbg_require_60cc747a6bc5215a=function(){return Ge(function(){return module.require},arguments)},n.wbg.__wbg_set_37837023f3d740e8=function(t,e,r){t[e>>>0]=r},n.wbg.__wbg_set_3f1d0b984ed272ed=function(t,e,r){t[e]=r},n.wbg.__wbg_set_65595bdd868b3009=function(t,e,r){t.set(e,r>>>0)},n.wbg.__wbg_set_bb8cecf6a62b9f46=function(){return Ge(function(t,e,r){return Reflect.set(t,e,r)},arguments)},n.wbg.__wbg_slice_972c243648c9fd2e=function(t,e,r){return t.slice(e>>>0,r>>>0)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(t,e){const r=e.stack,s=Xe(r,v.__wbindgen_malloc,v.__wbindgen_realloc),o=Be;Fe().setInt32(t+4,o,!0),Fe().setInt32(t+0,s,!0)},n.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const t=typeof global>"u"?null:global;return ee(t)?0:de(t)},n.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const t=typeof globalThis>"u"?null:globalThis;return ee(t)?0:de(t)},n.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const t=typeof self>"u"?null:self;return ee(t)?0:de(t)},n.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const t=typeof window>"u"?null:window;return ee(t)?0:de(t)},n.wbg.__wbg_subarray_aa9065fa9dc5df96=function(t,e,r){return t.subarray(e>>>0,r>>>0)},n.wbg.__wbg_toString_66ab719c2a98bdf1=function(t){return t.toString()},n.wbg.__wbg_unshift_c290010f73f04fb1=function(t,e){return t.unshift(e)},n.wbg.__wbg_value_cd1ffa7b1ab794f1=function(t){return t.value},n.wbg.__wbg_values_fcb8ba8c0aad8b58=function(t){return Object.values(t)},n.wbg.__wbg_versions_c01dfd4722a88165=function(t){return t.versions},n.wbg.__wbindgen_bigint_from_i64=function(t){return t},n.wbg.__wbindgen_bigint_from_u64=function(t){return BigInt.asUintN(64,t)},n.wbg.__wbindgen_boolean_get=function(t){const e=t;return typeof e=="boolean"?e?1:0:2},n.wbg.__wbindgen_debug_string=function(t,e){const r=Ar(e),s=Xe(r,v.__wbindgen_malloc,v.__wbindgen_realloc),o=Be;Fe().setInt32(t+4,o,!0),Fe().setInt32(t+0,s,!0)},n.wbg.__wbindgen_error_new=function(t,e){return new Error(Re(t,e))},n.wbg.__wbindgen_init_externref_table=function(){const t=v.__wbindgen_export_4,e=t.grow(4);t.set(0,void 0),t.set(e+0,void 0),t.set(e+1,null),t.set(e+2,!0),t.set(e+3,!1)},n.wbg.__wbindgen_is_array=function(t){return Array.isArray(t)},n.wbg.__wbindgen_is_function=function(t){return typeof t=="function"},n.wbg.__wbindgen_is_null=function(t){return t===null},n.wbg.__wbindgen_is_object=function(t){const e=t;return typeof e=="object"&&e!==null},n.wbg.__wbindgen_is_string=function(t){return typeof t=="string"},n.wbg.__wbindgen_is_undefined=function(t){return t===void 0},n.wbg.__wbindgen_json_serialize=function(t,e){const r=e,s=JSON.stringify(r===void 0?null:r),o=Xe(s,v.__wbindgen_malloc,v.__wbindgen_realloc),i=Be;Fe().setInt32(t+4,i,!0),Fe().setInt32(t+0,o,!0)},n.wbg.__wbindgen_jsval_loose_eq=function(t,e){return t==e},n.wbg.__wbindgen_memory=function(){return v.memory},n.wbg.__wbindgen_number_get=function(t,e){const r=e,s=typeof r=="number"?r:void 0;Fe().setFloat64(t+8,ee(s)?0:s,!0),Fe().setInt32(t+0,!ee(s),!0)},n.wbg.__wbindgen_number_new=function(t){return t},n.wbg.__wbindgen_string_get=function(t,e){const r=e,s=typeof r=="string"?r:void 0;var o=ee(s)?0:Xe(s,v.__wbindgen_malloc,v.__wbindgen_realloc),i=Be;Fe().setInt32(t+4,i,!0),Fe().setInt32(t+0,o,!0)},n.wbg.__wbindgen_string_new=function(t,e){return Re(t,e)},n.wbg.__wbindgen_throw=function(t,e){throw new Error(Re(t,e))},n}function Ws(n,t){return v=n.exports,Er.__wbindgen_wasm_module=t,Ot=null,gn=null,v.__wbindgen_start(),v}function xa(n){if(v!==void 0)return v;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module:n}=n:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const t=zs();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));const e=new WebAssembly.Instance(n,t);return Ws(e,n)}async function Er(n){if(v!==void 0)return v;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("automerge_wasm_bg.wasm",import.meta.url));const t=zs();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:e,module:r}=await va(await n,t);return Ws(e,r)}const Sa=Object.freeze(Object.defineProperty({__proto__:null,Automerge:et,SyncState:$e,create:ua,decodeChange:la,decodeSyncMessage:ma,decodeSyncState:_a,default:Er,encodeChange:fa,encodeSyncMessage:ba,encodeSyncState:wa,exportSyncState:ya,importSyncState:pa,initSync:xa,initSyncState:ga,load:da},Symbol.toStringTag,{value:"Module"}));let Ia=[];function Aa(n){for(const t in n)ke[t]=n[t];for(const t of Ia)t()}const ke={create(n){throw new RangeError("Automerge.use() not called")},load(n,t){throw new RangeError("Automerge.use() not called (load)")},encodeChange(n){throw new RangeError("Automerge.use() not called (encodeChange)")},decodeChange(n){throw new RangeError("Automerge.use() not called (decodeChange)")},initSyncState(){throw new RangeError("Automerge.use() not called (initSyncState)")},encodeSyncMessage(n){throw new RangeError("Automerge.use() not called (encodeSyncMessage)")},decodeSyncMessage(n){throw new RangeError("Automerge.use() not called (decodeSyncMessage)")},encodeSyncState(n){throw new RangeError("Automerge.use() not called (encodeSyncState)")},decodeSyncState(n){throw new RangeError("Automerge.use() not called (decodeSyncState)")},exportSyncState(n){throw new RangeError("Automerge.use() not called (exportSyncState)")},importSyncState(n){throw new RangeError("Automerge.use() not called (importSyncState)")}};function Ea(n){return Er({module_or_path:n}).then(t=>{Aa(Sa)})}function ge(n,t=!0){if(typeof n!="object")throw new RangeError("must be the document root");const e=Reflect.get(n,X);if(e===void 0||e==null||t&&ka(n)!=="_root")throw new RangeError("must be the document root");return e}function Js(n){return Reflect.get(n,ie)}function ka(n){return typeof n!="object"||n===null?null:Reflect.get(n,Je)}function Vn(n){return!!Reflect.get(n,Wt)}var Ca=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(e[r[s]]=n[r[s]]);return e};function kr(n){return typeof n=="object"?n:{actor:n}}function Ke(n){const t=kr(n),e=!!t.freeze,r=t.patchCallback,s=t.actor,o=ke.create({actor:s});return o.enableFreeze(!!t.freeze),eo(o),o.materialize("/",void 0,{handle:o,heads:void 0,freeze:e,patchCallback:r})}function Oa(n,t){const e=ge(n),r=e.handle;return e.handle.materialize("/",t,Object.assign(Object.assign({},e),{handle:r,heads:t}))}function Nn(n,t){const e=ge(n),r=e.heads,s=kr(t),o=e.handle.fork(s.actor,r);o.updateDiffCursor();const{heads:i}=e,a=Ca(e,["heads"]);return a.patchCallback=s.patchCallback,o.applyPatches(n,Object.assign(Object.assign({},a),{handle:o}))}function Ha(n,t){return yn(Ke(t),"from",{},e=>Object.assign(e,n)).newDoc}function ja(n,t,e){if(typeof t=="function")return yn(n,"change",{},t).newDoc;if(typeof e=="function")return typeof t=="string"&&(t={message:t}),yn(n,"change",t,e).newDoc;throw RangeError("Invalid args for change")}function Ra(n,t,e,r){if(typeof e=="function")return yn(n,"changeAt",{},e,t);if(typeof r=="function")return typeof e=="string"&&(e={message:e}),yn(n,"changeAt",e,r,t);throw RangeError("Invalid args for changeAt")}function pn(n,t,e,r){if(e==null)return n;const s=ge(n),o=Object.assign(Object.assign({},s),{heads:void 0}),{value:i,patches:a}=s.handle.applyAndReturnPatches(n,o);if(a.length>0){r==null||r(a,{before:n,after:i,source:t});const c=ge(i);c.mostRecentPatch={before:ge(n).heads,after:c.handle.getHeads(),patches:a}}return s.heads=e,i}function yn(n,t,e,r,s){if(typeof r!="function")throw new RangeError("invalid change function");const o=ge(n);if(n===void 0||o===void 0)throw new RangeError("must be the document root");if(o.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(Vn(n))throw new RangeError("Calls to Automerge.change cannot be nested");let i=o.handle.getHeads();s&&Da(s,i)&&(s=void 0),s&&(o.handle.isolate(s),i=s),"time"in e||(e.time=Math.floor(Date.now()/1e3));try{o.heads=i;const a=aa(o.handle);if(r(a),o.handle.pendingOps()===0)return o.heads=void 0,s&&o.handle.integrate(),{newDoc:n,newHeads:null};{const c=o.handle.commit(e.message,e.time);return o.handle.integrate(),{newDoc:pn(n,t,i,e.patchCallback||o.patchCallback),newHeads:c!=null?[c]:null}}}catch(a){throw o.heads=void 0,o.handle.rollback(),a}}function Ua(n,t){t===void 0&&(t={}),typeof t=="string"&&(t={message:t}),"time"in t||(t.time=Math.floor(Date.now()/1e3));const e=ge(n);if(e.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(Vn(n))throw new RangeError("Calls to Automerge.change cannot be nested");const r=e.handle.getHeads();return e.handle.emptyChange(t.message,t.time),pn(n,"emptyChange",r)}function Pa(n,t){const e=kr(t);if(e.patchCallback)return Gs(Ke(e),n);const r=e.actor,s=e.patchCallback,o=e.unchecked||!1,i=e.allowMissingChanges||!1,a=e.convertImmutableStringsToText||!1,c=ke.load(n,{actor:r,unchecked:o,allowMissingDeps:i,convertImmutableStringsToText:a});return c.enableFreeze(!!e.freeze),eo(c),c.materialize("/",void 0,{handle:c,heads:void 0,patchCallback:s})}function Gs(n,t,e){e||(e={});const r=ge(n);if(r.heads)throw new RangeError("Attempting to change an out of date document - set at: "+Js(n));if(Vn(n))throw new RangeError("Calls to Automerge.change cannot be nested");const s=r.handle.getHeads();return r.handle.loadIncremental(t),pn(n,"loadIncremental",s,e.patchCallback||r.patchCallback)}function Ks(n){return ge(n).handle.save()}function qs(n,t){const e=ge(n);if(e.heads)throw new RangeError("Attempting to change an out of date document - set at: "+Js(n));const r=e.handle.getHeads(),s=ge(t),o=e.handle.getChangesAdded(s.handle);return e.handle.applyChanges(o),pn(n,"merge",r,e.patchCallback)}function Cr(n,t,e){Ys(t,"before"),Ys(e,"after");const r=ge(n);return r.mostRecentPatch&&Or(r.mostRecentPatch.before,t)&&Or(r.mostRecentPatch.after,e)?r.mostRecentPatch.patches:r.handle.diff(t,e)}function Da(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function Ys(n,t){if(!Array.isArray(n))throw new Error(`${t} must be an array`)}function Or(n,t){if(!Xs(n)||!Xs(t))return n===t;const e=Object.keys(n).sort(),r=Object.keys(t).sort();if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==r[s]||!Or(n[e[s]],t[r[s]]))return!1;return!0}function Qs(n){const t=ke.importSyncState(n),e=ke.encodeSyncState(t);return t.free(),e}function Zs(n){const t=ke.decodeSyncState(n),e=ke.exportSyncState(t);return t.free(),e}function La(n,t){const e=ge(n),r=ke.importSyncState(t),s=e.handle.generateSyncMessage(r);return[ke.exportSyncState(r),s]}function Ta(n,t,e,r){const s=ke.importSyncState(t);r||(r={});const o=ge(n);if(o.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(Vn(n))throw new RangeError("Calls to Automerge.change cannot be nested");const i=o.handle.getHeads();o.handle.receiveSyncMessage(s,e);const a=ke.exportSyncState(s);return[pn(n,"receiveSyncMessage",i,r.patchCallback||o.patchCallback),a,null]}function Ma(){return ke.exportSyncState(ke.initSyncState())}function Ba(n){return ke.decodeSyncMessage(n)}function ft(n){const t=ge(n);return t.heads||t.handle.getHeads()}function Xs(n){return typeof n=="object"&&n!==null}function Fa(n,t){return ge(n).handle.saveSince(t)}function eo(n){n.registerDatatype("counter",t=>new Sr(t),t=>{if(t instanceof Sr)return t.value}),n.registerDatatype("str",t=>new Ts(t),t=>{if(Fs(t))return t.val})}function $a(n){return ge(n).handle.topoHistoryTraversal()}function Va(n,t){return ge(n).handle.getDecodedChangeByHash(t)}function Hr(n){return ge(n).handle.stats()}function jr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Rr={exports:{}},Ur,to;function Na(){if(to)return Ur;to=1;var n=1e3,t=n*60,e=t*60,r=e*24,s=r*7,o=r*365.25;Ur=function(l,g){g=g||{};var f=typeof l;if(f==="string"&&l.length>0)return i(l);if(f==="number"&&isFinite(l))return g.long?c(l):a(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function i(l){if(l=String(l),!(l.length>100)){var g=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(g){var f=parseFloat(g[1]),u=(g[2]||"ms").toLowerCase();switch(u){case"years":case"year":case"yrs":case"yr":case"y":return f*o;case"weeks":case"week":case"w":return f*s;case"days":case"day":case"d":return f*r;case"hours":case"hour":case"hrs":case"hr":case"h":return f*e;case"minutes":case"minute":case"mins":case"min":case"m":return f*t;case"seconds":case"second":case"secs":case"sec":case"s":return f*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function a(l){var g=Math.abs(l);return g>=r?Math.round(l/r)+"d":g>=e?Math.round(l/e)+"h":g>=t?Math.round(l/t)+"m":g>=n?Math.round(l/n)+"s":l+"ms"}function c(l){var g=Math.abs(l);return g>=r?d(l,g,r,"day"):g>=e?d(l,g,e,"hour"):g>=t?d(l,g,t,"minute"):g>=n?d(l,g,n,"second"):l+" ms"}function d(l,g,f,u){var p=g>=f*1.5;return Math.round(l/f)+" "+u+(p?"s":"")}return Ur}var Pr,no;function za(){if(no)return Pr;no=1;function n(t){r.debug=r,r.default=r,r.coerce=d,r.disable=a,r.enable=o,r.enabled=c,r.humanize=Na(),r.destroy=l,Object.keys(t).forEach(g=>{r[g]=t[g]}),r.names=[],r.skips=[],r.formatters={};function e(g){let f=0;for(let u=0;u<g.length;u++)f=(f<<5)-f+g.charCodeAt(u),f|=0;return r.colors[Math.abs(f)%r.colors.length]}r.selectColor=e;function r(g){let f,u=null,p,m;function C(...D){if(!C.enabled)return;const R=C,I=Number(new Date),W=I-(f||I);R.diff=W,R.prev=f,R.curr=I,f=I,D[0]=r.coerce(D[0]),typeof D[0]!="string"&&D.unshift("%O");let L=0;D[0]=D[0].replace(/%([a-zA-Z%])/g,(T,J)=>{if(T==="%%")return"%";L++;const B=r.formatters[J];if(typeof B=="function"){const k=D[L];T=B.call(R,k),D.splice(L,1),L--}return T}),r.formatArgs.call(R,D),(R.log||r.log).apply(R,D)}return C.namespace=g,C.useColors=r.useColors(),C.color=r.selectColor(g),C.extend=s,C.destroy=r.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(p!==r.namespaces&&(p=r.namespaces,m=r.enabled(g)),m),set:D=>{u=D}}),typeof r.init=="function"&&r.init(C),C}function s(g,f){const u=r(this.namespace+(typeof f>"u"?":":f)+g);return u.log=this.log,u}function o(g){r.save(g),r.namespaces=g,r.names=[],r.skips=[];const f=(typeof g=="string"?g:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const u of f)u[0]==="-"?r.skips.push(u.slice(1)):r.names.push(u)}function i(g,f){let u=0,p=0,m=-1,C=0;for(;u<g.length;)if(p<f.length&&(f[p]===g[u]||f[p]==="*"))f[p]==="*"?(m=p,C=u,p++):(u++,p++);else if(m!==-1)p=m+1,C++,u=C;else return!1;for(;p<f.length&&f[p]==="*";)p++;return p===f.length}function a(){const g=[...r.names,...r.skips.map(f=>"-"+f)].join(",");return r.enable(""),g}function c(g){for(const f of r.skips)if(i(g,f))return!1;for(const f of r.names)if(i(g,f))return!0;return!1}function d(g){return g instanceof Error?g.stack||g.message:g}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return Pr=n,Pr}var ro;function Wa(){return ro||(ro=1,function(n,t){var e={};t.formatArgs=s,t.save=o,t.load=i,t.useColors=r,t.storage=a(),t.destroy=(()=>{let d=!1;return()=>{d||(d=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let d;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(d=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(d[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(d){if(d[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+d[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;d.splice(1,0,l,"color: inherit");let g=0,f=0;d[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(g++,u==="%c"&&(f=g))}),d.splice(f,0,l)}t.log=console.debug||console.log||(()=>{});function o(d){try{d?t.storage.setItem("debug",d):t.storage.removeItem("debug")}catch{}}function i(){let d;try{d=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!d&&typeof process<"u"&&"env"in process&&(d=e.DEBUG),d}function a(){try{return localStorage}catch{}}n.exports=za()(t);const{formatters:c}=n.exports;c.j=function(d){try{return JSON.stringify(d)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}}(Rr,Rr.exports)),Rr.exports}var Ja=Wa();const lt=jr(Ja);var so={exports:{}},oo;function Ga(){return oo||(oo=1,function(n){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function s(c,d,l){this.fn=c,this.context=d,this.once=l||!1}function o(c,d,l,g,f){if(typeof l!="function")throw new TypeError("The listener must be a function");var u=new s(l,g||c,f),p=e?e+d:d;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],u]:c._events[p].push(u):(c._events[p]=u,c._eventsCount++),c}function i(c,d){--c._eventsCount===0?c._events=new r:delete c._events[d]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],d,l;if(this._eventsCount===0)return c;for(l in d=this._events)t.call(d,l)&&c.push(e?l.slice(1):l);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},a.prototype.listeners=function(c){var d=e?e+c:c,l=this._events[d];if(!l)return[];if(l.fn)return[l.fn];for(var g=0,f=l.length,u=new Array(f);g<f;g++)u[g]=l[g].fn;return u},a.prototype.listenerCount=function(c){var d=e?e+c:c,l=this._events[d];return l?l.fn?1:l.length:0},a.prototype.emit=function(c,d,l,g,f,u){var p=e?e+c:c;if(!this._events[p])return!1;var m=this._events[p],C=arguments.length,D,R;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),C){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,d),!0;case 3:return m.fn.call(m.context,d,l),!0;case 4:return m.fn.call(m.context,d,l,g),!0;case 5:return m.fn.call(m.context,d,l,g,f),!0;case 6:return m.fn.call(m.context,d,l,g,f,u),!0}for(R=1,D=new Array(C-1);R<C;R++)D[R-1]=arguments[R];m.fn.apply(m.context,D)}else{var I=m.length,W;for(R=0;R<I;R++)switch(m[R].once&&this.removeListener(c,m[R].fn,void 0,!0),C){case 1:m[R].fn.call(m[R].context);break;case 2:m[R].fn.call(m[R].context,d);break;case 3:m[R].fn.call(m[R].context,d,l);break;case 4:m[R].fn.call(m[R].context,d,l,g);break;default:if(!D)for(W=1,D=new Array(C-1);W<C;W++)D[W-1]=arguments[W];m[R].fn.apply(m[R].context,D)}}return!0},a.prototype.on=function(c,d,l){return o(this,c,d,l,!1)},a.prototype.once=function(c,d,l){return o(this,c,d,l,!0)},a.prototype.removeListener=function(c,d,l,g){var f=e?e+c:c;if(!this._events[f])return this;if(!d)return i(this,f),this;var u=this._events[f];if(u.fn)u.fn===d&&(!g||u.once)&&(!l||u.context===l)&&i(this,f);else{for(var p=0,m=[],C=u.length;p<C;p++)(u[p].fn!==d||g&&!u[p].once||l&&u[p].context!==l)&&m.push(u[p]);m.length?this._events[f]=m.length===1?m[0]:m:i(this,f)}return this},a.prototype.removeAllListeners=function(c){var d;return c?(d=e?e+c:c,this._events[d]&&i(this,d)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,n.exports=a}(so)),so.exports}var Ka=Ga();const jt=jr(Ka);function qa(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function Ya(){const n=qa();if(n.__xstate__)return n.__xstate__}const Qa=n=>{if(typeof window>"u")return;const t=Ya();t&&t.register(n)};class io{constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(t){const e={value:t,next:null};if(this._current){this._last.next=e,this._last=e;return}this._current=e,this._last=e,this._active&&this.flush()}flush(){for(;this._current;){const t=this._current;this._process(t.value),this._current=t.next}this._last=null}}const ao=".",Za="",co="",Xa="#",ec="*",ho="xstate.init",Dr="xstate.stop";function tc(n,t){return{type:`xstate.after.${n}.${t}`}}function Lr(n,t){return{type:`xstate.done.state.${n}`,output:t}}function nc(n,t){return{type:`xstate.done.actor.${n}`,output:t,actorId:n}}function rc(n,t){return{type:`xstate.error.actor.${n}`,error:t,actorId:n}}function uo(n){return{type:ho,input:n}}function gt(n){setTimeout(()=>{throw n})}const sc=typeof Symbol=="function"&&Symbol.observable||"@@observable";function fo(n,t){const e=lo(n),r=lo(t);return typeof r=="string"?typeof e=="string"?r===e:!1:typeof e=="string"?e in r:Object.keys(e).every(s=>s in r?fo(e[s],r[s]):!1)}function Tr(n){if(yo(n))return n;const t=[];let e="";for(let r=0;r<n.length;r++){switch(n.charCodeAt(r)){case 92:e+=n[r+1],r++;continue;case 46:t.push(e),e="";continue}e+=n[r]}return t.push(e),t}function lo(n){if(Mc(n))return n.value;if(typeof n!="string")return n;const t=Tr(n);return oc(t)}function oc(n){if(n.length===1)return n[0];const t={};let e=t;for(let r=0;r<n.length-1;r++)if(r===n.length-2)e[n[r]]=n[r+1];else{const s=e;e={},s[n[r]]=e}return t}function go(n,t){const e={},r=Object.keys(n);for(let s=0;s<r.length;s++){const o=r[s];e[o]=t(n[o],o,n,s)}return e}function po(n){return yo(n)?n:[n]}function pt(n){return n===void 0?[]:po(n)}function Mr(n,t,e,r){return typeof n=="function"?n({context:t,event:e,self:r}):n}function yo(n){return Array.isArray(n)}function ic(n){return n.type.startsWith("xstate.error.actor")}function Jt(n){return po(n).map(t=>typeof t>"u"||typeof t=="string"?{target:t}:t)}function bo(n){if(!(n===void 0||n===Za))return pt(n)}function Br(n,t,e){var o,i,a;const r=typeof n=="object",s=r?n:void 0;return{next:(o=r?n.next:n)==null?void 0:o.bind(s),error:(i=r?n.error:t)==null?void 0:i.bind(s),complete:(a=r?n.complete:e)==null?void 0:a.bind(s)}}function mo(n,t){return`${t}.${n}`}function Fr(n,t){const e=t.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!e)return n.implementations.actors[t];const[,r,s]=e,o=n.getStateNodeById(s).config.invoke;return(Array.isArray(o)?o[r]:o).src}function wo(n,t){return`${n.sessionId}.${t}`}let ac=0;function cc(n,t){const e=new Map,r=new Map,s=new WeakMap,o=new Set,i={},{clock:a,logger:c}=t,d={schedule:(f,u,p,m,C=Math.random().toString(36).slice(2))=>{const D={source:f,target:u,event:p,delay:m,id:C,startedAt:Date.now()},R=wo(f,C);g._snapshot._scheduledEvents[R]=D;const I=a.setTimeout(()=>{delete i[R],delete g._snapshot._scheduledEvents[R],g._relay(f,u,p)},m);i[R]=I},cancel:(f,u)=>{const p=wo(f,u),m=i[p];delete i[p],delete g._snapshot._scheduledEvents[p],m!==void 0&&a.clearTimeout(m)},cancelAll:f=>{for(const u in g._snapshot._scheduledEvents){const p=g._snapshot._scheduledEvents[u];p.source===f&&d.cancel(f,p.id)}}},l=f=>{if(!o.size)return;const u={...f,rootId:n.sessionId};o.forEach(p=>{var m;return(m=p.next)==null?void 0:m.call(p,u)})},g={_snapshot:{_scheduledEvents:((t==null?void 0:t.snapshot)&&t.snapshot.scheduler)??{}},_bookId:()=>`x:${ac++}`,_register:(f,u)=>(e.set(f,u),f),_unregister:f=>{e.delete(f.sessionId);const u=s.get(f);u!==void 0&&(r.delete(u),s.delete(f))},get:f=>r.get(f),_set:(f,u)=>{const p=r.get(f);if(p&&p!==u)throw new Error(`Actor with system ID '${f}' already exists.`);r.set(f,u),s.set(u,f)},inspect:f=>{const u=Br(f);return o.add(u),{unsubscribe(){o.delete(u)}}},_sendInspectionEvent:l,_relay:(f,u,p)=>{g._sendInspectionEvent({type:"@xstate.event",sourceRef:f,actorRef:u,event:p}),u._send(p)},scheduler:d,getSnapshot:()=>({_scheduledEvents:{...g._snapshot._scheduledEvents}}),start:()=>{const f=g._snapshot._scheduledEvents;g._snapshot._scheduledEvents={};for(const u in f){const{source:p,target:m,event:C,delay:D,id:R}=f[u];d.schedule(p,m,C,D,R)}},_clock:a,_logger:c};return g}let $r=!1;const Vr=1;let Ce=function(n){return n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped",n}({});const hc={clock:{setTimeout:(n,t)=>setTimeout(n,t),clearTimeout:n=>clearTimeout(n)},logger:console.log.bind(console),devTools:!1};class uc{constructor(t,e){this.logic=t,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new io(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=Ce.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const r={...hc,...e},{clock:s,logger:o,parent:i,syncSnapshot:a,id:c,systemId:d,inspect:l}=r;this.system=i?i.system:cc(this,{clock:s,logger:o}),l&&!i&&this.system.inspect(Br(l)),this.sessionId=this.system._bookId(),this.id=c??this.sessionId,this.logger=(e==null?void 0:e.logger)??this.system._logger,this.clock=(e==null?void 0:e.clock)??this.system._clock,this._parent=i,this._syncSnapshot=a,this.options=r,this.src=r.src??t,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:g=>{this._deferred.push(g)},system:this.system,stopChild:g=>{if(g._parent!==this)throw new Error(`Cannot stop child actor ${g.id} of ${this.id} because it is not a child`);g._stop()},emit:g=>{const f=this.eventListeners.get(g.type),u=this.eventListeners.get("*");if(!f&&!u)return;const p=[...f?f.values():[],...u?u.values():[]];for(const m of p)m(g)},actionExecutor:g=>{const f=()=>{if(this._actorScope.system._sendInspectionEvent({type:"@xstate.action",actorRef:this,action:{type:g.type,params:g.params}}),!g.exec)return;const u=$r;try{$r=!0,g.exec(g.info,g.params)}finally{$r=u}};this._processingStatus===Ce.Running?f():this._deferred.push(f)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),d&&(this._systemId=d,this.system._set(d,this)),this._initState((e==null?void 0:e.snapshot)??(e==null?void 0:e.state)),d&&this._snapshot.status!=="active"&&this.system._unregister(this)}_initState(t){var e;try{this._snapshot=t?this.logic.restoreSnapshot?this.logic.restoreSnapshot(t,this._actorScope):t:this.logic.getInitialSnapshot(this._actorScope,(e=this.options)==null?void 0:e.input)}catch(r){this._snapshot={status:"error",output:void 0,error:r}}}update(t,e){var s,o;this._snapshot=t;let r;for(;r=this._deferred.shift();)try{r()}catch(i){this._deferred.length=0,this._snapshot={...t,status:"error",error:i}}switch(this._snapshot.status){case"active":for(const i of this.observers)try{(s=i.next)==null||s.call(i,t)}catch(a){gt(a)}break;case"done":for(const i of this.observers)try{(o=i.next)==null||o.call(i,t)}catch(a){gt(a)}this._stopProcedure(),this._complete(),this._doneEvent=nc(this.id,this._snapshot.output),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error);break}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:e,snapshot:t})}subscribe(t,e,r){var o;const s=Br(t,e,r);if(this._processingStatus!==Ce.Stopped)this.observers.add(s);else switch(this._snapshot.status){case"done":try{(o=s.complete)==null||o.call(s)}catch(i){gt(i)}break;case"error":{const i=this._snapshot.error;if(!s.error)gt(i);else try{s.error(i)}catch(a){gt(a)}break}}return{unsubscribe:()=>{this.observers.delete(s)}}}on(t,e){let r=this.eventListeners.get(t);r||(r=new Set,this.eventListeners.set(t,r));const s=e.bind(void 0);return r.add(s),{unsubscribe:()=>{r.delete(s)}}}start(){if(this._processingStatus===Ce.Running)return this;this._syncSnapshot&&this.subscribe({next:e=>{e.status==="active"&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:e})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=Ce.Running;const t=uo(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:t}),this._snapshot.status){case"done":return this.update(this._snapshot,t),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(e){return this._snapshot={...this._snapshot,status:"error",error:e},this._error(e),this}return this.update(this._snapshot,t),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(t){let e,r;try{e=this.logic.transition(this._snapshot,t,this._actorScope)}catch(s){r={err:s}}if(r){const{err:s}=r;this._snapshot={...this._snapshot,status:"error",error:s},this._error(s);return}this.update(e,t),t.type===Dr&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===Ce.Stopped?this:(this.mailbox.clear(),this._processingStatus===Ce.NotStarted?(this._processingStatus=Ce.Stopped,this):(this.mailbox.enqueue({type:Dr}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){var t;for(const e of this.observers)try{(t=e.complete)==null||t.call(e)}catch(r){gt(r)}this.observers.clear()}_reportError(t){if(!this.observers.size){this._parent||gt(t);return}let e=!1;for(const r of this.observers){const s=r.error;e||(e=!s);try{s==null||s(t)}catch(o){gt(o)}}this.observers.clear(),e&&gt(t)}_error(t){this._stopProcedure(),this._reportError(t),this._parent&&this.system._relay(this,this._parent,rc(this.id,t))}_stopProcedure(){return this._processingStatus!==Ce.Running?this:(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new io(this._process.bind(this)),this._processingStatus=Ce.Stopped,this.system._unregister(this),this)}_send(t){this._processingStatus!==Ce.Stopped&&this.mailbox.enqueue(t)}send(t){this.system._relay(void 0,this,t)}attachDevTools(){const{devTools:t}=this.options;t&&(typeof t=="function"?t:Qa)(this)}toJSON(){return{xstate$$type:Vr,id:this.id}}getPersistedSnapshot(t){return this.logic.getPersistedSnapshot(this._snapshot,t)}[sc](){return this}getSnapshot(){return this._snapshot}}function bn(n,...[t]){return new uc(n,t)}function dc(n,t,e,r,{sendId:s}){const o=typeof s=="function"?s(e,r):s;return[t,{sendId:o},void 0]}function fc(n,t){n.defer(()=>{n.system.scheduler.cancel(n.self,t.sendId)})}function lc(n){function t(e,r){}return t.type="xstate.cancel",t.sendId=n,t.resolve=dc,t.execute=fc,t}function gc(n,t,e,r,{id:s,systemId:o,src:i,input:a,syncSnapshot:c}){const d=typeof i=="string"?Fr(t.machine,i):i,l=typeof s=="function"?s(e):s;let g,f;return d&&(f=typeof a=="function"?a({context:t.context,event:e.event,self:n.self}):a,g=bn(d,{id:l,src:i,parent:n.self,syncSnapshot:c,systemId:o,input:f})),[Pt(t,{children:{...t.children,[l]:g}}),{id:s,systemId:o,actorRef:g,src:i,input:f},void 0]}function pc(n,{actorRef:t}){t&&n.defer(()=>{t._processingStatus!==Ce.Stopped&&t.start()})}function yc(...[n,{id:t,systemId:e,input:r,syncSnapshot:s=!1}={}]){function o(i,a){}return o.type="xstate.spawnChild",o.id=t,o.systemId=e,o.src=n,o.input=r,o.syncSnapshot=s,o.resolve=gc,o.execute=pc,o}function bc(n,t,e,r,{actorRef:s}){const o=typeof s=="function"?s(e,r):s,i=typeof o=="string"?t.children[o]:o;let a=t.children;return i&&(a={...a},delete a[i.id]),[Pt(t,{children:a}),i,void 0]}function mc(n,t){if(t){if(n.system._unregister(t),t._processingStatus!==Ce.Running){n.stopChild(t);return}n.defer(()=>{n.stopChild(t)})}}function _o(n){function t(e,r){}return t.type="xstate.stopChild",t.actorRef=n,t.resolve=bc,t.execute=mc,t}function Nr(n,t,e,r){const{machine:s}=r,o=typeof n=="function",i=o?n:s.implementations.guards[typeof n=="string"?n:n.type];if(!o&&!i)throw new Error(`Guard '${typeof n=="string"?n:n.type}' is not implemented.'.`);if(typeof i!="function")return Nr(i,t,e,r);const a={context:t,event:e},c=o||typeof n=="string"?void 0:"params"in n?typeof n.params=="function"?n.params({context:t,event:e}):n.params:void 0;return"check"in i?i.check(r,a,i):i(a,c)}const zr=n=>n.type==="atomic"||n.type==="final";function Gt(n){return Object.values(n.states).filter(t=>t.type!=="history")}function mn(n,t){const e=[];if(t===n)return e;let r=n.parent;for(;r&&r!==t;)e.push(r),r=r.parent;return e}function zn(n){const t=new Set(n),e=xo(t);for(const r of t)if(r.type==="compound"&&(!e.get(r)||!e.get(r).length))Ao(r).forEach(s=>t.add(s));else if(r.type==="parallel"){for(const s of Gt(r))if(s.type!=="history"&&!t.has(s)){const o=Ao(s);for(const i of o)t.add(i)}}for(const r of t){let s=r.parent;for(;s;)t.add(s),s=s.parent}return t}function vo(n,t){const e=t.get(n);if(!e)return{};if(n.type==="compound"){const s=e[0];if(s){if(zr(s))return s.key}else return{}}const r={};for(const s of e)r[s.key]=vo(s,t);return r}function xo(n){const t=new Map;for(const e of n)t.has(e)||t.set(e,[]),e.parent&&(t.has(e.parent)||t.set(e.parent,[]),t.get(e.parent).push(e));return t}function So(n,t){const e=zn(t);return vo(n,xo(e))}function Wr(n,t){return t.type==="compound"?Gt(t).some(e=>e.type==="final"&&n.has(e)):t.type==="parallel"?Gt(t).every(e=>Wr(n,e)):t.type==="final"}const Wn=n=>n[0]===Xa;function wc(n,t){return n.transitions.get(t)||[...n.transitions.keys()].filter(e=>{if(e===ec)return!0;if(!e.endsWith(".*"))return!1;const r=e.split("."),s=t.split(".");for(let o=0;o<r.length;o++){const i=r[o],a=s[o];if(i==="*")return o===r.length-1;if(i!==a)return!1}return!0}).sort((e,r)=>r.length-e.length).flatMap(e=>n.transitions.get(e))}function _c(n){const t=n.config.after;if(!t)return[];const e=r=>{const s=tc(r,n.id),o=s.type;return n.entry.push(Kc(s,{id:o,delay:r})),n.exit.push(lc(o)),o};return Object.keys(t).flatMap(r=>{const s=t[r],o=typeof s=="string"?{target:s}:s,i=Number.isNaN(+r)?r:+r,a=e(i);return pt(o).map(c=>({...c,event:a,delay:i}))}).map(r=>{const{delay:s}=r;return{...Rt(n,r.event,r),delay:s}})}function Rt(n,t,e){const r=bo(e.target),s=e.reenter??!1,o=Sc(n,r),i={...e,actions:pt(e.actions),guard:e.guard,target:o,source:n,reenter:s,eventType:t,toJSON:()=>({...i,source:`#${n.id}`,target:o?o.map(a=>`#${a.id}`):void 0})};return i}function vc(n){const t=new Map;if(n.config.on)for(const e of Object.keys(n.config.on)){if(e===co)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const r=n.config.on[e];t.set(e,Jt(r).map(s=>Rt(n,e,s)))}if(n.config.onDone){const e=`xstate.done.state.${n.id}`;t.set(e,Jt(n.config.onDone).map(r=>Rt(n,e,r)))}for(const e of n.invoke){if(e.onDone){const r=`xstate.done.actor.${e.id}`;t.set(r,Jt(e.onDone).map(s=>Rt(n,r,s)))}if(e.onError){const r=`xstate.error.actor.${e.id}`;t.set(r,Jt(e.onError).map(s=>Rt(n,r,s)))}if(e.onSnapshot){const r=`xstate.snapshot.${e.id}`;t.set(r,Jt(e.onSnapshot).map(s=>Rt(n,r,s)))}}for(const e of n.after){let r=t.get(e.eventType);r||(r=[],t.set(e.eventType,r)),r.push(e)}return t}function xc(n,t){const e=typeof t=="string"?n.states[t]:t?n.states[t.target]:void 0;if(!e&&t)throw new Error(`Initial state node "${t}" not found on parent state node #${n.id}`);const r={source:n,actions:!t||typeof t=="string"?[]:pt(t.actions),eventType:null,reenter:!1,target:e?[e]:[],toJSON:()=>({...r,source:`#${n.id}`,target:e?[`#${e.id}`]:[]})};return r}function Sc(n,t){if(t!==void 0)return t.map(e=>{if(typeof e!="string")return e;if(Wn(e))return n.machine.getStateNodeById(e);const r=e[0]===ao;if(r&&!n.parent)return Jn(n,e.slice(1));const s=r?n.key+e:e;if(n.parent)try{return Jn(n.parent,s)}catch(o){throw new Error(`Invalid transition definition for state node '${n.id}':
${o.message}`)}else throw new Error(`Invalid target: "${e}" is not a valid target from the root node. Did you mean ".${e}"?`)})}function Io(n){const t=bo(n.config.target);return t?{target:t.map(e=>typeof e=="string"?Jn(n.parent,e):e)}:n.parent.initial}function Ut(n){return n.type==="history"}function Ao(n){const t=Eo(n);for(const e of t)for(const r of mn(e,n))t.add(r);return t}function Eo(n){const t=new Set;function e(r){if(!t.has(r)){if(t.add(r),r.type==="compound")e(r.initial.target[0]);else if(r.type==="parallel")for(const s of Gt(r))e(s)}}return e(n),t}function Kt(n,t){if(Wn(t))return n.machine.getStateNodeById(t);if(!n.states)throw new Error(`Unable to retrieve child state '${t}' from '${n.id}'; no child states exist.`);const e=n.states[t];if(!e)throw new Error(`Child state '${t}' does not exist on '${n.id}'`);return e}function Jn(n,t){if(typeof t=="string"&&Wn(t))try{return n.machine.getStateNodeById(t)}catch{}const e=Tr(t).slice();let r=n;for(;e.length;){const s=e.shift();if(!s.length)break;r=Kt(r,s)}return r}function Gn(n,t){if(typeof t=="string"){const s=n.states[t];if(!s)throw new Error(`State '${t}' does not exist on '${n.id}'`);return[n,s]}const e=Object.keys(t),r=e.map(s=>Kt(n,s)).filter(Boolean);return[n.machine.root,n].concat(r,e.reduce((s,o)=>{const i=Kt(n,o);if(!i)return s;const a=Gn(i,t[o]);return s.concat(a)},[]))}function Ic(n,t,e,r){const s=Kt(n,t).next(e,r);return!s||!s.length?n.next(e,r):s}function Ac(n,t,e,r){const s=Object.keys(t),o=Kt(n,s[0]),i=Jr(o,t[s[0]],e,r);return!i||!i.length?n.next(e,r):i}function Ec(n,t,e,r){const s=[];for(const o of Object.keys(t)){const i=t[o];if(!i)continue;const a=Kt(n,o),c=Jr(a,i,e,r);c&&s.push(...c)}return s.length?s:n.next(e,r)}function Jr(n,t,e,r){return typeof t=="string"?Ic(n,t,e,r):Object.keys(t).length===1?Ac(n,t,e,r):Ec(n,t,e,r)}function kc(n){return Object.keys(n.states).map(t=>n.states[t]).filter(t=>t.type==="history")}function vt(n,t){let e=n;for(;e.parent&&e.parent!==t;)e=e.parent;return e.parent===t}function Cc(n,t){const e=new Set(n),r=new Set(t);for(const s of e)if(r.has(s))return!0;for(const s of r)if(e.has(s))return!0;return!1}function ko(n,t,e){const r=new Set;for(const s of n){let o=!1;const i=new Set;for(const a of r)if(Cc(Kr([s],t,e),Kr([a],t,e)))if(vt(s.source,a.source))i.add(a);else{o=!0;break}if(!o){for(const a of i)r.delete(a);r.add(s)}}return Array.from(r)}function Oc(n){const[t,...e]=n;for(const r of mn(t,void 0))if(e.every(s=>vt(s,r)))return r}function Gr(n,t){if(!n.target)return[];const e=new Set;for(const r of n.target)if(Ut(r))if(t[r.id])for(const s of t[r.id])e.add(s);else for(const s of Gr(Io(r),t))e.add(s);else e.add(r);return[...e]}function Co(n,t){const e=Gr(n,t);if(!e)return;if(!n.reenter&&e.every(s=>s===n.source||vt(s,n.source)))return n.source;const r=Oc(e.concat(n.source));if(r)return r;if(!n.reenter)return n.source.machine.root}function Kr(n,t,e){var s;const r=new Set;for(const o of n)if((s=o.target)!=null&&s.length){const i=Co(o,e);o.reenter&&o.source===i&&r.add(i);for(const a of t)vt(a,i)&&r.add(a)}return[...r]}function Hc(n,t){if(n.length!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0}function qr(n,t,e,r,s,o){if(!n.length)return t;const i=new Set(t._nodes);let a=t.historyValue;const c=ko(n,i,a);let d=t;s||([d,a]=Pc(d,r,e,c,i,a,o,e.actionExecutor)),d=Yt(d,r,e,c.flatMap(g=>g.actions),o,void 0),d=Rc(d,r,e,c,i,o,a,s);const l=[...i];d.status==="done"&&(d=Yt(d,r,e,l.sort((g,f)=>f.order-g.order).flatMap(g=>g.exit),o,void 0));try{return a===t.historyValue&&Hc(t._nodes,i)?d:Pt(d,{_nodes:l,historyValue:a})}catch(g){throw g}}function jc(n,t,e,r,s){if(r.output===void 0)return;const o=Lr(s.id,s.output!==void 0&&s.parent?Mr(s.output,n.context,t,e.self):void 0);return Mr(r.output,n.context,o,e.self)}function Rc(n,t,e,r,s,o,i,a){let c=n;const d=new Set,l=new Set;Uc(r,i,l,d),a&&l.add(n.machine.root);const g=new Set;for(const f of[...d].sort((u,p)=>u.order-p.order)){s.add(f);const u=[];u.push(...f.entry);for(const p of f.invoke)u.push(yc(p.src,{...p,syncSnapshot:!!p.onSnapshot}));if(l.has(f)){const p=f.initial.actions;u.push(...p)}if(c=Yt(c,t,e,u,o,f.invoke.map(p=>p.id)),f.type==="final"){const p=f.parent;let m=(p==null?void 0:p.type)==="parallel"?p:p==null?void 0:p.parent,C=m||f;for((p==null?void 0:p.type)==="compound"&&o.push(Lr(p.id,f.output!==void 0?Mr(f.output,c.context,t,e.self):void 0));(m==null?void 0:m.type)==="parallel"&&!g.has(m)&&Wr(s,m);)g.add(m),o.push(Lr(m.id)),C=m,m=m.parent;if(m)continue;c=Pt(c,{status:"done",output:jc(c,t,e,c.machine.root,C)})}}return c}function Uc(n,t,e,r){for(const s of n){const o=Co(s,t);for(const a of s.target||[])!Ut(a)&&(s.source!==a||s.source!==o||s.reenter)&&(r.add(a),e.add(a)),qt(a,t,e,r);const i=Gr(s,t);for(const a of i){const c=mn(a,o);(o==null?void 0:o.type)==="parallel"&&c.push(o),Oo(r,t,e,c,!s.source.parent&&s.reenter?void 0:o)}}}function qt(n,t,e,r){var s;if(Ut(n))if(t[n.id]){const o=t[n.id];for(const i of o)r.add(i),qt(i,t,e,r);for(const i of o)Yr(i,n.parent,r,t,e)}else{const o=Io(n);for(const i of o.target)r.add(i),o===((s=n.parent)==null?void 0:s.initial)&&e.add(n.parent),qt(i,t,e,r);for(const i of o.target)Yr(i,n.parent,r,t,e)}else if(n.type==="compound"){const[o]=n.initial.target;Ut(o)||(r.add(o),e.add(o)),qt(o,t,e,r),Yr(o,n,r,t,e)}else if(n.type==="parallel")for(const o of Gt(n).filter(i=>!Ut(i)))[...r].some(i=>vt(i,o))||(Ut(o)||(r.add(o),e.add(o)),qt(o,t,e,r))}function Oo(n,t,e,r,s){for(const o of r)if((!s||vt(o,s))&&n.add(o),o.type==="parallel")for(const i of Gt(o).filter(a=>!Ut(a)))[...n].some(a=>vt(a,i))||(n.add(i),qt(i,t,e,n))}function Yr(n,t,e,r,s){Oo(e,r,s,mn(n,t))}function Pc(n,t,e,r,s,o,i,a){let c=n;const d=Kr(r,s,o);d.sort((g,f)=>f.order-g.order);let l;for(const g of d)for(const f of kc(g)){let u;f.history==="deep"?u=p=>zr(p)&&vt(p,g):u=p=>p.parent===g,l??(l={...o}),l[f.id]=Array.from(s).filter(u)}for(const g of d)c=Yt(c,t,e,[...g.exit,...g.invoke.map(f=>_o(f.id))],i,void 0),s.delete(g);return[c,l||o]}function Dc(n,t){return n.implementations.actions[t]}function Ho(n,t,e,r,s,o){const{machine:i}=n;let a=n;for(const c of r){const d=typeof c=="function",l=d?c:Dc(i,typeof c=="string"?c:c.type),g={context:a.context,event:t,self:e.self,system:e.system},f=d||typeof c=="string"?void 0:"params"in c?typeof c.params=="function"?c.params({context:a.context,event:t}):c.params:void 0;if(!l||!("resolve"in l)){e.actionExecutor({type:typeof c=="string"?c:typeof c=="object"?c.type:c.name||"(anonymous)",info:g,params:f,exec:l});continue}const u=l,[p,m,C]=u.resolve(e,a,g,f,l,s);a=p,"retryResolve"in u&&(o==null||o.push([u,m])),"execute"in u&&e.actionExecutor({type:u.type,info:g,params:m,exec:u.execute.bind(null,e,m)}),C&&(a=Ho(a,t,e,C,s,o))}return a}function Yt(n,t,e,r,s,o){const i=o?[]:void 0,a=Ho(n,t,e,r,{internalQueue:s,deferredActorIds:o},i);return i==null||i.forEach(([c,d])=>{c.retryResolve(e,a,d)}),a}function Qr(n,t,e,r){let s=n;const o=[];function i(d,l,g){e.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:e.self,event:l,snapshot:d,_transitions:g}),o.push(d)}if(t.type===Dr)return s=Pt(jo(s,t,e),{status:"stopped"}),i(s,t,[]),{snapshot:s,microstates:o};let a=t;if(a.type!==ho){const d=a,l=ic(d),g=Ro(d,s);if(l&&!g.length)return s=Pt(n,{status:"error",error:d.error}),i(s,d,[]),{snapshot:s,microstates:o};s=qr(g,n,e,a,!1,r),i(s,d,g)}let c=!0;for(;s.status==="active";){let d=c?Lc(s,a):[];const l=d.length?s:void 0;if(!d.length){if(!r.length)break;a=r.shift(),d=Ro(a,s)}s=qr(d,s,e,a,!1,r),c=s!==l,i(s,a,d)}return s.status!=="active"&&jo(s,a,e),{snapshot:s,microstates:o}}function jo(n,t,e){return Yt(n,t,e,Object.values(n.children).map(r=>_o(r)),[],void 0)}function Ro(n,t){return t.machine.getTransitionData(t,n)}function Lc(n,t){const e=new Set,r=n._nodes.filter(zr);for(const s of r)e:for(const o of[s].concat(mn(s,void 0)))if(o.always){for(const i of o.always)if(i.guard===void 0||Nr(i.guard,n.context,t,n)){e.add(i);break e}}return ko(Array.from(e),new Set(n._nodes),n.historyValue)}function Tc(n,t){const e=zn(Gn(n,t));return So(n,[...e])}function Mc(n){return!!n&&typeof n=="object"&&"machine"in n&&"value"in n}const Bc=function(n){return fo(n,this.value)},Fc=function(n){return this.tags.has(n)},$c=function(n){const t=this.machine.getTransitionData(this,n);return!!(t!=null&&t.length)&&t.some(e=>e.target!==void 0||e.actions.length)},Vc=function(){const{_nodes:n,tags:t,machine:e,getMeta:r,toJSON:s,can:o,hasTag:i,matches:a,...c}=this;return{...c,tags:Array.from(t)}},Nc=function(){return this._nodes.reduce((n,t)=>(t.meta!==void 0&&(n[t.id]=t.meta),n),{})};function Kn(n,t){return{status:n.status,output:n.output,error:n.error,machine:t,context:n.context,_nodes:n._nodes,value:So(t.root,n._nodes),tags:new Set(n._nodes.flatMap(e=>e.tags)),children:n.children,historyValue:n.historyValue||{},matches:Bc,hasTag:Fc,can:$c,getMeta:Nc,toJSON:Vc}}function Pt(n,t={}){return Kn({...n,...t},n.machine)}function zc(n){if(typeof n!="object"||n===null)return{};const t={};for(const e in n){const r=n[e];Array.isArray(r)&&(t[e]=r.map(s=>({id:s.id})))}return t}function Wc(n,t){const{_nodes:e,tags:r,machine:s,children:o,context:i,can:a,hasTag:c,matches:d,getMeta:l,toJSON:g,...f}=n,u={};for(const p in o){const m=o[p];u[p]={snapshot:m.getPersistedSnapshot(t),src:m.src,systemId:m._systemId,syncSnapshot:m._syncSnapshot}}return{...f,context:Uo(i),children:u,historyValue:zc(f.historyValue)}}function Uo(n){let t;for(const e in n){const r=n[e];if(r&&typeof r=="object")if("sessionId"in r&&"send"in r&&"ref"in r)t??(t=Array.isArray(n)?n.slice():{...n}),t[e]={xstate$$type:Vr,id:r.id};else{const s=Uo(r);s!==r&&(t??(t=Array.isArray(n)?n.slice():{...n}),t[e]=s)}}return t??n}function Jc(n,t,e,r,{event:s,id:o,delay:i},{internalQueue:a}){const c=t.machine.implementations.delays;if(typeof s=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${s}" }) instead`);const d=typeof s=="function"?s(e,r):s;let l;if(typeof i=="string"){const g=c&&c[i];l=typeof g=="function"?g(e,r):g}else l=typeof i=="function"?i(e,r):i;return typeof l!="number"&&a.push(d),[t,{event:d,id:o,delay:l},void 0]}function Gc(n,t){const{event:e,delay:r,id:s}=t;if(typeof r=="number"){n.defer(()=>{const o=n.self;n.system.scheduler.schedule(o,o,e,r,s)});return}}function Kc(n,t){function e(r,s){}return e.type="xstate.raise",e.event=n,e.id=t==null?void 0:t.id,e.delay=t==null?void 0:t.delay,e.resolve=Jc,e.execute=Gc,e}function qc(n,{machine:t,context:e},r,s){const o=(i,a)=>{if(typeof i=="string"){const c=Fr(t,i);if(!c)throw new Error(`Actor logic '${i}' not implemented in machine '${t.id}'`);const d=bn(c,{id:a==null?void 0:a.id,parent:n.self,syncSnapshot:a==null?void 0:a.syncSnapshot,input:typeof(a==null?void 0:a.input)=="function"?a.input({context:e,event:r,self:n.self}):a==null?void 0:a.input,src:i,systemId:a==null?void 0:a.systemId});return s[d.id]=d,d}else return bn(i,{id:a==null?void 0:a.id,parent:n.self,syncSnapshot:a==null?void 0:a.syncSnapshot,input:a==null?void 0:a.input,src:i,systemId:a==null?void 0:a.systemId})};return(i,a)=>{const c=o(i,a);return s[c.id]=c,n.defer(()=>{c._processingStatus!==Ce.Stopped&&c.start()}),c}}function Yc(n,t,e,r,{assignment:s}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const o={},i={context:t.context,event:e.event,spawn:qc(n,t,e.event,o),self:n.self,system:n.system};let a={};if(typeof s=="function")a=s(i,r);else for(const d of Object.keys(s)){const l=s[d];a[d]=typeof l=="function"?l(i,r):l}const c=Object.assign({},t.context,a);return[Pt(t,{context:c,children:Object.keys(o).length?{...t.children,...o}:t.children}),void 0,void 0]}function wn(n){function t(e,r){}return t.type="xstate.assign",t.assignment=n,t.resolve=Yc,t}const Po=new WeakMap;function Qt(n,t,e){let r=Po.get(n);return r?t in r||(r[t]=e()):(r={[t]:e()},Po.set(n,r)),r[t]}const Qc={},_n=n=>typeof n=="string"?{type:n}:typeof n=="function"?"resolve"in n?{type:n.type}:{type:n.name}:n;class qn{constructor(t,e){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=e._parent,this.key=e._key,this.machine=e._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(ao),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?go(this.config.states,(r,s)=>new qn(r,{_parent:this,_key:s,_machine:this.machine})):Qc,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=pt(this.config.entry).slice(),this.exit=pt(this.config.exit).slice(),this.meta=this.config.meta,this.output=this.type==="final"||!this.parent?this.config.output:void 0,this.tags=pt(t.tags).slice()}_initialize(){this.transitions=vc(this),this.config.always&&(this.always=Jt(this.config.always).map(t=>Rt(this,co,t))),Object.keys(this.states).forEach(t=>{this.states[t]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(_n),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(t=>`#${t.id}`),source:`#${this.id}`,actions:this.initial.actions.map(_n),eventType:null})}:void 0,history:this.history,states:go(this.states,t=>t.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(t=>({...t,actions:t.actions.map(_n)})),entry:this.entry.map(_n),exit:this.exit.map(_n),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return Qt(this,"invoke",()=>pt(this.config.invoke).map((t,e)=>{const{src:r,systemId:s}=t,o=t.id??mo(this.id,e),i=typeof r=="string"?r:`xstate.invoke.${mo(this.id,e)}`;return{...t,src:i,id:o,systemId:s,toJSON(){const{onDone:a,onError:c,...d}=t;return{...d,type:"xstate.invoke",src:i,id:o}}}}))}get on(){return Qt(this,"on",()=>[...this.transitions].flatMap(([t,e])=>e.map(r=>[t,r])).reduce((t,[e,r])=>(t[e]=t[e]||[],t[e].push(r),t),{}))}get after(){return Qt(this,"delayedTransitions",()=>_c(this))}get initial(){return Qt(this,"initial",()=>xc(this,this.config.initial))}next(t,e){const r=e.type,s=[];let o;const i=Qt(this,`candidates-${r}`,()=>wc(this,r));for(const a of i){const{guard:c}=a,d=t.context;let l=!1;try{l=!c||Nr(c,d,e,t)}catch(g){const f=typeof c=="string"?c:typeof c=="object"?c.type:void 0;throw new Error(`Unable to evaluate guard ${f?`'${f}' `:""}in transition for event '${r}' in state node '${this.id}':
${g.message}`)}if(l){s.push(...a.actions),o=a;break}}return o?[o]:void 0}get events(){return Qt(this,"events",()=>{const{states:t}=this,e=new Set(this.ownEvents);if(t)for(const r of Object.keys(t)){const s=t[r];if(s.states)for(const o of s.events)e.add(`${o}`)}return Array.from(e)})}get ownEvents(){const t=new Set([...this.transitions.keys()].filter(e=>this.transitions.get(e).some(r=>!(!r.target&&!r.actions.length&&!r.reenter))));return Array.from(t)}}const Zc="#";class Zr{constructor(t,e){this.config=t,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=t.id||"(machine)",this.implementations={actors:(e==null?void 0:e.actors)??{},actions:(e==null?void 0:e.actions)??{},delays:(e==null?void 0:e.delays)??{},guards:(e==null?void 0:e.guards)??{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new qn(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(t){const{actions:e,guards:r,actors:s,delays:o}=this.implementations;return new Zr(this.config,{actions:{...e,...t.actions},guards:{...r,...t.guards},actors:{...s,...t.actors},delays:{...o,...t.delays}})}resolveState(t){const e=Tc(this.root,t.value),r=zn(Gn(this.root,e));return Kn({_nodes:[...r],context:t.context||{},children:{},status:Wr(r,this.root)?"done":t.status||"active",output:t.output,error:t.error,historyValue:t.historyValue},this)}transition(t,e,r){return Qr(t,e,r,[]).snapshot}microstep(t,e,r){return Qr(t,e,r,[]).microstates}getTransitionData(t,e){return Jr(this.root,t.value,t,e)||[]}getPreInitialState(t,e,r){const{context:s}=this.config,o=Kn({context:typeof s!="function"&&s?s:{},_nodes:[this.root],children:{},status:"active"},this);return typeof s=="function"?Yt(o,e,t,[wn(({spawn:i,event:a,self:c})=>s({spawn:i,input:a.input,self:c}))],r,void 0):o}getInitialSnapshot(t,e){const r=uo(e),s=[],o=this.getPreInitialState(t,r,s),i=qr([{target:[...Eo(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],o,t,r,!0,s),{snapshot:a}=Qr(i,r,t,s);return a}start(t){Object.values(t.children).forEach(e=>{e.getSnapshot().status==="active"&&e.start()})}getStateNodeById(t){const e=Tr(t),r=e.slice(1),s=Wn(e[0])?e[0].slice(Zc.length):e[0],o=this.idMap.get(s);if(!o)throw new Error(`Child state node '#${s}' does not exist on machine '${this.id}'`);return Jn(o,r)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(t,e){return Wc(t,e)}restoreSnapshot(t,e){const r={},s=t.children;Object.keys(s).forEach(g=>{const f=s[g],u=f.snapshot,p=f.src,m=typeof p=="string"?Fr(this,p):p;if(!m)return;const C=bn(m,{id:g,parent:e.self,syncSnapshot:f.syncSnapshot,snapshot:u,src:p,systemId:f.systemId});r[g]=C});function o(g,f){if(f instanceof qn)return f;try{return g.machine.getStateNodeById(f.id)}catch{}}function i(g,f){if(!f||typeof f!="object")return{};const u={};for(const p in f){const m=f[p];for(const C of m){const D=o(g,C);D&&(u[p]??(u[p]=[]),u[p].push(D))}}return u}const a=i(this.root,t.historyValue),c=Kn({...t,children:r,_nodes:Array.from(zn(Gn(this.root,t.value))),historyValue:a},this),d=new Set;function l(g,f){if(!d.has(g)){d.add(g);for(const u in g){const p=g[u];if(p&&typeof p=="object"){if("xstate$$type"in p&&p.xstate$$type===Vr){g[u]=f[p.id];continue}l(p,f)}}}}return l(c.context,r),c}}function Xc(n,t){const e=pt(t);if(!e.includes(n.type)){const r=e.length===1?`type "${e[0]}"`:`one of types "${e.join('", "')}"`;throw new Error(`Expected event ${JSON.stringify(n)} to have ${r}`)}}function eh(n,t){return new Zr(n,t)}function th({schemas:n,actors:t,actions:e,guards:r,delays:s}){return{createMachine:o=>eh({...o,schemas:n},{actors:t,actions:e,guards:r,delays:s})}}const nh={timeout:1/0};function rh(n,t,e){const r={...nh,...e};return new Promise((s,o)=>{const{signal:i}=r;if(i!=null&&i.aborted){o(i.reason);return}let a=!1;const c=r.timeout===1/0?void 0:setTimeout(()=>{d(),o(new Error(`Timeout of ${r.timeout} ms exceeded`))},r.timeout),d=()=>{clearTimeout(c),a=!0,f==null||f.unsubscribe(),g&&i.removeEventListener("abort",g)};function l(u){t(u)&&(d(),s(u))}let g,f;l(n.getSnapshot()),!a&&(i&&(g=()=>{d(),o(i.reason)},i.addEventListener("abort",g)),f=n.subscribe({next:l,error:u=>{d(),o(u)},complete:()=>{d(),o(new Error("Actor terminated without satisfying predicate"))}}),a&&f.unsubscribe())})}let Yn;const sh=new Uint8Array(16);function oh(){if(!Yn&&(Yn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Yn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Yn(sh)}const ih=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Qn(n){return typeof n=="string"&&ih.test(n)}const ve=[];for(let n=0;n<256;++n)ve.push((n+256).toString(16).slice(1));function Do(n,t=0){return ve[n[t+0]]+ve[n[t+1]]+ve[n[t+2]]+ve[n[t+3]]+"-"+ve[n[t+4]]+ve[n[t+5]]+"-"+ve[n[t+6]]+ve[n[t+7]]+"-"+ve[n[t+8]]+ve[n[t+9]]+"-"+ve[n[t+10]]+ve[n[t+11]]+ve[n[t+12]]+ve[n[t+13]]+ve[n[t+14]]+ve[n[t+15]]}function ah(n,t=0){const e=Do(n,t);if(!Qn(e))throw TypeError("Stringified UUID is invalid");return e}function ch(n){if(!Qn(n))throw TypeError("Invalid UUID");let t;const e=new Uint8Array(16);return e[0]=(t=parseInt(n.slice(0,8),16))>>>24,e[1]=t>>>16&255,e[2]=t>>>8&255,e[3]=t&255,e[4]=(t=parseInt(n.slice(9,13),16))>>>8,e[5]=t&255,e[6]=(t=parseInt(n.slice(14,18),16))>>>8,e[7]=t&255,e[8]=(t=parseInt(n.slice(19,23),16))>>>8,e[9]=t&255,e[10]=(t=parseInt(n.slice(24,36),16))/1099511627776&255,e[11]=t/4294967296&255,e[12]=t>>>24&255,e[13]=t>>>16&255,e[14]=t>>>8&255,e[15]=t&255,e}const hh=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Lo={randomUUID:hh};function To(n,t,e){if(Lo.randomUUID&&!t&&!n)return Lo.randomUUID();n=n||{};const r=n.random||(n.rng||oh)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){e=e||0;for(let s=0;s<16;++s)t[e+s]=r[s];return t}return Do(r)}var qe={},oe={},Se={},Mo={},Zn={},Bo;function uh(){return Bo||(Bo=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.crypto=void 0,Zn.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0),Zn}var Fo;function $o(){return Fo||(Fo=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.wrapXOFConstructorWithOpts=n.wrapConstructorWithOpts=n.wrapConstructor=n.Hash=n.nextTick=n.swap32IfBE=n.byteSwapIfBE=n.swap8IfBE=n.isLE=void 0,n.isBytes=e,n.anumber=r,n.abytes=s,n.ahash=o,n.aexists=i,n.aoutput=a,n.u8=c,n.u32=d,n.clean=l,n.createView=g,n.rotr=f,n.rotl=u,n.byteSwap=p,n.byteSwap32=m,n.bytesToHex=R,n.hexToBytes=L,n.asyncLoop=J,n.utf8ToBytes=B,n.bytesToUtf8=k,n.toBytes=H,n.kdfInputToBytes=M,n.concatBytes=K,n.checkOpts=y,n.createHasher=S,n.createOptHasher=E,n.createXOFer=A,n.randomBytes=N;const t=uh();function e(w){return w instanceof Uint8Array||ArrayBuffer.isView(w)&&w.constructor.name==="Uint8Array"}function r(w){if(!Number.isSafeInteger(w)||w<0)throw new Error("positive integer expected, got "+w)}function s(w,...O){if(!e(w))throw new Error("Uint8Array expected");if(O.length>0&&!O.includes(w.length))throw new Error("Uint8Array expected of length "+O+", got length="+w.length)}function o(w){if(typeof w!="function"||typeof w.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");r(w.outputLen),r(w.blockLen)}function i(w,O=!0){if(w.destroyed)throw new Error("Hash instance has been destroyed");if(O&&w.finished)throw new Error("Hash#digest() has already been called")}function a(w,O){s(w);const P=O.outputLen;if(w.length<P)throw new Error("digestInto() expects output buffer of length at least "+P)}function c(w){return new Uint8Array(w.buffer,w.byteOffset,w.byteLength)}function d(w){return new Uint32Array(w.buffer,w.byteOffset,Math.floor(w.byteLength/4))}function l(...w){for(let O=0;O<w.length;O++)w[O].fill(0)}function g(w){return new DataView(w.buffer,w.byteOffset,w.byteLength)}function f(w,O){return w<<32-O|w>>>O}function u(w,O){return w<<O|w>>>32-O>>>0}n.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function p(w){return w<<24&4278190080|w<<8&16711680|w>>>8&65280|w>>>24&255}n.swap8IfBE=n.isLE?w=>w:w=>p(w),n.byteSwapIfBE=n.swap8IfBE;function m(w){for(let O=0;O<w.length;O++)w[O]=p(w[O]);return w}n.swap32IfBE=n.isLE?w=>w:m;const C=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",D=Array.from({length:256},(w,O)=>O.toString(16).padStart(2,"0"));function R(w){if(s(w),C)return w.toHex();let O="";for(let P=0;P<w.length;P++)O+=D[w[P]];return O}const I={_0:48,_9:57,A:65,F:70,a:97,f:102};function W(w){if(w>=I._0&&w<=I._9)return w-I._0;if(w>=I.A&&w<=I.F)return w-(I.A-10);if(w>=I.a&&w<=I.f)return w-(I.a-10)}function L(w){if(typeof w!="string")throw new Error("hex string expected, got "+typeof w);if(C)return Uint8Array.fromHex(w);const O=w.length,P=O/2;if(O%2)throw new Error("hex string expected, got unpadded hex of length "+O);const F=new Uint8Array(P);for(let ne=0,xe=0;ne<P;ne++,xe+=2){const fn=W(w.charCodeAt(xe)),We=W(w.charCodeAt(xe+1));if(fn===void 0||We===void 0){const Qe=w[xe]+w[xe+1];throw new Error('hex string expected, got non-hex character "'+Qe+'" at index '+xe)}F[ne]=fn*16+We}return F}const T=async()=>{};n.nextTick=T;async function J(w,O,P){let F=Date.now();for(let ne=0;ne<w;ne++){P(ne);const xe=Date.now()-F;xe>=0&&xe<O||(await(0,n.nextTick)(),F+=xe)}}function B(w){if(typeof w!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(w))}function k(w){return new TextDecoder().decode(w)}function H(w){return typeof w=="string"&&(w=B(w)),s(w),w}function M(w){return typeof w=="string"&&(w=B(w)),s(w),w}function K(...w){let O=0;for(let F=0;F<w.length;F++){const ne=w[F];s(ne),O+=ne.length}const P=new Uint8Array(O);for(let F=0,ne=0;F<w.length;F++){const xe=w[F];P.set(xe,ne),ne+=xe.length}return P}function y(w,O){if(O!==void 0&&{}.toString.call(O)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(w,O)}class j{}n.Hash=j;function S(w){const O=F=>w().update(H(F)).digest(),P=w();return O.outputLen=P.outputLen,O.blockLen=P.blockLen,O.create=()=>w(),O}function E(w){const O=(F,ne)=>w(ne).update(H(F)).digest(),P=w({});return O.outputLen=P.outputLen,O.blockLen=P.blockLen,O.create=F=>w(F),O}function A(w){const O=(F,ne)=>w(ne).update(H(F)).digest(),P=w({});return O.outputLen=P.outputLen,O.blockLen=P.blockLen,O.create=F=>w(F),O}n.wrapConstructor=S,n.wrapConstructorWithOpts=E,n.wrapXOFConstructorWithOpts=A;function N(w=32){if(t.crypto&&typeof t.crypto.getRandomValues=="function")return t.crypto.getRandomValues(new Uint8Array(w));if(t.crypto&&typeof t.crypto.randomBytes=="function")return Uint8Array.from(t.crypto.randomBytes(w));throw new Error("crypto.getRandomValues must be defined")}}(Mo)),Mo}var Vo;function dh(){if(Vo)return Se;Vo=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.SHA512_IV=Se.SHA384_IV=Se.SHA224_IV=Se.SHA256_IV=Se.HashMD=void 0,Se.setBigUint64=t,Se.Chi=e,Se.Maj=r;const n=$o();function t(o,i,a,c){if(typeof o.setBigUint64=="function")return o.setBigUint64(i,a,c);const d=BigInt(32),l=BigInt(4294967295),g=Number(a>>d&l),f=Number(a&l),u=c?4:0,p=c?0:4;o.setUint32(i+u,g,c),o.setUint32(i+p,f,c)}function e(o,i,a){return o&i^~o&a}function r(o,i,a){return o&i^o&a^i&a}class s extends n.Hash{constructor(i,a,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=i,this.outputLen=a,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(i),this.view=(0,n.createView)(this.buffer)}update(i){(0,n.aexists)(this),i=(0,n.toBytes)(i),(0,n.abytes)(i);const{view:a,buffer:c,blockLen:d}=this,l=i.length;for(let g=0;g<l;){const f=Math.min(d-this.pos,l-g);if(f===d){const u=(0,n.createView)(i);for(;d<=l-g;g+=d)this.process(u,g);continue}c.set(i.subarray(g,g+f),this.pos),this.pos+=f,g+=f,this.pos===d&&(this.process(a,0),this.pos=0)}return this.length+=i.length,this.roundClean(),this}digestInto(i){(0,n.aexists)(this),(0,n.aoutput)(i,this),this.finished=!0;const{buffer:a,view:c,blockLen:d,isLE:l}=this;let{pos:g}=this;a[g++]=128,(0,n.clean)(this.buffer.subarray(g)),this.padOffset>d-g&&(this.process(c,0),g=0);for(let C=g;C<d;C++)a[C]=0;t(c,d-8,BigInt(this.length*8),l),this.process(c,0);const f=(0,n.createView)(i),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const p=u/4,m=this.get();if(p>m.length)throw new Error("_sha2: outputLen bigger than state");for(let C=0;C<p;C++)f.setUint32(4*C,m[C],l)}digest(){const{buffer:i,outputLen:a}=this;this.digestInto(i);const c=i.slice(0,a);return this.destroy(),c}_cloneInto(i){i||(i=new this.constructor),i.set(...this.get());const{blockLen:a,buffer:c,length:d,finished:l,destroyed:g,pos:f}=this;return i.destroyed=g,i.finished=l,i.length=d,i.pos=f,d%a&&i.buffer.set(c),i}clone(){return this._cloneInto()}}return Se.HashMD=s,Se.SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Se.SHA224_IV=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),Se.SHA384_IV=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Se.SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Se}var G={},No;function fh(){if(No)return G;No=1,Object.defineProperty(G,"__esModule",{value:!0}),G.toBig=G.shrSL=G.shrSH=G.rotrSL=G.rotrSH=G.rotrBL=G.rotrBH=G.rotr32L=G.rotr32H=G.rotlSL=G.rotlSH=G.rotlBL=G.rotlBH=G.add5L=G.add5H=G.add4L=G.add4H=G.add3L=G.add3H=void 0,G.add=D,G.fromBig=e,G.split=r;const n=BigInt(2**32-1),t=BigInt(32);function e(k,H=!1){return H?{h:Number(k&n),l:Number(k>>t&n)}:{h:Number(k>>t&n)|0,l:Number(k&n)|0}}function r(k,H=!1){const M=k.length;let K=new Uint32Array(M),y=new Uint32Array(M);for(let j=0;j<M;j++){const{h:S,l:E}=e(k[j],H);[K[j],y[j]]=[S,E]}return[K,y]}const s=(k,H)=>BigInt(k>>>0)<<t|BigInt(H>>>0);G.toBig=s;const o=(k,H,M)=>k>>>M;G.shrSH=o;const i=(k,H,M)=>k<<32-M|H>>>M;G.shrSL=i;const a=(k,H,M)=>k>>>M|H<<32-M;G.rotrSH=a;const c=(k,H,M)=>k<<32-M|H>>>M;G.rotrSL=c;const d=(k,H,M)=>k<<64-M|H>>>M-32;G.rotrBH=d;const l=(k,H,M)=>k>>>M-32|H<<64-M;G.rotrBL=l;const g=(k,H)=>H;G.rotr32H=g;const f=(k,H)=>k;G.rotr32L=f;const u=(k,H,M)=>k<<M|H>>>32-M;G.rotlSH=u;const p=(k,H,M)=>H<<M|k>>>32-M;G.rotlSL=p;const m=(k,H,M)=>H<<M-32|k>>>64-M;G.rotlBH=m;const C=(k,H,M)=>k<<M-32|H>>>64-M;G.rotlBL=C;function D(k,H,M,K){const y=(H>>>0)+(K>>>0);return{h:k+M+(y/4294967296|0)|0,l:y|0}}const R=(k,H,M)=>(k>>>0)+(H>>>0)+(M>>>0);G.add3L=R;const I=(k,H,M,K)=>H+M+K+(k/2**32|0)|0;G.add3H=I;const W=(k,H,M,K)=>(k>>>0)+(H>>>0)+(M>>>0)+(K>>>0);G.add4L=W;const L=(k,H,M,K,y)=>H+M+K+y+(k/2**32|0)|0;G.add4H=L;const T=(k,H,M,K,y)=>(k>>>0)+(H>>>0)+(M>>>0)+(K>>>0)+(y>>>0);G.add5L=T;const J=(k,H,M,K,y,j)=>H+M+K+y+j+(k/2**32|0)|0;G.add5H=J;const B={fromBig:e,split:r,toBig:s,shrSH:o,shrSL:i,rotrSH:a,rotrSL:c,rotrBH:d,rotrBL:l,rotr32H:g,rotr32L:f,rotlSH:u,rotlSL:p,rotlBH:m,rotlBL:C,add:D,add3L:R,add3H:I,add4L:W,add4H:L,add5H:J,add5L:T};return G.default=B,G}var zo;function lh(){if(zo)return oe;zo=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.sha512_224=oe.sha512_256=oe.sha384=oe.sha512=oe.sha224=oe.sha256=oe.SHA512_256=oe.SHA512_224=oe.SHA384=oe.SHA512=oe.SHA224=oe.SHA256=void 0;const n=dh(),t=fh(),e=$o(),r=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),s=new Uint32Array(64);class o extends n.HashMD{constructor(I=32){super(64,I,8,!1),this.A=n.SHA256_IV[0]|0,this.B=n.SHA256_IV[1]|0,this.C=n.SHA256_IV[2]|0,this.D=n.SHA256_IV[3]|0,this.E=n.SHA256_IV[4]|0,this.F=n.SHA256_IV[5]|0,this.G=n.SHA256_IV[6]|0,this.H=n.SHA256_IV[7]|0}get(){const{A:I,B:W,C:L,D:T,E:J,F:B,G:k,H}=this;return[I,W,L,T,J,B,k,H]}set(I,W,L,T,J,B,k,H){this.A=I|0,this.B=W|0,this.C=L|0,this.D=T|0,this.E=J|0,this.F=B|0,this.G=k|0,this.H=H|0}process(I,W){for(let y=0;y<16;y++,W+=4)s[y]=I.getUint32(W,!1);for(let y=16;y<64;y++){const j=s[y-15],S=s[y-2],E=(0,e.rotr)(j,7)^(0,e.rotr)(j,18)^j>>>3,A=(0,e.rotr)(S,17)^(0,e.rotr)(S,19)^S>>>10;s[y]=A+s[y-7]+E+s[y-16]|0}let{A:L,B:T,C:J,D:B,E:k,F:H,G:M,H:K}=this;for(let y=0;y<64;y++){const j=(0,e.rotr)(k,6)^(0,e.rotr)(k,11)^(0,e.rotr)(k,25),S=K+j+(0,n.Chi)(k,H,M)+r[y]+s[y]|0,E=((0,e.rotr)(L,2)^(0,e.rotr)(L,13)^(0,e.rotr)(L,22))+(0,n.Maj)(L,T,J)|0;K=M,M=H,H=k,k=B+S|0,B=J,J=T,T=L,L=S+E|0}L=L+this.A|0,T=T+this.B|0,J=J+this.C|0,B=B+this.D|0,k=k+this.E|0,H=H+this.F|0,M=M+this.G|0,K=K+this.H|0,this.set(L,T,J,B,k,H,M,K)}roundClean(){(0,e.clean)(s)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,e.clean)(this.buffer)}}oe.SHA256=o;class i extends o{constructor(){super(28),this.A=n.SHA224_IV[0]|0,this.B=n.SHA224_IV[1]|0,this.C=n.SHA224_IV[2]|0,this.D=n.SHA224_IV[3]|0,this.E=n.SHA224_IV[4]|0,this.F=n.SHA224_IV[5]|0,this.G=n.SHA224_IV[6]|0,this.H=n.SHA224_IV[7]|0}}oe.SHA224=i;const a=t.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(R=>BigInt(R))),c=a[0],d=a[1],l=new Uint32Array(80),g=new Uint32Array(80);class f extends n.HashMD{constructor(I=64){super(128,I,16,!1),this.Ah=n.SHA512_IV[0]|0,this.Al=n.SHA512_IV[1]|0,this.Bh=n.SHA512_IV[2]|0,this.Bl=n.SHA512_IV[3]|0,this.Ch=n.SHA512_IV[4]|0,this.Cl=n.SHA512_IV[5]|0,this.Dh=n.SHA512_IV[6]|0,this.Dl=n.SHA512_IV[7]|0,this.Eh=n.SHA512_IV[8]|0,this.El=n.SHA512_IV[9]|0,this.Fh=n.SHA512_IV[10]|0,this.Fl=n.SHA512_IV[11]|0,this.Gh=n.SHA512_IV[12]|0,this.Gl=n.SHA512_IV[13]|0,this.Hh=n.SHA512_IV[14]|0,this.Hl=n.SHA512_IV[15]|0}get(){const{Ah:I,Al:W,Bh:L,Bl:T,Ch:J,Cl:B,Dh:k,Dl:H,Eh:M,El:K,Fh:y,Fl:j,Gh:S,Gl:E,Hh:A,Hl:N}=this;return[I,W,L,T,J,B,k,H,M,K,y,j,S,E,A,N]}set(I,W,L,T,J,B,k,H,M,K,y,j,S,E,A,N){this.Ah=I|0,this.Al=W|0,this.Bh=L|0,this.Bl=T|0,this.Ch=J|0,this.Cl=B|0,this.Dh=k|0,this.Dl=H|0,this.Eh=M|0,this.El=K|0,this.Fh=y|0,this.Fl=j|0,this.Gh=S|0,this.Gl=E|0,this.Hh=A|0,this.Hl=N|0}process(I,W){for(let P=0;P<16;P++,W+=4)l[P]=I.getUint32(W),g[P]=I.getUint32(W+=4);for(let P=16;P<80;P++){const F=l[P-15]|0,ne=g[P-15]|0,xe=t.rotrSH(F,ne,1)^t.rotrSH(F,ne,8)^t.shrSH(F,ne,7),fn=t.rotrSL(F,ne,1)^t.rotrSL(F,ne,8)^t.shrSL(F,ne,7),We=l[P-2]|0,Qe=g[P-2]|0,br=t.rotrSH(We,Qe,19)^t.rotrBH(We,Qe,61)^t.shrSH(We,Qe,6),Is=t.rotrSL(We,Qe,19)^t.rotrBL(We,Qe,61)^t.shrSL(We,Qe,6),mr=t.add4L(fn,Is,g[P-7],g[P-16]),As=t.add4H(mr,xe,br,l[P-7],l[P-16]);l[P]=As|0,g[P]=mr|0}let{Ah:L,Al:T,Bh:J,Bl:B,Ch:k,Cl:H,Dh:M,Dl:K,Eh:y,El:j,Fh:S,Fl:E,Gh:A,Gl:N,Hh:w,Hl:O}=this;for(let P=0;P<80;P++){const F=t.rotrSH(y,j,14)^t.rotrSH(y,j,18)^t.rotrBH(y,j,41),ne=t.rotrSL(y,j,14)^t.rotrSL(y,j,18)^t.rotrBL(y,j,41),xe=y&S^~y&A,fn=j&E^~j&N,We=t.add5L(O,ne,fn,d[P],g[P]),Qe=t.add5H(We,w,F,xe,c[P],l[P]),br=We|0,Is=t.rotrSH(L,T,28)^t.rotrBH(L,T,34)^t.rotrBH(L,T,39),mr=t.rotrSL(L,T,28)^t.rotrBL(L,T,34)^t.rotrBL(L,T,39),As=L&J^L&k^J&k,Ru=T&B^T&H^B&H;w=A|0,O=N|0,A=S|0,N=E|0,S=y|0,E=j|0,{h:y,l:j}=t.add(M|0,K|0,Qe|0,br|0),M=k|0,K=H|0,k=J|0,H=B|0,J=L|0,B=T|0;const Pi=t.add3L(br,mr,Ru);L=t.add3H(Pi,Qe,Is,As),T=Pi|0}({h:L,l:T}=t.add(this.Ah|0,this.Al|0,L|0,T|0)),{h:J,l:B}=t.add(this.Bh|0,this.Bl|0,J|0,B|0),{h:k,l:H}=t.add(this.Ch|0,this.Cl|0,k|0,H|0),{h:M,l:K}=t.add(this.Dh|0,this.Dl|0,M|0,K|0),{h:y,l:j}=t.add(this.Eh|0,this.El|0,y|0,j|0),{h:S,l:E}=t.add(this.Fh|0,this.Fl|0,S|0,E|0),{h:A,l:N}=t.add(this.Gh|0,this.Gl|0,A|0,N|0),{h:w,l:O}=t.add(this.Hh|0,this.Hl|0,w|0,O|0),this.set(L,T,J,B,k,H,M,K,y,j,S,E,A,N,w,O)}roundClean(){(0,e.clean)(l,g)}destroy(){(0,e.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}oe.SHA512=f;class u extends f{constructor(){super(48),this.Ah=n.SHA384_IV[0]|0,this.Al=n.SHA384_IV[1]|0,this.Bh=n.SHA384_IV[2]|0,this.Bl=n.SHA384_IV[3]|0,this.Ch=n.SHA384_IV[4]|0,this.Cl=n.SHA384_IV[5]|0,this.Dh=n.SHA384_IV[6]|0,this.Dl=n.SHA384_IV[7]|0,this.Eh=n.SHA384_IV[8]|0,this.El=n.SHA384_IV[9]|0,this.Fh=n.SHA384_IV[10]|0,this.Fl=n.SHA384_IV[11]|0,this.Gh=n.SHA384_IV[12]|0,this.Gl=n.SHA384_IV[13]|0,this.Hh=n.SHA384_IV[14]|0,this.Hl=n.SHA384_IV[15]|0}}oe.SHA384=u;const p=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),m=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class C extends f{constructor(){super(28),this.Ah=p[0]|0,this.Al=p[1]|0,this.Bh=p[2]|0,this.Bl=p[3]|0,this.Ch=p[4]|0,this.Cl=p[5]|0,this.Dh=p[6]|0,this.Dl=p[7]|0,this.Eh=p[8]|0,this.El=p[9]|0,this.Fh=p[10]|0,this.Fl=p[11]|0,this.Gh=p[12]|0,this.Gl=p[13]|0,this.Hh=p[14]|0,this.Hl=p[15]|0}}oe.SHA512_224=C;class D extends f{constructor(){super(32),this.Ah=m[0]|0,this.Al=m[1]|0,this.Bh=m[2]|0,this.Bl=m[3]|0,this.Ch=m[4]|0,this.Cl=m[5]|0,this.Dh=m[6]|0,this.Dl=m[7]|0,this.Eh=m[8]|0,this.El=m[9]|0,this.Fh=m[10]|0,this.Fl=m[11]|0,this.Gh=m[12]|0,this.Gl=m[13]|0,this.Hh=m[14]|0,this.Hl=m[15]|0}}return oe.SHA512_256=D,oe.sha256=(0,e.createHasher)(()=>new o),oe.sha224=(0,e.createHasher)(()=>new i),oe.sha512=(0,e.createHasher)(()=>new f),oe.sha384=(0,e.createHasher)(()=>new u),oe.sha512_256=(0,e.createHasher)(()=>new D),oe.sha512_224=(0,e.createHasher)(()=>new C),oe}var Wo;function gh(){if(Wo)return qe;Wo=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.sha224=qe.SHA224=qe.sha256=qe.SHA256=void 0;const n=lh();return qe.SHA256=n.SHA256,qe.sha256=n.sha256,qe.SHA224=n.SHA224,qe.sha224=n.sha224,qe}var Xr,Jo;function ph(){if(Jo)return Xr;Jo=1;function n(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),r=0;r<e.length;r++)e[r]=255;for(var s=0;s<t.length;s++){var o=t.charAt(s),i=o.charCodeAt(0);if(e[i]!==255)throw new TypeError(o+" is ambiguous");e[i]=s}var a=t.length,c=t.charAt(0),d=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function g(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var m=0,C=0,D=0,R=p.length;D!==R&&p[D]===0;)D++,m++;for(var I=(R-D)*l+1>>>0,W=new Uint8Array(I);D!==R;){for(var L=p[D],T=0,J=I-1;(L!==0||T<C)&&J!==-1;J--,T++)L+=256*W[J]>>>0,W[J]=L%a>>>0,L=L/a>>>0;if(L!==0)throw new Error("Non-zero carry");C=T,D++}for(var B=I-C;B!==I&&W[B]===0;)B++;for(var k=c.repeat(m);B<I;++B)k+=t.charAt(W[B]);return k}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;for(var m=0,C=0,D=0;p[m]===c;)C++,m++;for(var R=(p.length-m)*d+1>>>0,I=new Uint8Array(R);p[m];){var W=p.charCodeAt(m);if(W>255)return;var L=e[W];if(L===255)return;for(var T=0,J=R-1;(L!==0||T<D)&&J!==-1;J--,T++)L+=a*I[J]>>>0,I[J]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");D=T,m++}for(var B=R-D;B!==R&&I[B]===0;)B++;for(var k=new Uint8Array(C+(R-B)),H=C;B!==R;)k[H++]=I[B++];return k}function u(p){var m=f(p);if(m)return m;throw new Error("Non-base"+a+" character")}return{encode:g,decodeUnsafe:f,decode:u}}return Xr=n,Xr}var Go,Ko;function yh(){return Ko||(Ko=1,Go=ph()("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")),Go}var es,qo;function bh(){if(qo)return es;qo=1;var n=yh();return es=function(t){function e(i){var a=Uint8Array.from(i),c=t(a),d=a.length+4,l=new Uint8Array(d);return l.set(a,0),l.set(c.subarray(0,4),a.length),n.encode(l,d)}function r(i){var a=i.slice(0,-4),c=i.slice(-4),d=t(a);if(!(c[0]^d[0]|c[1]^d[1]|c[2]^d[2]|c[3]^d[3]))return a}function s(i){var a=n.decodeUnsafe(i);if(a)return r(a)}function o(i){var a=n.decode(i),c=r(a);if(!c)throw new Error("Invalid checksum");return c}return{encode:e,decode:o,decodeUnsafe:s}},es}var ts,Yo;function mh(){if(Yo)return ts;Yo=1;var{sha256:n}=gh(),t=bh();function e(r){return n(n(r))}return ts=t(e),ts}var wh=mh();const Dt=jr(wh),_h=n=>{if(n.length%2!==0)throw new Error("Hex string must have an even length");const t=new Uint8Array(n.length/2);for(let e=0;e<n.length;e+=2)t[e>>1]=parseInt(n.slice(e,e+2),16);return t},Qo=n=>Array.from(n,t=>t.toString(16).padStart(2,"0")).join(""),Xn="automerge:",vn=n=>{const[t,e,...r]=n.split("#");if(r.length>0)throw new Error("Invalid URL: contains multiple heads sections");const s=new RegExp(`^${Xn}(\\w+)$`),[,o]=t.match(s)||[],i=o,a=ti(i);if(!a)throw new Error("Invalid document URL: "+n);if(e===void 0)return{binaryDocumentId:a,documentId:i};const c=e===""?[]:e.split("|"),d=c.map(l=>{try{return Qo(Dt.decode(l))}catch{throw new Error(`Invalid head in URL: ${l}`)}});return{binaryDocumentId:a,hexHeads:d,documentId:i,heads:c}},Zo=n=>{if(n instanceof Uint8Array||typeof n=="string")return Xn+(n instanceof Uint8Array?er(n):n);const{documentId:t,heads:e=void 0}=n;if(t===void 0)throw new Error("Invalid documentId: "+t);const r=t instanceof Uint8Array?er(t):t;let s=`${Xn}${r}`;return e!==void 0&&(e.forEach(o=>{try{Dt.decode(o)}catch{throw new Error(`Invalid head: ${o}`)}}),s+="#"+e.join("|")),s},Xo=n=>{if(typeof n!="string"||!n||!n.startsWith(Xn))return!1;try{const{documentId:t,heads:e}=vn(n);return!(!ei(t)||e&&!e.every(r=>{try{return Dt.decode(r),!0}catch{return!1}}))}catch{return!1}},ei=n=>{if(typeof n!="string")return!1;const t=ti(n);if(t===void 0)return!1;const e=ah(t);return Qn(e)},vh=n=>typeof n=="string"&&Qn(n),xh=()=>{const n=To(null,new Uint8Array(16));return Zo({documentId:n})},ti=n=>Dt.decodeUnsafe(n),er=n=>Dt.encode(n),tt=n=>n.map(t=>Dt.encode(_h(t))),Lt=n=>n.map(t=>Qo(Dt.decode(t))),tr=n=>{if(n instanceof Uint8Array)return er(n);if(Xo(n))return vn(n).documentId;if(ei(n))return n;if(vh(n)){console.warn("Future versions will not support UUIDs as document IDs; use Automerge URLs instead.");const t=ch(n);return er(t)}throw new Error(`Invalid AutomergeUrl: '${n}'`)};let ns;try{ns=new TextDecoder}catch{}let $,Tt,x=0;const Sh=105,Ih=57342,Ah=57343,ni=57337,ri=6,Zt={};let xn=11281e4,yt=1681e4,Y={},he,nr,rr=0,Sn=0,pe,Ve,fe=[],rs=[],Oe,Ae,In,si={useRecords:!1,mapsAsObjects:!0},An=!1,oi=2;try{new Function("")}catch{oi=1/0}class En{constructor(t){if(t&&((t.keyMap||t._keyMap)&&!t.useRecords&&(t.useRecords=!1,t.mapsAsObjects=!0),t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.getStructures&&(t.getShared=t.getStructures),t.getShared&&!t.structures&&((t.structures=[]).uninitialized=!0),t.keyMap)){this.mapKey=new Map;for(let[e,r]of Object.entries(t.keyMap))this.mapKey.set(r,e)}Object.assign(this,t)}decodeKey(t){return this.keyMap&&this.mapKey.get(t)||t}encodeKey(t){return this.keyMap&&this.keyMap.hasOwnProperty(t)?this.keyMap[t]:t}encodeKeys(t){if(!this._keyMap)return t;let e=new Map;for(let[r,s]of Object.entries(t))e.set(this._keyMap.hasOwnProperty(r)?this._keyMap[r]:r,s);return e}decodeKeys(t){if(!this._keyMap||t.constructor.name!="Map")return t;if(!this._mapKey){this._mapKey=new Map;for(let[r,s]of Object.entries(this._keyMap))this._mapKey.set(s,r)}let e={};return t.forEach((r,s)=>e[Ne(this._mapKey.has(s)?this._mapKey.get(s):s)]=r),e}mapDecode(t,e){let r=this.decode(t);if(this._keyMap)switch(r.constructor.name){case"Array":return r.map(s=>this.decodeKeys(s))}return r}decode(t,e){if($)return di(()=>(cs(),this?this.decode(t,e):En.prototype.decode.call(si,t,e)));Tt=e>-1?e:t.length,x=0,Sn=0,nr=null,pe=null,$=t;try{Ae=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw $=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof En){if(Y=this,Oe=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return he=this.structures,sr();(!he||he.length>0)&&(he=[])}else Y=si,(!he||he.length>0)&&(he=[]),Oe=null;return sr()}decodeMultiple(t,e){let r,s=0;try{let o=t.length;An=!0;let i=this?this.decode(t,o):us.decode(t,o);if(e){if(e(i)===!1)return;for(;x<o;)if(s=x,e(sr())===!1)return}else{for(r=[i];x<o;)s=x,r.push(sr());return r}}catch(o){throw o.lastPosition=s,o.values=r,o}finally{An=!1,cs()}}}function sr(){try{let n=Q();if(pe){if(x>=pe.postBundlePosition){let t=new Error("Unexpected bundle position");throw t.incomplete=!0,t}x=pe.postBundlePosition,pe=null}if(x==Tt)he=null,$=null,Ve&&(Ve=null);else if(x>Tt){let t=new Error("Unexpected end of CBOR data");throw t.incomplete=!0,t}else if(!An)throw new Error("Data read, but end of buffer not reached");return n}catch(n){throw cs(),(n instanceof RangeError||n.message.startsWith("Unexpected end of buffer"))&&(n.incomplete=!0),n}}function Q(){let n=$[x++],t=n>>5;if(n=n&31,n>23)switch(n){case 24:n=$[x++];break;case 25:if(t==7)return Oh();n=Ae.getUint16(x),x+=2;break;case 26:if(t==7){let e=Ae.getFloat32(x);if(Y.useFloat32>2){let r=hs[($[x]&127)<<1|$[x+1]>>7];return x+=4,(r*e+(e>0?.5:-.5)>>0)/r}return x+=4,e}n=Ae.getUint32(x),x+=4;break;case 27:if(t==7){let e=Ae.getFloat64(x);return x+=8,e}if(t>1){if(Ae.getUint32(x)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");n=Ae.getUint32(x+4)}else Y.int64AsNumber?(n=Ae.getUint32(x)*4294967296,n+=Ae.getUint32(x+4)):n=Ae.getBigUint64(x);x+=8;break;case 31:switch(t){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let e=[],r,s=0;for(;(r=Q())!=Zt;){if(s>=xn)throw new Error(`Array length exceeds ${xn}`);e[s++]=r}return t==4?e:t==3?e.join(""):Buffer.concat(e);case 5:let o;if(Y.mapsAsObjects){let i={},a=0;if(Y.keyMap)for(;(o=Q())!=Zt;){if(a++>=yt)throw new Error(`Property count exceeds ${yt}`);i[Ne(Y.decodeKey(o))]=Q()}else for(;(o=Q())!=Zt;){if(a++>=yt)throw new Error(`Property count exceeds ${yt}`);i[Ne(o)]=Q()}return i}else{In&&(Y.mapsAsObjects=!0,In=!1);let i=new Map;if(Y.keyMap){let a=0;for(;(o=Q())!=Zt;){if(a++>=yt)throw new Error(`Map size exceeds ${yt}`);i.set(Y.decodeKey(o),Q())}}else{let a=0;for(;(o=Q())!=Zt;){if(a++>=yt)throw new Error(`Map size exceeds ${yt}`);i.set(o,Q())}}return i}case 7:return Zt;default:throw new Error("Invalid major type for indefinite length "+t)}default:throw new Error("Unknown token "+n)}switch(t){case 0:return n;case 1:return~n;case 2:return Ch(n);case 3:if(Sn>=x)return nr.slice(x-rr,(x+=n)-rr);if(Sn==0&&Tt<140&&n<32){let s=n<16?ai(n):kh(n);if(s!=null)return s}return Eh(n);case 4:if(n>=xn)throw new Error(`Array length exceeds ${xn}`);let e=new Array(n);for(let s=0;s<n;s++)e[s]=Q();return e;case 5:if(n>=yt)throw new Error(`Map size exceeds ${xn}`);if(Y.mapsAsObjects){let s={};if(Y.keyMap)for(let o=0;o<n;o++)s[Ne(Y.decodeKey(Q()))]=Q();else for(let o=0;o<n;o++)s[Ne(Q())]=Q();return s}else{In&&(Y.mapsAsObjects=!0,In=!1);let s=new Map;if(Y.keyMap)for(let o=0;o<n;o++)s.set(Y.decodeKey(Q()),Q());else for(let o=0;o<n;o++)s.set(Q(),Q());return s}case 6:if(n>=ni){let s=he[n&8191];if(s)return s.read||(s.read=ss(s)),s.read();if(n<65536){if(n==Ah){let o=en(),i=Q(),a=Q();is(i,a);let c={};if(Y.keyMap)for(let d=2;d<o;d++){let l=Y.decodeKey(a[d-2]);c[Ne(l)]=Q()}else for(let d=2;d<o;d++){let l=a[d-2];c[Ne(l)]=Q()}return c}else if(n==Ih){let o=en(),i=Q();for(let a=2;a<o;a++)is(i++,Q());return Q()}else if(n==ni)return Dh();if(Y.getShared&&(as(),s=he[n&8191],s))return s.read||(s.read=ss(s)),s.read()}}let r=fe[n];if(r)return r.handlesRead?r(Q):r(Q());{let s=Q();for(let o=0;o<rs.length;o++){let i=rs[o](n,s);if(i!==void 0)return i}return new Mt(s,n)}case 7:switch(n){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let s=(Oe||Bt())[n];if(s!==void 0)return s;throw new Error("Unknown token "+n)}default:if(isNaN(n)){let s=new Error("Unexpected end of CBOR data");throw s.incomplete=!0,s}throw new Error("Unknown CBOR token "+n)}}const ii=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function ss(n){if(!n)throw new Error("Structure is required in record definition");function t(){let e=$[x++];if(e=e&31,e>23)switch(e){case 24:e=$[x++];break;case 25:e=Ae.getUint16(x),x+=2;break;case 26:e=Ae.getUint32(x),x+=4;break;default:throw new Error("Expected array header, but got "+$[x-1])}let r=this.compiledReader;for(;r;){if(r.propertyCount===e)return r(Q);r=r.next}if(this.slowReads++>=oi){let o=this.length==e?this:this.slice(0,e);return r=Y.keyMap?new Function("r","return {"+o.map(i=>Y.decodeKey(i)).map(i=>ii.test(i)?Ne(i)+":r()":"["+JSON.stringify(i)+"]:r()").join(",")+"}"):new Function("r","return {"+o.map(i=>ii.test(i)?Ne(i)+":r()":"["+JSON.stringify(i)+"]:r()").join(",")+"}"),this.compiledReader&&(r.next=this.compiledReader),r.propertyCount=e,this.compiledReader=r,r(Q)}let s={};if(Y.keyMap)for(let o=0;o<e;o++)s[Ne(Y.decodeKey(this[o]))]=Q();else for(let o=0;o<e;o++)s[Ne(this[o])]=Q();return s}return n.slowReads=0,t}function Ne(n){if(typeof n=="string")return n==="__proto__"?"__proto_":n;if(typeof n=="number"||typeof n=="boolean"||typeof n=="bigint")return n.toString();if(n==null)return n+"";throw new Error("Invalid property name type "+typeof n)}let Eh=os;function os(n){let t;if(n<16&&(t=ai(n)))return t;if(n>64&&ns)return ns.decode($.subarray(x,x+=n));const e=x+n,r=[];for(t="";x<e;){const s=$[x++];if((s&128)===0)r.push(s);else if((s&224)===192){const o=$[x++]&63;r.push((s&31)<<6|o)}else if((s&240)===224){const o=$[x++]&63,i=$[x++]&63;r.push((s&31)<<12|o<<6|i)}else if((s&248)===240){const o=$[x++]&63,i=$[x++]&63,a=$[x++]&63;let c=(s&7)<<18|o<<12|i<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(s);r.length>=4096&&(t+=_e.apply(String,r),r.length=0)}return r.length>0&&(t+=_e.apply(String,r)),t}let _e=String.fromCharCode;function kh(n){let t=x,e=new Array(n);for(let r=0;r<n;r++){const s=$[x++];if((s&128)>0){x=t;return}e[r]=s}return _e.apply(String,e)}function ai(n){if(n<4)if(n<2){if(n===0)return"";{let t=$[x++];if((t&128)>1){x-=1;return}return _e(t)}}else{let t=$[x++],e=$[x++];if((t&128)>0||(e&128)>0){x-=2;return}if(n<3)return _e(t,e);let r=$[x++];if((r&128)>0){x-=3;return}return _e(t,e,r)}else{let t=$[x++],e=$[x++],r=$[x++],s=$[x++];if((t&128)>0||(e&128)>0||(r&128)>0||(s&128)>0){x-=4;return}if(n<6){if(n===4)return _e(t,e,r,s);{let o=$[x++];if((o&128)>0){x-=5;return}return _e(t,e,r,s,o)}}else if(n<8){let o=$[x++],i=$[x++];if((o&128)>0||(i&128)>0){x-=6;return}if(n<7)return _e(t,e,r,s,o,i);let a=$[x++];if((a&128)>0){x-=7;return}return _e(t,e,r,s,o,i,a)}else{let o=$[x++],i=$[x++],a=$[x++],c=$[x++];if((o&128)>0||(i&128)>0||(a&128)>0||(c&128)>0){x-=8;return}if(n<10){if(n===8)return _e(t,e,r,s,o,i,a,c);{let d=$[x++];if((d&128)>0){x-=9;return}return _e(t,e,r,s,o,i,a,c,d)}}else if(n<12){let d=$[x++],l=$[x++];if((d&128)>0||(l&128)>0){x-=10;return}if(n<11)return _e(t,e,r,s,o,i,a,c,d,l);let g=$[x++];if((g&128)>0){x-=11;return}return _e(t,e,r,s,o,i,a,c,d,l,g)}else{let d=$[x++],l=$[x++],g=$[x++],f=$[x++];if((d&128)>0||(l&128)>0||(g&128)>0||(f&128)>0){x-=12;return}if(n<14){if(n===12)return _e(t,e,r,s,o,i,a,c,d,l,g,f);{let u=$[x++];if((u&128)>0){x-=13;return}return _e(t,e,r,s,o,i,a,c,d,l,g,f,u)}}else{let u=$[x++],p=$[x++];if((u&128)>0||(p&128)>0){x-=14;return}if(n<15)return _e(t,e,r,s,o,i,a,c,d,l,g,f,u,p);let m=$[x++];if((m&128)>0){x-=15;return}return _e(t,e,r,s,o,i,a,c,d,l,g,f,u,p,m)}}}}}function Ch(n){return Y.copyBuffers?Uint8Array.prototype.slice.call($,x,x+=n):$.subarray(x,x+=n)}let ci=new Float32Array(1),or=new Uint8Array(ci.buffer,0,4);function Oh(){let n=$[x++],t=$[x++],e=(n&127)>>2;if(e===31)return t||n&3?NaN:n&128?-1/0:1/0;if(e===0){let r=((n&3)<<8|t)/16777216;return n&128?-r:r}return or[3]=n&128|(e>>1)+56,or[2]=(n&7)<<5|t>>3,or[1]=t<<5,or[0]=0,ci[0]}new Array(4096);class Mt{constructor(t,e){this.value=t,this.tag=e}}fe[0]=n=>new Date(n),fe[1]=n=>new Date(Math.round(n*1e3)),fe[2]=n=>{let t=BigInt(0);for(let e=0,r=n.byteLength;e<r;e++)t=BigInt(n[e])+(t<<BigInt(8));return t},fe[3]=n=>BigInt(-1)-fe[2](n),fe[4]=n=>+(n[1]+"e"+n[0]),fe[5]=n=>n[1]*Math.exp(n[0]*Math.log(2));const is=(n,t)=>{n=n-57344;let e=he[n];e&&e.isShared&&((he.restoreStructures||(he.restoreStructures=[]))[n]=e),he[n]=t,t.read=ss(t)};fe[Sh]=n=>{let t=n.length,e=n[1];is(n[0],e);let r={};for(let s=2;s<t;s++){let o=e[s-2];r[Ne(o)]=n[s]}return r},fe[14]=n=>pe?pe[0].slice(pe.position0,pe.position0+=n):new Mt(n,14),fe[15]=n=>pe?pe[1].slice(pe.position1,pe.position1+=n):new Mt(n,15);let Hh={Error,RegExp};fe[27]=n=>(Hh[n[0]]||Error)(n[1],n[2]);const hi=n=>{if($[x++]!=132){let e=new Error("Packed values structure must be followed by a 4 element array");throw $.length<x&&(e.incomplete=!0),e}let t=n();if(!t||!t.length){let e=new Error("Packed values structure must be followed by a 4 element array");throw e.incomplete=!0,e}return Oe=Oe?t.concat(Oe.slice(t.length)):t,Oe.prefixes=n(),Oe.suffixes=n(),n()};hi.handlesRead=!0,fe[51]=hi,fe[ri]=n=>{if(!Oe)if(Y.getShared)as();else return new Mt(n,ri);if(typeof n=="number")return Oe[16+(n>=0?2*n:-2*n-1)];let t=new Error("No support for non-integer packed references yet");throw n===void 0&&(t.incomplete=!0),t},fe[28]=n=>{Ve||(Ve=new Map,Ve.id=0);let t=Ve.id++,e=x,r=$[x],s;r>>5==4?s=[]:s={};let o={target:s};Ve.set(t,o);let i=n();return o.used?(Object.getPrototypeOf(s)!==Object.getPrototypeOf(i)&&(x=e,s=i,Ve.set(t,{target:s}),i=n()),Object.assign(s,i)):(o.target=i,i)},fe[28].handlesRead=!0,fe[29]=n=>{let t=Ve.get(n);return t.used=!0,t.target},fe[258]=n=>new Set(n),(fe[259]=n=>(Y.mapsAsObjects&&(Y.mapsAsObjects=!1,In=!0),n())).handlesRead=!0;function Xt(n,t){return typeof n=="string"?n+t:n instanceof Array?n.concat(t):Object.assign({},n,t)}function Bt(){if(!Oe)if(Y.getShared)as();else throw new Error("No packed values available");return Oe}const jh=1399353956;rs.push((n,t)=>{if(n>=225&&n<=255)return Xt(Bt().prefixes[n-224],t);if(n>=28704&&n<=32767)return Xt(Bt().prefixes[n-28672],t);if(n>=1879052288&&n<=2147483647)return Xt(Bt().prefixes[n-1879048192],t);if(n>=216&&n<=223)return Xt(t,Bt().suffixes[n-216]);if(n>=27647&&n<=28671)return Xt(t,Bt().suffixes[n-27639]);if(n>=1811940352&&n<=1879048191)return Xt(t,Bt().suffixes[n-1811939328]);if(n==jh)return{packedValues:Oe,structures:he.slice(0),version:t};if(n==55799)return t});const Rh=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,ui=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],Uh=[64,68,69,70,71,72,77,78,79,85,86];for(let n=0;n<ui.length;n++)Ph(ui[n],Uh[n]);function Ph(n,t){let e="get"+n.name.slice(0,-5),r;typeof n=="function"?r=n.BYTES_PER_ELEMENT:n=null;for(let s=0;s<2;s++){if(!s&&r==1)continue;let o=r==2?1:r==4?2:r==8?3:0;fe[s?t:t-4]=r==1||s==Rh?i=>{if(!n)throw new Error("Could not find typed array for code "+t);return!Y.copyBuffers&&(r===1||r===2&&!(i.byteOffset&1)||r===4&&!(i.byteOffset&3)||r===8&&!(i.byteOffset&7))?new n(i.buffer,i.byteOffset,i.byteLength>>o):new n(Uint8Array.prototype.slice.call(i,0).buffer)}:i=>{if(!n)throw new Error("Could not find typed array for code "+t);let a=new DataView(i.buffer,i.byteOffset,i.byteLength),c=i.length>>o,d=new n(c),l=a[e];for(let g=0;g<c;g++)d[g]=l.call(a,g<<o,s);return d}}}function Dh(){let n=en(),t=x+Q();for(let r=2;r<n;r++){let s=en();x+=s}let e=x;return x=t,pe=[os(en()),os(en())],pe.position0=0,pe.position1=0,pe.postBundlePosition=x,x=e,Q()}function en(){let n=$[x++]&31;if(n>23)switch(n){case 24:n=$[x++];break;case 25:n=Ae.getUint16(x),x+=2;break;case 26:n=Ae.getUint32(x),x+=4;break}return n}function as(){if(Y.getShared){let n=di(()=>($=null,Y.getShared()))||{},t=n.structures||[];Y.sharedVersion=n.version,Oe=Y.sharedValues=n.packedValues,he===!0?Y.structures=he=t:he.splice.apply(he,[0,t.length].concat(t))}}function di(n){let t=Tt,e=x,r=rr,s=Sn,o=nr,i=Ve,a=pe,c=new Uint8Array($.slice(0,Tt)),d=he,l=Y,g=An,f=n();return Tt=t,x=e,rr=r,Sn=s,nr=o,Ve=i,pe=a,$=c,An=g,he=d,Y=l,Ae=new DataView($.buffer,$.byteOffset,$.byteLength),f}function cs(){$=null,Ve=null,he=null}const hs=new Array(147);for(let n=0;n<256;n++)hs[n]=+("1e"+Math.floor(45.15-n*.30103));let us=new En({useRecords:!1});const fi=us.decode;us.decodeMultiple;let ir;try{ir=new TextEncoder}catch{}let ds,li;const ar=typeof globalThis=="object"&&globalThis.Buffer,kn=typeof ar<"u",fs=kn?ar.allocUnsafeSlow:Uint8Array,gi=kn?ar:Uint8Array,pi=256,yi=kn?4294967296:2144337920;let ls,_,ae,b=0,xt,ye=null;const Lh=61440,Th=/[\u0080-\uFFFF]/,Ue=Symbol("record-id");class bi extends En{constructor(t){super(t),this.offset=0;let e,r,s,o,i;t=t||{};let a=gi.prototype.utf8Write?function(y,j,S){return _.utf8Write(y,j,S)}:ir&&ir.encodeInto?function(y,j){return ir.encodeInto(y,_.subarray(j)).written}:!1,c=this,d=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=d?128:0),l>8190)throw new Error("Maximum maxSharedStructure is 8190");let g=t.sequential;g&&(l=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let f,u,p=t.sharedValues,m;if(p){m=Object.create(null);for(let y=0,j=p.length;y<j;y++)m[p[y]]=y}let C=[],D=0,R=0;this.mapEncode=function(y,j){if(this._keyMap&&!this._mapped)switch(y.constructor.name){case"Array":y=y.map(S=>this.encodeKeys(S));break}return this.encode(y,j)},this.encode=function(y,j){if(_||(_=new fs(8192),ae=new DataView(_.buffer,0,8192),b=0),xt=_.length-10,xt-b<2048?(_=new fs(_.length),ae=new DataView(_.buffer,0,_.length),xt=_.length-10,b=0):j===vi&&(b=b+7&2147483640),e=b,c.useSelfDescribedHeader&&(ae.setUint32(b,3654940416),b+=3),i=c.structuredClone?new Map:null,c.bundleStrings&&typeof y!="string"?(ye=[],ye.size=1/0):ye=null,r=c.structures,r){if(r.uninitialized){let E=c.getShared()||{};c.structures=r=E.structures||[],c.sharedVersion=E.version;let A=c.sharedValues=E.packedValues;if(A){m={};for(let N=0,w=A.length;N<w;N++)m[A[N]]=N}}let S=r.length;if(S>l&&!g&&(S=l),!r.transitions){r.transitions=Object.create(null);for(let E=0;E<S;E++){let A=r[E];if(!A)continue;let N,w=r.transitions;for(let O=0,P=A.length;O<P;O++){w[Ue]===void 0&&(w[Ue]=E);let F=A[O];N=w[F],N||(N=w[F]=Object.create(null)),w=N}w[Ue]=E|1048576}}g||(r.nextId=S)}if(s&&(s=!1),o=r||[],u=m,t.pack){let S=new Map;if(S.values=[],S.encoder=c,S.maxValues=t.maxPrivatePackedValues||(m?16:1/0),S.objectMap=m||!1,S.samplingPackedValues=f,cr(y,S),S.values.length>0){_[b++]=216,_[b++]=51,nt(4);let E=S.values;I(E),nt(0),nt(0),u=Object.create(m||null);for(let A=0,N=E.length;A<N;A++)u[E[A]]=A}}ls=j&bs;try{if(ls)return;if(I(y),ye&&_i(e,I),c.offset=b,i&&i.idsToInsert){b+=i.idsToInsert.length*2,b>xt&&L(b),c.offset=b;let S=Fh(_.subarray(e,b),i.idsToInsert);return i=null,S}return j&vi?(_.start=e,_.end=b,_):_.subarray(e,b)}finally{if(r){if(R<10&&R++,r.length>l&&(r.length=l),D>1e4)r.transitions=null,R=0,D=0,C.length>0&&(C=[]);else if(C.length>0&&!g){for(let S=0,E=C.length;S<E;S++)C[S][Ue]=void 0;C=[]}}if(s&&c.saveShared){c.structures.length>l&&(c.structures=c.structures.slice(0,l));let S=_.subarray(e,b);return c.updateSharedData()===!1?c.encode(y):S}j&$h&&(b=e)}},this.findCommonStringsToPack=()=>(f=new Map,m||(m=Object.create(null)),y=>{let j=y&&y.threshold||4,S=this.pack?y.maxPrivatePackedValues||16:0;p||(p=this.sharedValues=[]);for(let[E,A]of f)A.count>j&&(m[E]=S++,p.push(E),s=!0);for(;this.saveShared&&this.updateSharedData()===!1;);f=null});const I=y=>{b>xt&&(_=L(b));var j=typeof y,S;if(j==="string"){if(u){let w=u[y];if(w>=0){w<16?_[b++]=w+224:(_[b++]=198,w&1?I(15-w>>1):I(w-16>>1));return}else if(f&&!t.pack){let O=f.get(y);O?O.count++:f.set(y,{count:1})}}let E=y.length;if(ye&&E>=4&&E<1024){if((ye.size+=E)>Lh){let O,P=(ye[0]?ye[0].length*3+ye[1].length:0)+10;b+P>xt&&(_=L(b+P)),_[b++]=217,_[b++]=223,_[b++]=249,_[b++]=ye.position?132:130,_[b++]=26,O=b-e,b+=4,ye.position&&_i(e,I),ye=["",""],ye.size=0,ye.position=O}let w=Th.test(y);ye[w?0:1]+=y,_[b++]=w?206:207,I(E);return}let A;E<32?A=1:E<256?A=2:E<65536?A=3:A=5;let N=E*3;if(b+N>xt&&(_=L(b+N)),E<64||!a){let w,O,P,F=b+A;for(w=0;w<E;w++)O=y.charCodeAt(w),O<128?_[F++]=O:O<2048?(_[F++]=O>>6|192,_[F++]=O&63|128):(O&64512)===55296&&((P=y.charCodeAt(w+1))&64512)===56320?(O=65536+((O&1023)<<10)+(P&1023),w++,_[F++]=O>>18|240,_[F++]=O>>12&63|128,_[F++]=O>>6&63|128,_[F++]=O&63|128):(_[F++]=O>>12|224,_[F++]=O>>6&63|128,_[F++]=O&63|128);S=F-b-A}else S=a(y,b+A,N);S<24?_[b++]=96|S:S<256?(A<2&&_.copyWithin(b+2,b+1,b+1+S),_[b++]=120,_[b++]=S):S<65536?(A<3&&_.copyWithin(b+3,b+2,b+2+S),_[b++]=121,_[b++]=S>>8,_[b++]=S&255):(A<5&&_.copyWithin(b+5,b+3,b+3+S),_[b++]=122,ae.setUint32(b,S),b+=4),b+=S}else if(j==="number")if(!this.alwaysUseFloat&&y>>>0===y)y<24?_[b++]=y:y<256?(_[b++]=24,_[b++]=y):y<65536?(_[b++]=25,_[b++]=y>>8,_[b++]=y&255):(_[b++]=26,ae.setUint32(b,y),b+=4);else if(!this.alwaysUseFloat&&y>>0===y)y>=-24?_[b++]=31-y:y>=-256?(_[b++]=56,_[b++]=~y):y>=-65536?(_[b++]=57,ae.setUint16(b,~y),b+=2):(_[b++]=58,ae.setUint32(b,~y),b+=4);else{let E;if((E=this.useFloat32)>0&&y<4294967296&&y>=-2147483648){_[b++]=250,ae.setFloat32(b,y);let A;if(E<4||(A=y*hs[(_[b]&127)<<1|_[b+1]>>7])>>0===A){b+=4;return}else b--}_[b++]=251,ae.setFloat64(b,y),b+=8}else if(j==="object")if(!y)_[b++]=246;else{if(i){let A=i.get(y);if(A){if(_[b++]=216,_[b++]=29,_[b++]=25,!A.references){let N=i.idsToInsert||(i.idsToInsert=[]);A.references=[],N.push(A)}A.references.push(b-e),b+=2;return}else i.set(y,{offset:b-e})}let E=y.constructor;if(E===Object)W(y);else if(E===Array){S=y.length,S<24?_[b++]=128|S:nt(S);for(let A=0;A<S;A++)I(y[A])}else if(E===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(_[b++]=217,_[b++]=1,_[b++]=3),S=y.size,S<24?_[b++]=160|S:S<256?(_[b++]=184,_[b++]=S):S<65536?(_[b++]=185,_[b++]=S>>8,_[b++]=S&255):(_[b++]=186,ae.setUint32(b,S),b+=4),c.keyMap)for(let[A,N]of y)I(c.encodeKey(A)),I(N);else for(let[A,N]of y)I(A),I(N);else{for(let A=0,N=ds.length;A<N;A++){let w=li[A];if(y instanceof w){let O=ds[A],P=O.tag;P==null&&(P=O.getTag&&O.getTag.call(this,y)),P<24?_[b++]=192|P:P<256?(_[b++]=216,_[b++]=P):P<65536?(_[b++]=217,_[b++]=P>>8,_[b++]=P&255):P>-1&&(_[b++]=218,ae.setUint32(b,P),b+=4),O.encode.call(this,y,I,L);return}}if(y[Symbol.iterator]){if(ls){let A=new Error("Iterable should be serialized as iterator");throw A.iteratorNotHandled=!0,A}_[b++]=159;for(let A of y)I(A);_[b++]=255;return}if(y[Symbol.asyncIterator]||gs(y)){let A=new Error("Iterable/blob should be serialized as iterator");throw A.iteratorNotHandled=!0,A}if(this.useToJSON&&y.toJSON){const A=y.toJSON();if(A!==y)return I(A)}W(y)}}else if(j==="boolean")_[b++]=y?245:244;else if(j==="bigint"){if(y<BigInt(1)<<BigInt(64)&&y>=0)_[b++]=27,ae.setBigUint64(b,y);else if(y>-(BigInt(1)<<BigInt(64))&&y<0)_[b++]=59,ae.setBigUint64(b,-y-BigInt(1));else if(this.largeBigIntToFloat)_[b++]=251,ae.setFloat64(b,Number(y));else{y>=BigInt(0)?_[b++]=194:(_[b++]=195,y=BigInt(-1)-y);let E=[];for(;y;)E.push(Number(y&BigInt(255))),y>>=BigInt(8);ps(new Uint8Array(E.reverse()),L);return}b+=8}else if(j==="undefined")_[b++]=247;else throw new Error("Unknown type: "+j)},W=this.useRecords===!1?this.variableMapSize?y=>{let j=Object.keys(y),S=Object.values(y),E=j.length;if(E<24?_[b++]=160|E:E<256?(_[b++]=184,_[b++]=E):E<65536?(_[b++]=185,_[b++]=E>>8,_[b++]=E&255):(_[b++]=186,ae.setUint32(b,E),b+=4),c.keyMap)for(let A=0;A<E;A++)I(c.encodeKey(j[A])),I(S[A]);else for(let A=0;A<E;A++)I(j[A]),I(S[A])}:y=>{_[b++]=185;let j=b-e;b+=2;let S=0;if(c.keyMap)for(let E in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(E))&&(I(c.encodeKey(E)),I(y[E]),S++);else for(let E in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(E))&&(I(E),I(y[E]),S++);_[j+++e]=S>>8,_[j+e]=S&255}:(y,j)=>{let S,E=o.transitions||(o.transitions=Object.create(null)),A=0,N=0,w,O;if(this.keyMap){O=Object.keys(y).map(F=>this.encodeKey(F)),N=O.length;for(let F=0;F<N;F++){let ne=O[F];S=E[ne],S||(S=E[ne]=Object.create(null),A++),E=S}}else for(let F in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(F))&&(S=E[F],S||(E[Ue]&1048576&&(w=E[Ue]&65535),S=E[F]=Object.create(null),A++),E=S,N++);let P=E[Ue];if(P!==void 0)P&=65535,_[b++]=217,_[b++]=P>>8|224,_[b++]=P&255;else if(O||(O=E.__keys__||(E.__keys__=Object.keys(y))),w===void 0?(P=o.nextId++,P||(P=0,o.nextId=1),P>=pi&&(o.nextId=(P=l)+1)):P=w,o[P]=O,P<l){_[b++]=217,_[b++]=P>>8|224,_[b++]=P&255,E=o.transitions;for(let F=0;F<N;F++)(E[Ue]===void 0||E[Ue]&1048576)&&(E[Ue]=P),E=E[O[F]];E[Ue]=P|1048576,s=!0}else{if(E[Ue]=P,ae.setUint32(b,3655335680),b+=3,A&&(D+=R*A),C.length>=pi-l&&(C.shift()[Ue]=void 0),C.push(E),nt(N+2),I(57344+P),I(O),j)return;for(let F in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(F))&&I(y[F]);return}if(N<24?_[b++]=128|N:nt(N),!j)for(let F in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(F))&&I(y[F])},L=y=>{let j;if(y>16777216){if(y-e>yi)throw new Error("Encoded buffer would be larger than maximum buffer size");j=Math.min(yi,Math.round(Math.max((y-e)*(y>67108864?1.25:2),4194304)/4096)*4096)}else j=(Math.max(y-e<<2,_.length-1)>>12)+1<<12;let S=new fs(j);return ae=new DataView(S.buffer,0,j),_.copy?_.copy(S,0,e,y):S.set(_.slice(e,y)),b-=e,e=0,xt=S.length-10,_=S};let T=100,J=1e3;this.encodeAsIterable=function(y,j){return M(y,j,B)},this.encodeAsAsyncIterable=function(y,j){return M(y,j,K)};function*B(y,j,S){let E=y.constructor;if(E===Object){let A=c.useRecords!==!1;A?W(y,!0):mi(Object.keys(y).length,160);for(let N in y){let w=y[N];A||I(N),w&&typeof w=="object"?j[N]?yield*B(w,j[N]):yield*k(w,j,N):I(w)}}else if(E===Array){let A=y.length;nt(A);for(let N=0;N<A;N++){let w=y[N];w&&(typeof w=="object"||b-e>T)?j.element?yield*B(w,j.element):yield*k(w,j,"element"):I(w)}}else if(y[Symbol.iterator]&&!y.buffer){_[b++]=159;for(let A of y)A&&(typeof A=="object"||b-e>T)?j.element?yield*B(A,j.element):yield*k(A,j,"element"):I(A);_[b++]=255}else gs(y)?(mi(y.size,64),yield _.subarray(e,b),yield y,H()):y[Symbol.asyncIterator]?(_[b++]=159,yield _.subarray(e,b),yield y,H(),_[b++]=255):I(y);S&&b>e?yield _.subarray(e,b):b-e>T&&(yield _.subarray(e,b),H())}function*k(y,j,S){let E=b-e;try{I(y),b-e>T&&(yield _.subarray(e,b),H())}catch(A){if(A.iteratorNotHandled)j[S]={},b=e+E,yield*B.call(this,y,j[S]);else throw A}}function H(){T=J,c.encode(null,bs)}function M(y,j,S){return j&&j.chunkThreshold?T=J=j.chunkThreshold:T=100,y&&typeof y=="object"?(c.encode(null,bs),S(y,c.iterateProperties||(c.iterateProperties={}),!0)):[c.encode(y)]}async function*K(y,j){for(let S of B(y,j,!0)){let E=S.constructor;if(E===gi||E===Uint8Array)yield S;else if(gs(S)){let A=S.stream().getReader(),N;for(;!(N=await A.read()).done;)yield N.value}else if(S[Symbol.asyncIterator])for await(let A of S)H(),A?yield*K(A,j.async||(j.async={})):yield c.encode(A);else yield S}}}useBuffer(t){_=t,ae=new DataView(_.buffer,_.byteOffset,_.byteLength),b=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let t=this.sharedVersion||0;this.sharedVersion=t+1;let e=this.structures.slice(0),r=new wi(e,this.sharedValues,this.sharedVersion),s=this.saveShared(r,o=>(o&&o.version||0)==t);return s===!1?(r=this.getShared()||{},this.structures=r.structures||[],this.sharedValues=r.packedValues,this.sharedVersion=r.version,this.structures.nextId=this.structures.length):e.forEach((o,i)=>this.structures[i]=o),s}}function mi(n,t){n<24?_[b++]=t|n:n<256?(_[b++]=t|24,_[b++]=n):n<65536?(_[b++]=t|25,_[b++]=n>>8,_[b++]=n&255):(_[b++]=t|26,ae.setUint32(b,n),b+=4)}class wi{constructor(t,e,r){this.structures=t,this.packedValues=e,this.version=r}}function nt(n){n<24?_[b++]=128|n:n<256?(_[b++]=152,_[b++]=n):n<65536?(_[b++]=153,_[b++]=n>>8,_[b++]=n&255):(_[b++]=154,ae.setUint32(b,n),b+=4)}const Mh=typeof Blob>"u"?function(){}:Blob;function gs(n){if(n instanceof Mh)return!0;let t=n[Symbol.toStringTag];return t==="Blob"||t==="File"}function cr(n,t){switch(typeof n){case"string":if(n.length>3){if(t.objectMap[n]>-1||t.values.length>=t.maxValues)return;let r=t.get(n);if(r)++r.count==2&&t.values.push(n);else if(t.set(n,{count:1}),t.samplingPackedValues){let s=t.samplingPackedValues.get(n);s?s.count++:t.samplingPackedValues.set(n,{count:1})}}break;case"object":if(n)if(n instanceof Array)for(let r=0,s=n.length;r<s;r++)cr(n[r],t);else{let r=!t.encoder.useRecords;for(var e in n)n.hasOwnProperty(e)&&(r&&cr(e,t),cr(n[e],t))}break;case"function":console.log(n)}}const Bh=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;li=[Date,Set,Error,RegExp,Mt,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,wi],ds=[{tag:1,encode(n,t){let e=n.getTime()/1e3;(this.useTimestamp32||n.getMilliseconds()===0)&&e>=0&&e<4294967296?(_[b++]=26,ae.setUint32(b,e),b+=4):(_[b++]=251,ae.setFloat64(b,e),b+=8)}},{tag:258,encode(n,t){let e=Array.from(n);t(e)}},{tag:27,encode(n,t){t([n.name,n.message])}},{tag:27,encode(n,t){t(["RegExp",n.source,n.flags])}},{getTag(n){return n.tag},encode(n,t){t(n.value)}},{encode(n,t,e){ps(n,e)}},{getTag(n){if(n.constructor===Uint8Array&&(this.tagUint8Array||kn&&this.tagUint8Array!==!1))return 64},encode(n,t,e){ps(n,e)}},rt(68,1),rt(69,2),rt(70,4),rt(71,8),rt(72,1),rt(77,2),rt(78,4),rt(79,8),rt(85,4),rt(86,8),{encode(n,t){let e=n.packedValues||[],r=n.structures||[];if(e.values.length>0){_[b++]=216,_[b++]=51,nt(4);let s=e.values;t(s),nt(0),nt(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let o=0,i=s.length;o<i;o++)packedObjectMap[s[o]]=o}if(r){ae.setUint32(b,3655335424),b+=3;let s=r.slice(0);s.unshift(57344),s.push(new Mt(n.version,1399353956)),t(s)}else t(new Mt(n.version,1399353956))}}];function rt(n,t){return!Bh&&t>1&&(n-=4),{tag:n,encode:function(e,r){let s=e.byteLength,o=e.byteOffset||0,i=e.buffer||e;r(kn?ar.from(i,o,s):new Uint8Array(i,o,s))}}}function ps(n,t){let e=n.byteLength;e<24?_[b++]=64+e:e<256?(_[b++]=88,_[b++]=e):e<65536?(_[b++]=89,_[b++]=e>>8,_[b++]=e&255):(_[b++]=90,ae.setUint32(b,e),b+=4),b+e>=_.length&&t(b+e),_.set(n.buffer?n:new Uint8Array(n),b),b+=e}function Fh(n,t){let e,r=t.length*2,s=n.length-r;t.sort((o,i)=>o.offset>i.offset?1:-1);for(let o=0;o<t.length;o++){let i=t[o];i.id=o;for(let a of i.references)n[a++]=o>>8,n[a]=o&255}for(;e=t.pop();){let o=e.offset;n.copyWithin(o+r,o,s),r-=2;let i=o+r;n[i++]=216,n[i++]=28,s=o}return n}function _i(n,t){ae.setUint32(ye.position+n,b-ye.position-n+1);let e=ye;ye=null,t(e[0]),t(e[1])}let ys=new bi({useRecords:!1});ys.encode,ys.encodeAsIterable,ys.encodeAsAsyncIterable;const vi=512,$h=1024,bs=2048;function xi(n){return new bi({tagUint8Array:!1,useRecords:!1}).encode(n)}function Vh(n){return fi(n)}const Nh=(n,t)=>n.length===t.length&&n.every((e,r)=>e===t[r]),ms=(n,t)=>Nh(n,t),zh=async(n,t)=>{let e;const r=new Promise((s,o)=>{e=setTimeout(()=>o(new Wh(`withTimeout: timed out after ${t}ms`)),t)});try{return await Promise.race([n,r])}finally{clearTimeout(e)}};class Wh extends Error{constructor(t){super(t),this.name="TimeoutError"}}const fr=class fr extends jt{constructor(e,r={}){super();z(this,ue);Z(this,"documentId");z(this,Cn);z(this,le);z(this,De);z(this,On,Ke());z(this,St,6e4);z(this,nn,{});z(this,Hn,new Map);Z(this,"isReady",()=>this.inState(["ready"]));Z(this,"isUnloaded",()=>this.inState(["unloaded"]));Z(this,"isDeleted",()=>this.inState(["deleted"]));Z(this,"isUnavailable",()=>this.inState(["unavailable"]));Z(this,"inState",e=>e.some(r=>h(this,le).getSnapshot().matches(r)));this.documentId=e,"timeoutDelay"in r&&r.timeoutDelay&&te(this,St,r.timeoutDelay),"heads"in r&&te(this,De,r.heads);const s=Ke();te(this,Cn,lt(`automerge-repo:dochandle:${this.documentId.slice(0,5)}`));const o=h(this,St),i=th({actions:{onUpdate:wn(({context:a,event:c})=>{const d=a.doc;Xc(c,Ii);const{callback:l}=c.payload;return{doc:l(d)}}),onDelete:wn(()=>(this.emit("delete",{handle:this}),{doc:Ke()})),onUnavailable:wn(()=>({doc:Ke()})),onUnload:wn(()=>({doc:Ke()}))}}).createMachine({initial:"idle",context:{documentId:e,doc:s},on:{UPDATE:{actions:"onUpdate"},UNLOAD:".unloaded",DELETE:".deleted"},states:{idle:{on:{BEGIN:"loading"}},loading:{on:{REQUEST:"requesting",DOC_READY:"ready"},after:{[o]:"unavailable"}},requesting:{on:{DOC_UNAVAILABLE:"unavailable",DOC_READY:"ready"},after:{[o]:"unavailable"}},unavailable:{entry:"onUnavailable",on:{DOC_READY:"ready"}},ready:{},unloaded:{entry:"onUnload",on:{RELOAD:"loading"}},deleted:{entry:"onDelete",type:"final"}}});te(this,le,bn(i)),h(this,le).subscribe(a=>{const c=h(this,On),d=a.context.doc;h(this,Cn).call(this,`\u2192 ${a.value} %o`,d),V(this,ue,Bi).call(this,c,d)}),h(this,le).start(),this.begin()}get url(){return Zo({documentId:this.documentId,heads:h(this,De)})}get state(){return h(this,le).getSnapshot().value}async whenReady(e=["ready"]){await zh(V(this,ue,Mi).call(this,e),h(this,St))}doc(){if(!this.isReady())throw new Error("DocHandle is not ready");return h(this,De)?Oa(h(this,ue,_t),Lt(h(this,De))):h(this,ue,_t)}docSync(){return console.warn("docSync is deprecated. Use doc() instead. This function will be removed as part of the 2.0 release."),this.doc()}heads(){if(!this.isReady())throw new Error("DocHandle is not ready");return h(this,De)?h(this,De):tt(ft(h(this,ue,_t)))}begin(){h(this,le).send({type:Kh})}history(){if(this.isReady())return $a(h(this,ue,_t)).map(e=>tt([e]))}view(e){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before calling view().`);const r=JSON.stringify(e),s=h(this,Hn).get(r);if(s)return s;const o=new fr(this.documentId,{heads:e,timeoutDelay:h(this,St)});return o.update(()=>Nn(h(this,ue,_t))),o.doneLoading(),h(this,Hn).set(r,o),o}diff(e,r){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before calling diff().`);const s=h(this,ue,_t);if(!s)throw new Error("Document not available");if(e instanceof fr){if(!e.isReady())throw new Error("Cannot diff against a handle that isn't ready");const a=e.heads();if(!a)throw new Error("Other document's heads not available");const c=qs(Nn(s),e.doc());return Cr(c,Lt(this.heads()),Lt(a))}const o=r?e:this.heads()||[],i=r||e;return Cr(s,Lt(o),Lt(i))}metadata(e){if(this.isReady())return e||(e=this.heads()[0]),Va(h(this,ue,_t),Lt([e])[0])||void 0}update(e){V(this,ue,wr).call(this,e)}doneLoading(){h(this,le).send({type:Si})}setSyncInfo(e,r){h(this,nn)[e]=r,this.emit("remote-heads",{storageId:e,heads:r.lastHeads,timestamp:r.lastSyncTimestamp})}getRemoteHeads(e){var r;return(r=h(this,nn)[e])==null?void 0:r.lastHeads}getSyncInfo(e){return h(this,nn)[e]}change(e,r={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is in ${this.state} and not ready. Check \`handle.isReady()\` before accessing the document.`);if(h(this,De))throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);V(this,ue,wr).call(this,s=>ja(s,r,e))}changeAt(e,r,s={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before accessing the document.`);if(h(this,De))throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);let o;return V(this,ue,wr).call(this,i=>{const a=Ra(i,Lt(e),s,r);return o=a.newHeads?tt(a.newHeads):void 0,a.newDoc}),o}isReadOnly(){return!!h(this,De)}merge(e){if(!this.isReady()||!e.isReady())throw new Error("Both handles must be ready to merge");if(h(this,De))throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);const r=e.doc();this.update(s=>qs(s,r))}unavailable(){h(this,le).send({type:Xh})}request(){h(this,ue,Ti)==="loading"&&h(this,le).send({type:qh})}unload(){h(this,le).send({type:Yh})}reload(){h(this,le).send({type:Qh})}delete(){h(this,le).send({type:Zh})}broadcast(e){this.emit("ephemeral-message-outbound",{handle:this,data:new Uint8Array(xi(e))})}metrics(){return Hr(h(this,ue,_t))}};Cn=new WeakMap,le=new WeakMap,De=new WeakMap,On=new WeakMap,St=new WeakMap,nn=new WeakMap,Hn=new WeakMap,ue=new WeakSet,_t=function(){var e;return(e=h(this,le))==null?void 0:e.getSnapshot().context.doc},Ti=function(){var e;return(e=h(this,le))==null?void 0:e.getSnapshot().value},Mi=function(e){const r=Array.isArray(e)?e:[e];return rh(h(this,le),s=>r.some(o=>s.matches(o)),{timeout:h(this,St)*2})},wr=function(e){let r=null;if(h(this,le).send({type:Ii,payload:{callback:s=>{try{return e(s)}catch(o){return r=o,s}}}}),r)throw r},Bi=function(e,r){const s=ft(e),o=ft(r);if(!ms(tt(o),tt(s))){this.emit("heads-changed",{handle:this,doc:r});const i=Cr(r,s,o);i.length>0&&this.emit("change",{handle:this,doc:r,patches:i,patchInfo:{before:e,after:r,source:"change"}}),this.isReady()||h(this,le).send({type:Si})}te(this,On,r)};let ws=fr;const Jh={REQUESTING:"requesting",READY:"ready",UNLOADED:"unloaded",DELETED:"deleted",UNAVAILABLE:"unavailable"},{REQUESTING:hr,READY:st,UNLOADED:Gh,DELETED:ur,UNAVAILABLE:Pe}=Jh,Kh="BEGIN",qh="REQUEST",Si="DOC_READY",Ii="UPDATE",Yh="UNLOAD",Qh="RELOAD",Zh="DELETE",Xh="DOC_UNAVAILABLE";class eu extends jt{constructor(){super(...arguments);z(this,Ft);z(this,ot,new Map);z(this,He,new Set);z(this,Le,new Map);z(this,it,new Set);z(this,It,new Map);z(this,at,lt("automerge-repo:remote-heads-subscriptions"))}subscribeToRemotes(e){h(this,at).call(this,"subscribeToRemotes",e);const r=[];for(const s of e)h(this,He).has(s)||(h(this,He).add(s),r.push(s));r.length>0&&this.emit("change-remote-subs",{add:r,peers:Array.from(h(this,it))})}unsubscribeFromRemotes(e){h(this,at).call(this,"subscribeToRemotes",e);const r=[];for(const s of e)h(this,He).has(s)&&(h(this,He).delete(s),h(this,Le).has(s)||r.push(s));r.length>0&&this.emit("change-remote-subs",{remove:r,peers:Array.from(h(this,it))})}handleControlMessage(e){const r=[],s=[],o=[];if(h(this,at).call(this,"handleControlMessage",e),e.add)for(const i of e.add){let a=h(this,Le).get(i);(h(this,He).has(i)||a)&&o.push(i),a||(a=new Set,h(this,Le).set(i,a),h(this,He).has(i)||r.push(i)),a.add(e.senderId)}if(e.remove)for(const i of e.remove){const a=h(this,Le).get(i);a&&(a.delete(e.senderId),a.size==0&&!h(this,He).has(i)&&s.push(i))}(r.length>0||s.length>0)&&this.emit("change-remote-subs",{peers:Array.from(h(this,it)),add:r,remove:s});for(const i of o){const a=h(this,It).get(e.senderId);if(a)for(const c of a){const d=h(this,ot).get(c);if(!d)continue;const l=d.get(i);l&&this.emit("notify-remote-heads",{targetId:e.senderId,documentId:c,heads:l.lastHeads,timestamp:l.lastSyncTimestamp,storageId:i})}}}handleRemoteHeads(e){h(this,at).call(this,"handleRemoteHeads",e);const r=V(this,Ft,Fi).call(this,e);for(const s of r)h(this,He).has(s.storageId)&&this.emit("remote-heads-changed",s);for(const s of r)for(const o of h(this,it))o!==e.senderId&&this.emit("notify-remote-heads",{targetId:o,documentId:s.documentId,heads:s.remoteHeads,timestamp:s.timestamp,storageId:s.storageId});for(const s of r){const o=h(this,Le).get(s.storageId);if(o)for(const i of o)V(this,Ft,ks).call(this,i,s.documentId)&&this.emit("notify-remote-heads",{targetId:i,documentId:s.documentId,heads:s.remoteHeads,timestamp:s.timestamp,storageId:s.storageId})}}handleImmediateRemoteHeadsChanged(e,r,s){h(this,at).call(this,"handleLocalHeadsChanged",e,r,s);const o=h(this,ot).get(e),i=Date.now();if(!o)h(this,ot).set(e,new Map([[r,{lastSyncTimestamp:i,lastHeads:s}]]));else{const c=o.get(r);(!c||c.lastSyncTimestamp<Date.now())&&o.set(r,{lastSyncTimestamp:Date.now(),lastHeads:s})}const a=h(this,Le).get(r);if(a)for(const c of a)V(this,Ft,ks).call(this,c,e)&&this.emit("notify-remote-heads",{targetId:c,documentId:e,heads:s,timestamp:i,storageId:r})}addGenerousPeer(e){h(this,at).call(this,"addGenerousPeer",e),h(this,it).add(e),h(this,He).size>0&&this.emit("change-remote-subs",{add:Array.from(h(this,He)),peers:[e]});for(const[r,s]of h(this,ot))for(const[o,{lastHeads:i,lastSyncTimestamp:a}]of s)this.emit("notify-remote-heads",{targetId:e,documentId:r,heads:i,timestamp:a,storageId:o})}removePeer(e){h(this,at).call(this,"removePeer",e);const r=[];h(this,it).delete(e),h(this,It).delete(e);for(const[s,o]of h(this,Le))o.has(e)&&(o.delete(e),o.size==0&&(r.push(s),h(this,Le).delete(s)));r.length>0&&this.emit("change-remote-subs",{remove:r,peers:Array.from(h(this,it))})}subscribePeerToDoc(e,r){let s=h(this,It).get(e);s||(s=new Set,h(this,It).set(e,s)),s.add(r);const o=h(this,ot).get(r);if(o)for(const[i,a]of o){const c=h(this,Le).get(i);c&&c.has(e)&&this.emit("notify-remote-heads",{targetId:e,documentId:r,heads:a.lastHeads,timestamp:a.lastSyncTimestamp,storageId:i})}}}ot=new WeakMap,He=new WeakMap,Le=new WeakMap,it=new WeakMap,It=new WeakMap,at=new WeakMap,Ft=new WeakSet,ks=function(e,r){const s=h(this,It).get(e);return s&&s.has(r)},Fi=function(e){const r=[],{documentId:s,newHeads:o}=e;for(const[i,{heads:a,timestamp:c}]of Object.entries(o)){if(!h(this,He).has(i)&&!h(this,Le).has(i))continue;let d=h(this,ot).get(s);d||(d=new Map,h(this,ot).set(s,d));const l=d.get(i);l&&l.lastSyncTimestamp>=c||(d.set(i,{lastSyncTimestamp:c,lastHeads:a}),r.push({documentId:s,storageId:i,remoteHeads:a,timestamp:c}))}return r};const _s=(n,t)=>{let e=Date.now(),r,s;return function(...o){r=e+t-Date.now(),clearTimeout(s),s=setTimeout(()=>{n(...o),e=Date.now()},r)}},tu=n=>ru(n)||Ei(n)||Ai(n)||nu(n)||su(n)||ou(n),nu=n=>n.type==="doc-unavailable",Ai=n=>n.type==="request",ru=n=>n.type==="sync",Ei=n=>n.type==="ephemeral",su=n=>n.type==="remote-subscription-change",ou=n=>n.type==="remote-heads-changed",iu=n=>`${n.senderId}:${n.sessionId}`;class au extends jt{constructor(e,r,s){super();Z(this,"peerId");Z(this,"peerMetadata");z(this,ze);z(this,mt,{});z(this,lr,0);z(this,gr,Math.random().toString(36).slice(2));z(this,rn,{});Z(this,"adapters",[]);Z(this,"isReady",()=>this.adapters.every(e=>e.isReady()));Z(this,"whenReady",async()=>Promise.all(this.adapters.map(e=>e.whenReady())));this.peerId=r,this.peerMetadata=s,te(this,ze,lt(`automerge-repo:network:${this.peerId}`)),e.forEach(o=>this.addNetworkAdapter(o))}disconnect(){this.adapters.forEach(e=>e.disconnect())}reconnect(){this.adapters.forEach(e=>e.connect(this.peerId))}addNetworkAdapter(e){this.adapters.push(e),e.on("peer-candidate",({peerId:r,peerMetadata:s})=>{h(this,ze).call(this,`peer candidate: ${r} `),h(this,mt)[r]||(h(this,mt)[r]=e),this.emit("peer",{peerId:r,peerMetadata:s})}),e.on("peer-disconnected",({peerId:r})=>{h(this,ze).call(this,`peer disconnected: ${r} `),delete h(this,mt)[r],this.emit("peer-disconnected",{peerId:r})}),e.on("message",r=>{if(!tu(r)){h(this,ze).call(this,`invalid message: ${JSON.stringify(r)}`);return}if(h(this,ze).call(this,`message from ${r.senderId}`),Ei(r)){const s=iu(r);(h(this,rn)[s]===void 0||r.count>h(this,rn)[s])&&(h(this,rn)[s]=r.count,this.emit("message",r));return}this.emit("message",r)}),e.on("close",()=>{h(this,ze).call(this,"adapter closed"),Object.entries(h(this,mt)).forEach(([r,s])=>{s===e&&delete h(this,mt)[r]}),this.adapters=this.adapters.filter(r=>r!==e)}),this.peerMetadata.then(r=>{e.connect(this.peerId,r)}).catch(r=>{h(this,ze).call(this,"error connecting to network",r)})}removeNetworkAdapter(e){this.adapters=this.adapters.filter(r=>r!==e),e.disconnect()}send(e){const r=h(this,mt)[e.targetId];if(!r){h(this,ze).call(this,`Tried to send message but peer not found: ${e.targetId}`);return}const s=(o=>o.type==="ephemeral"?"count"in o?o:{...o,count:++Li(this,lr)._,sessionId:h(this,gr),senderId:this.peerId}:{...o,senderId:this.peerId})(e);h(this,ze).call(this,"sending message %o",s),r.send(s)}}ze=new WeakMap,mt=new WeakMap,lr=new WeakMap,gr=new WeakMap,rn=new WeakMap;function ki(n){let t=0;n.forEach(s=>{t+=s.length});const e=new Uint8Array(t);let r=0;return n.forEach(s=>{e.set(s,r),r+=s.length}),e}var vs={exports:{}},cu=vs.exports,Ci;function hu(){return Ci||(Ci=1,function(n){(function(t,e){var r={};e(r);var s=r.default;for(var o in r)s[o]=r[o];n.exports=s})(cu,function(t){t.__esModule=!0,t.digestLength=32,t.blockSize=64;var e=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function r(f,u,p,m,C){for(var D,R,I,W,L,T,J,B,k,H,M,K,y;C>=64;){for(D=u[0],R=u[1],I=u[2],W=u[3],L=u[4],T=u[5],J=u[6],B=u[7],H=0;H<16;H++)M=m+H*4,f[H]=(p[M]&255)<<24|(p[M+1]&255)<<16|(p[M+2]&255)<<8|p[M+3]&255;for(H=16;H<64;H++)k=f[H-2],K=(k>>>17|k<<15)^(k>>>19|k<<13)^k>>>10,k=f[H-15],y=(k>>>7|k<<25)^(k>>>18|k<<14)^k>>>3,f[H]=(K+f[H-7]|0)+(y+f[H-16]|0);for(H=0;H<64;H++)K=(((L>>>6|L<<26)^(L>>>11|L<<21)^(L>>>25|L<<7))+(L&T^~L&J)|0)+(B+(e[H]+f[H]|0)|0)|0,y=((D>>>2|D<<30)^(D>>>13|D<<19)^(D>>>22|D<<10))+(D&R^D&I^R&I)|0,B=J,J=T,T=L,L=W+K|0,W=I,I=R,R=D,D=K+y|0;u[0]+=D,u[1]+=R,u[2]+=I,u[3]+=W,u[4]+=L,u[5]+=T,u[6]+=J,u[7]+=B,m+=64,C-=64}return m}var s=function(){function f(){this.digestLength=t.digestLength,this.blockSize=t.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return f.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},f.prototype.clean=function(){for(var u=0;u<this.buffer.length;u++)this.buffer[u]=0;for(var u=0;u<this.temp.length;u++)this.temp[u]=0;this.reset()},f.prototype.update=function(u,p){if(p===void 0&&(p=u.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var m=0;if(this.bytesHashed+=p,this.bufferLength>0){for(;this.bufferLength<64&&p>0;)this.buffer[this.bufferLength++]=u[m++],p--;this.bufferLength===64&&(r(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(p>=64&&(m=r(this.temp,this.state,u,m,p),p%=64);p>0;)this.buffer[this.bufferLength++]=u[m++],p--;return this},f.prototype.finish=function(u){if(!this.finished){var p=this.bytesHashed,m=this.bufferLength,C=p/536870912|0,D=p<<3,R=p%64<56?64:128;this.buffer[m]=128;for(var I=m+1;I<R-8;I++)this.buffer[I]=0;this.buffer[R-8]=C>>>24&255,this.buffer[R-7]=C>>>16&255,this.buffer[R-6]=C>>>8&255,this.buffer[R-5]=C>>>0&255,this.buffer[R-4]=D>>>24&255,this.buffer[R-3]=D>>>16&255,this.buffer[R-2]=D>>>8&255,this.buffer[R-1]=D>>>0&255,r(this.temp,this.state,this.buffer,0,R),this.finished=!0}for(var I=0;I<8;I++)u[I*4+0]=this.state[I]>>>24&255,u[I*4+1]=this.state[I]>>>16&255,u[I*4+2]=this.state[I]>>>8&255,u[I*4+3]=this.state[I]>>>0&255;return this},f.prototype.digest=function(){var u=new Uint8Array(this.digestLength);return this.finish(u),u},f.prototype._saveState=function(u){for(var p=0;p<this.state.length;p++)u[p]=this.state[p]},f.prototype._restoreState=function(u,p){for(var m=0;m<this.state.length;m++)this.state[m]=u[m];this.bytesHashed=p,this.finished=!1,this.bufferLength=0},f}();t.Hash=s;var o=function(){function f(u){this.inner=new s,this.outer=new s,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var p=new Uint8Array(this.blockSize);if(u.length>this.blockSize)new s().update(u).finish(p).clean();else for(var m=0;m<u.length;m++)p[m]=u[m];for(var m=0;m<p.length;m++)p[m]^=54;this.inner.update(p);for(var m=0;m<p.length;m++)p[m]^=106;this.outer.update(p),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var m=0;m<p.length;m++)p[m]=0}return f.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},f.prototype.clean=function(){for(var u=0;u<this.istate.length;u++)this.ostate[u]=this.istate[u]=0;this.inner.clean(),this.outer.clean()},f.prototype.update=function(u){return this.inner.update(u),this},f.prototype.finish=function(u){return this.outer.finished?this.outer.finish(u):(this.inner.finish(u),this.outer.update(u,this.digestLength).finish(u)),this},f.prototype.digest=function(){var u=new Uint8Array(this.digestLength);return this.finish(u),u},f}();t.HMAC=o;function i(f){var u=new s().update(f),p=u.digest();return u.clean(),p}t.hash=i,t.default=i;function a(f,u){var p=new o(f).update(u),m=p.digest();return p.clean(),m}t.hmac=a;function c(f,u,p,m){var C=m[0];if(C===0)throw new Error("hkdf: cannot expand more");u.reset(),C>1&&u.update(f),p&&u.update(p),u.update(m),u.finish(f),m[0]++}var d=new Uint8Array(t.digestLength);function l(f,u,p,m){u===void 0&&(u=d),m===void 0&&(m=32);for(var C=new Uint8Array([1]),D=a(u,f),R=new o(D),I=new Uint8Array(R.digestLength),W=I.length,L=new Uint8Array(m),T=0;T<m;T++)W===I.length&&(c(I,R,p,C),W=0),L[T]=I[W++];return R.clean(),I.fill(0),C.fill(0),L}t.hkdf=l;function g(f,u,p,m){for(var C=new o(f),D=C.digestLength,R=new Uint8Array(4),I=new Uint8Array(D),W=new Uint8Array(D),L=new Uint8Array(m),T=0;T*D<m;T++){var J=T+1;R[0]=J>>>24&255,R[1]=J>>>16&255,R[2]=J>>>8&255,R[3]=J>>>0&255,C.reset(),C.update(u),C.update(R),C.finish(W);for(var B=0;B<D;B++)I[B]=W[B];for(var B=2;B<=p;B++){C.reset(),C.update(W).finish(W);for(var k=0;k<D;k++)I[k]^=W[k]}for(var B=0;B<D&&T*D+B<m;B++)L[T*D+B]=I[B]}for(var T=0;T<D;T++)I[T]=W[T]=0;for(var T=0;T<4;T++)R[T]=0;return C.clean(),L}t.pbkdf2=g})}(vs)),vs.exports}var uu=hu();function Oi(n){const t=uu.hash(n);return fu(t)}function du(n){const t=new TextEncoder,e=ki(n.map(r=>t.encode(r)));return Oi(e)}function fu(n){return Array.from(n,t=>t.toString(16).padStart(2,"0")).join("")}class lu extends jt{constructor(e){super();z(this,ht);z(this,be);z(this,At,new Map);z(this,ct,new Map);z(this,sn,!1);z(this,$t,lt("automerge-repo:storage-subsystem"));te(this,be,e)}async id(){const e=await h(this,be).load(["storage-adapter-id"]);let r;return e?r=new TextDecoder().decode(e):(r=To(),await h(this,be).save(["storage-adapter-id"],new TextEncoder().encode(r))),r}async load(e,r){const s=[e,r];return await h(this,be).load(s)}async save(e,r,s){const o=[e,r];await h(this,be).save(o,s)}async remove(e,r){const s=[e,r];await h(this,be).remove(s)}async loadDocData(e){const r=await h(this,be).loadRange([e,"snapshot"]),s=await h(this,be).loadRange([e,"incremental"]),o=[],i=[];for(const a of r)a.data!==void 0&&(i.push({key:a.key,type:"snapshot",size:a.data.length}),o.push(a.data));for(const a of s)a.data!==void 0&&(i.push({key:a.key,type:"incremental",size:a.data.length}),o.push(a.data));return h(this,ct).set(e,i),o.length===0?null:ki(o)}async loadDoc(e){const r=await this.loadDocData(e);if(!r)return null;const s=performance.now(),o=Gs(Ke(),r),i=performance.now();return this.emit("document-loaded",{documentId:e,durationMillis:i-s,...Hr(o)}),h(this,At).set(e,ft(o)),o}async saveDoc(e,r){if(!V(this,ht,Ni).call(this,e,r))return;const s=h(this,ct).get(e)??[];V(this,ht,zi).call(this,s)?await V(this,ht,Vi).call(this,e,r,s):await V(this,ht,$i).call(this,e,r),h(this,At).set(e,ft(r))}async removeDoc(e){await h(this,be).removeRange([e,"snapshot"]),await h(this,be).removeRange([e,"incremental"]),await h(this,be).removeRange([e,"sync-state"])}async loadSyncState(e,r){const s=[e,"sync-state",r];try{const o=await h(this,be).load(s);return o?Zs(o):void 0}catch{h(this,$t).call(this,`Error loading sync state for ${e} from ${r}`);return}}async saveSyncState(e,r,s){const o=[e,"sync-state",r];await h(this,be).save(o,Qs(s))}}be=new WeakMap,At=new WeakMap,ct=new WeakMap,sn=new WeakMap,$t=new WeakMap,ht=new WeakSet,$i=async function(e,r){const s=Fa(r,h(this,At).get(e)??[]);if(s&&s.length>0){const o=[e,"incremental",Oi(s)];h(this,$t).call(this,`Saving incremental ${o} for document ${e}`),await h(this,be).save(o,s),h(this,ct).has(e)||h(this,ct).set(e,[]),h(this,ct).get(e).push({key:o,type:"incremental",size:s.length}),h(this,At).set(e,ft(r))}else return Promise.resolve()},Vi=async function(e,r,s){var l;te(this,sn,!0);const o=Ks(r),i=du(ft(r)),a=[e,"snapshot",i],c=new Set(s.map(g=>g.key).filter(g=>g[2]!==i));h(this,$t).call(this,`Saving snapshot ${a} for document ${e}`),h(this,$t).call(this,`deleting old chunks ${Array.from(c)}`),await h(this,be).save(a,o);for(const g of c)await h(this,be).remove(g);const d=((l=h(this,ct).get(e))==null?void 0:l.filter(g=>!c.has(g.key)))??[];d.push({key:a,type:"snapshot",size:o.length}),h(this,ct).set(e,d),te(this,sn,!1)},Ni=function(e,r){const s=h(this,At).get(e);if(!s)return!0;const o=ft(r);return!ms(tt(o),tt(s))},zi=function(e){if(h(this,sn))return!1;let r=0,s=0;for(const o of e)o.type==="snapshot"?r+=o.size:s+=o.size;return r<1024||s>=r};class Hi extends jt{}class gu extends Hi{constructor({handle:e,peerId:r,onLoadSyncState:s}){super();z(this,q);z(this,ut);Z(this,"syncDebounceRate",100);z(this,Ie,[]);z(this,Vt,{});z(this,me,{});z(this,on,{});z(this,an,[]);z(this,pr);z(this,cn,!1);z(this,se);z(this,jn);te(this,pr,r),te(this,se,e),te(this,jn,s??(()=>Promise.resolve(void 0)));const o=e.documentId.slice(0,5);te(this,ut,lt(`automerge-repo:docsync:${o}`)),e.on("change",_s(()=>V(this,q,Wi).call(this),this.syncDebounceRate)),e.on("ephemeral-message-outbound",i=>V(this,q,Ji).call(this,i)),(async()=>V(this,q,Os).call(this))()}get peerStates(){return h(this,me)}get documentId(){return h(this,se).documentId}hasPeer(e){return h(this,Ie).includes(e)}async beginSync(e){h(this,se).whenReady([st,hr,Pe]).then(()=>{te(this,cn,!0),V(this,q,zt).call(this)}).catch(r=>{console.log("caught whenready",r),te(this,cn,!0),V(this,q,zt).call(this)}),h(this,Ie).some(r=>h(this,me)[r]=="has")&&await h(this,se).whenReady(),e.forEach(r=>{V(this,q,_r).call(this,r,s=>{const o=Zs(Qs(s));V(this,q,vr).call(this,r,o),h(this,se).whenReady([st,hr,Pe]).then(()=>{const i=h(this,se).isReady()?h(this,se).doc():Ke(),a=e.every(c=>h(this,me)[c]in["unavailable","wants"]);i===void 0&&a||V(this,q,xr).call(this,r,i??Ke())}).catch(i=>{h(this,ut).call(this,`Error loading doc for ${r}: ${i}`)})})})}endSync(e){h(this,ut).call(this,`removing peer ${e}`),te(this,Ie,h(this,Ie).filter(r=>r!==e)),delete h(this,me)[e],V(this,q,zt).call(this)}receiveMessage(e){switch(e.type){case"sync":case"request":this.receiveSyncMessage(e);break;case"ephemeral":this.receiveEphemeralMessage(e);break;case"doc-unavailable":h(this,me)[e.senderId]="unavailable",V(this,q,zt).call(this);break;default:throw new Error(`unknown message type: ${e}`)}}receiveEphemeralMessage(e){if(e.documentId!==h(this,se).documentId)throw new Error("channelId doesn't match documentId");const{senderId:r,data:s}=e,o=fi(new Uint8Array(s));h(this,se).emit("ephemeral-message",{handle:h(this,se),senderId:r,message:o}),h(this,Ie).forEach(i=>{i!==r&&this.emit("message",{...e,targetId:i})})}receiveSyncMessage(e){if(e.documentId!==h(this,se).documentId)throw new Error("channelId doesn't match documentId");if(!h(this,se).inState([st,hr,Pe])){h(this,an).push({message:e,received:new Date});return}V(this,q,Os).call(this),V(this,q,Cs).call(this,e)}metrics(){return{peers:h(this,Ie),size:h(this,se).metrics()}}}ut=new WeakMap,Ie=new WeakMap,Vt=new WeakMap,me=new WeakMap,on=new WeakMap,an=new WeakMap,pr=new WeakMap,cn=new WeakMap,se=new WeakMap,jn=new WeakMap,q=new WeakSet,Wi=async function(){try{await h(this,se).whenReady();const e=h(this,se).doc();h(this,Ie).forEach(r=>V(this,q,xr).call(this,r,e))}catch{console.log("sync with peers threw an exception")}},Ji=async function({data:e}){h(this,ut).call(this,"broadcastToPeers",h(this,Ie)),h(this,Ie).forEach(r=>V(this,q,Gi).call(this,r,e))},Gi=function(e,r){h(this,ut).call(this,`sendEphemeralMessage ->${e}`);const s={type:"ephemeral",targetId:e,documentId:h(this,se).documentId,data:r};this.emit("message",s)},_r=function(e,r){V(this,q,Ki).call(this,e),e in h(this,me)||(h(this,me)[e]="unknown");const s=h(this,on)[e];if(s){r(s);return}let o=h(this,Vt)[e];o||(h(this,jn).call(this,e).then(i=>{V(this,q,qi).call(this,e,i??Ma())}).catch(i=>{h(this,ut).call(this,`Error loading sync state for ${e}: ${i}`)}),o=h(this,Vt)[e]=[]),o.push(r)},Ki=function(e){h(this,Ie).includes(e)||(h(this,Ie).push(e),this.emit("open-doc",{documentId:this.documentId,peerId:e}))},qi=function(e,r){const s=h(this,Vt)[e];if(s)for(const o of s)o(r);delete h(this,Vt)[e],h(this,on)[e]=r},vr=function(e,r){h(this,on)[e]=r,this.emit("sync-state",{peerId:e,syncState:r,documentId:h(this,se).documentId})},xr=function(e,r){h(this,ut).call(this,`sendSyncMessage ->${e}`),V(this,q,_r).call(this,e,s=>{const[o,i]=La(r,s);if(i){V(this,q,vr).call(this,e,o);const a=ft(r).length===0;!h(this,se).isReady()&&a&&o.sharedHeads.length===0&&!Object.values(h(this,me)).includes("has")&&h(this,me)[e]==="unknown"?this.emit("message",{type:"request",targetId:e,documentId:h(this,se).documentId,data:i}):this.emit("message",{type:"sync",targetId:e,data:i,documentId:h(this,se).documentId}),a||(h(this,me)[e]="has")}})},Cs=function(e){Ai(e)&&(h(this,me)[e.senderId]="wants"),V(this,q,zt).call(this),Ba(e.data).heads.length>0&&(h(this,me)[e.senderId]="has"),V(this,q,_r).call(this,e.senderId,r=>{h(this,se).update(s=>{const o=performance.now(),[i,a]=Ta(s,r,e.data),c=performance.now();return this.emit("metrics",{type:"receive-sync-message",documentId:h(this,se).documentId,durationMillis:c-o,...Hr(s)}),V(this,q,vr).call(this,e.senderId,a),V(this,q,xr).call(this,e.senderId,s),i}),V(this,q,zt).call(this)})},zt=function(){h(this,cn)&&h(this,se).inState([hr,Pe])&&h(this,Ie).every(e=>h(this,me)[e]==="unavailable"||h(this,me)[e]==="wants")&&(h(this,Ie).filter(e=>h(this,me)[e]==="wants").forEach(e=>{h(this,me)[e]="unavailable";const r={type:"doc-unavailable",documentId:h(this,se).documentId,targetId:e};this.emit("message",r)}),h(this,se).unavailable())},Os=function(){for(const e of h(this,an))V(this,q,Cs).call(this,e.message);te(this,an,[])};const dr=lt("automerge-repo:collectionsync");class pu extends Hi{constructor(e,r=[]){super();z(this,dt);Z(this,"repo");z(this,Et,new Set);Z(this,"docSynchronizers",{});z(this,hn,{});z(this,Rn);this.repo=e,te(this,Rn,r.map(s=>vn(s).documentId))}async receiveMessage(e){dr(`onSyncMessage: ${e.senderId}, ${e.documentId}, ${"data"in e?e.data.byteLength+"bytes":""}`);const r=e.documentId;if(!r)throw new Error("received a message with an invalid documentId");if(h(this,Rn).includes(r)){this.emit("metrics",{type:"doc-denied",documentId:r}),this.emit("message",{type:"doc-unavailable",documentId:r,targetId:e.senderId});return}h(this,hn)[r]=!0;const s=await this.repo.find(r,{allowableStates:["ready","unavailable","requesting"]}),o=V(this,dt,Hs).call(this,s);o.receiveMessage(e);const i=await V(this,dt,js).call(this,r);o.beginSync(i.filter(a=>!o.hasPeer(a)))}addDocument(e){if(h(this,hn)[e.documentId])return;const r=V(this,dt,Hs).call(this,e);V(this,dt,js).call(this,e.documentId).then(s=>{r.beginSync(s)})}removeDocument(e){dr(`removing document ${e}`);const r=this.docSynchronizers[e];r!==void 0&&this.peers.forEach(s=>r.endSync(s)),delete this.docSynchronizers[e],delete h(this,hn)[e]}addPeer(e){if(dr(`adding ${e} & synchronizing with them`),!h(this,Et).has(e)){h(this,Et).add(e);for(const r of Object.values(this.docSynchronizers)){const{documentId:s}=r;this.repo.sharePolicy(e,s).then(o=>{o&&r.beginSync([e])})}}}removePeer(e){dr(`removing peer ${e}`),h(this,Et).delete(e);for(const r of Object.values(this.docSynchronizers))r.endSync(e)}get peers(){return Array.from(h(this,Et))}metrics(){return Object.fromEntries(Object.entries(this.docSynchronizers).map(([e,r])=>[e,r.metrics()]))}}Et=new WeakMap,hn=new WeakMap,Rn=new WeakMap,dt=new WeakSet,Hs=function(e){return this.docSynchronizers[e.documentId]||(this.docSynchronizers[e.documentId]=V(this,dt,Yi).call(this,e)),this.docSynchronizers[e.documentId]},Yi=function(e){const r=new gu({handle:e,peerId:this.repo.networkSubsystem.peerId,onLoadSyncState:async s=>{if(!this.repo.storageSubsystem)return;const{storageId:o,isEphemeral:i}=this.repo.peerMetadataByPeerId[s]||{};if(!(!o||i))return this.repo.storageSubsystem.loadSyncState(e.documentId,o)}});return r.on("message",s=>this.emit("message",s)),r.on("open-doc",s=>this.emit("open-doc",s)),r.on("sync-state",s=>this.emit("sync-state",s)),r.on("metrics",s=>this.emit("metrics",s)),r},js=async function(e){const r=Array.from(h(this,Et)),s=[];for(const o of r)await this.repo.sharePolicy(o,e)&&s.push(o);return s};function ji(n,t){let e=!1;return new Promise((r,s)=>{t==null||t.addEventListener("abort",()=>{e||s(new DOMException("Operation aborted","AbortError"))},{once:!0}),n.then(o=>{r(o)}).catch(o=>{s(o)}).finally(()=>{e=!0})})}function yu(){return"peer-"+Math.random().toString(36).slice(4)}class bu extends jt{constructor({storage:e,network:r=[],peerId:s=yu(),sharePolicy:o,isEphemeral:i=e===void 0,enableRemoteHeadsGossiping:a=!1,denylist:c=[],saveDebounceRate:d=100}={}){super();z(this,ce);z(this,Te);Z(this,"networkSubsystem");Z(this,"storageSubsystem");z(this,un);z(this,Nt);z(this,we,{});Z(this,"synchronizer");Z(this,"sharePolicy",async()=>!0);Z(this,"peerMetadataByPeerId",{});z(this,Me,new eu);z(this,Ye,!1);z(this,kt,{});z(this,Un,{});Z(this,"subscribeToRemotes",e=>{h(this,Ye)?(h(this,Te).call(this,"subscribeToRemotes",{remotes:e}),h(this,Me).subscribeToRemotes(e)):h(this,Te).call(this,"WARN: subscribeToRemotes called but remote heads gossiping is not enabled")});Z(this,"storageId",async()=>{if(this.storageSubsystem)return this.storageSubsystem.id()});te(this,Ye,a),te(this,Te,lt("automerge-repo:repo")),this.sharePolicy=o??this.sharePolicy,this.on("delete-document",({documentId:u})=>{this.synchronizer.removeDocument(u),l&&l.removeDoc(u).catch(p=>{h(this,Te).call(this,"error deleting document",{documentId:u,err:p})})}),this.synchronizer=new pu(this,c),this.synchronizer.on("message",u=>{h(this,Te).call(this,`sending ${u.type} message to ${u.targetId}`),f.send(u)}),this.synchronizer.on("metrics",u=>this.emit("doc-metrics",u)),h(this,Ye)&&this.synchronizer.on("open-doc",({peerId:u,documentId:p})=>{h(this,Me).subscribePeerToDoc(u,p)});const l=e?new lu(e):void 0;l&&l.on("document-loaded",u=>this.emit("doc-metrics",{type:"doc-loaded",...u})),this.storageSubsystem=l,te(this,un,d),this.storageSubsystem?te(this,Nt,_s(({handle:p,doc:m})=>{this.storageSubsystem.saveDoc(p.documentId,m)},h(this,un))):te(this,Nt,()=>{});const g=(async()=>({storageId:await(l==null?void 0:l.id()),isEphemeral:i}))(),f=new au(r,s,g);this.networkSubsystem=f,f.on("peer",async({peerId:u,peerMetadata:p})=>{h(this,Te).call(this,"peer connected",{peerId:u}),p&&(this.peerMetadataByPeerId[u]={...p}),this.sharePolicy(u).then(m=>{m&&h(this,Ye)&&h(this,Me).addGenerousPeer(u)}).catch(m=>{console.log("error in share policy",{err:m})}),this.synchronizer.addPeer(u)}),f.on("peer-disconnected",({peerId:u})=>{this.synchronizer.removePeer(u),h(this,Me).removePeer(u)}),f.on("message",async u=>{V(this,ce,Qi).call(this,u)}),this.synchronizer.on("sync-state",u=>{var D;V(this,ce,Zi).call(this,u);const p=h(this,we)[u.documentId],{storageId:m}=this.peerMetadataByPeerId[u.peerId]||{};if(!m)return;const C=(D=p.getSyncInfo(m))==null?void 0:D.lastHeads;u.syncState.theirHeads&&(!C||!ms(C,tt(u.syncState.theirHeads)))&&u.syncState.theirHeads&&(p.setSyncInfo(m,{lastHeads:tt(u.syncState.theirHeads),lastSyncTimestamp:Date.now()}),m&&h(this,Ye)&&h(this,Me).handleImmediateRemoteHeadsChanged(u.documentId,m,tt(u.syncState.theirHeads)))}),h(this,Ye)&&(h(this,Me).on("notify-remote-heads",u=>{this.networkSubsystem.send({type:"remote-heads-changed",targetId:u.targetId,documentId:u.documentId,newHeads:{[u.storageId]:{heads:u.heads,timestamp:u.timestamp}}})}),h(this,Me).on("change-remote-subs",u=>{h(this,Te).call(this,"change-remote-subs",u);for(const p of u.peers)this.networkSubsystem.send({type:"remote-subscription-change",targetId:p,add:u.add,remove:u.remove})}),h(this,Me).on("remote-heads-changed",({documentId:u,storageId:p,remoteHeads:m,timestamp:C})=>{h(this,we)[u].setSyncInfo(p,{lastHeads:m,lastSyncTimestamp:C})}))}get handles(){return h(this,we)}get peers(){return this.synchronizer.peers}getStorageIdOfPeer(e){var r;return(r=this.peerMetadataByPeerId[e])==null?void 0:r.storageId}create(e){const{documentId:r}=vn(xh()),s=V(this,ce,Ct).call(this,{documentId:r});return V(this,ce,Ln).call(this,s),s.update(()=>{let o;return e?o=Ha(e):o=Ua(Ke()),o}),s.doneLoading(),s}clone(e){if(!e.isReady())throw new Error(`Cloned handle is not yet in ready state.
        (Try await handle.whenReady() first.)`);const r=e.doc(),s=this.create();return s.update(()=>Nn(r)),s}findWithProgress(e,r={}){const{signal:s}=r,{documentId:o,heads:i}=Xo(e)?vn(e):{documentId:tr(e),heads:void 0};if(h(this,we)[o]){const f=h(this,we)[o];if(f.state===Pe)return{state:"unavailable",error:new Error(`Document ${e} is unavailable`),handle:f};if(f.state===ur)return{state:"failed",error:new Error(`Document ${e} was deleted`),handle:f};if(f.state===st)return{state:"ready",handle:i?f.view(i):f}}const a=h(this,kt)[o];if(a){const f=h(this,we)[o];if(f&&(f.state===st||f.state===Pe||f.state===ur||f.state==="loading"))return a}const c=V(this,ce,Ct).call(this,{documentId:o}),d={state:"loading",progress:0,handle:c},l={subscribers:new Set,currentProgress:void 0,notify:f=>{l.currentProgress=f,l.subscribers.forEach(u=>u(f)),h(this,kt)[o]=f},peek:()=>l.currentProgress||d,subscribe:f=>(l.subscribers.add(f),()=>l.subscribers.delete(f))};l.notify(d),V(this,ce,Xi).call(this,e,o,c,l,s?ji(new Promise(()=>{}),s):new Promise(()=>{}));const g={...d,peek:l.peek,subscribe:l.subscribe};return h(this,kt)[o]=g,g}async find(e,r={}){const{allowableStates:s=["ready"],signal:o}=r;if(o!=null&&o.aborted)throw new Error("Operation aborted");const i=this.findWithProgress(e,{signal:o});if("subscribe"in i)return V(this,ce,Ln).call(this,i.handle),new Promise((a,c)=>{const d=i.subscribe(l=>{s.includes(l.handle.state)?(d(),a(l.handle)):l.state==="unavailable"?(d(),c(new Error(`Document ${e} is unavailable`))):l.state==="failed"&&(d(),c(l.error))})});if(i.handle.state===st)return i.handle;if(await i.handle.whenReady([st,Pe]),i.handle.state==="unavailable"&&!s.includes(Pe))throw new Error(`Document ${e} is unavailable`);return i.handle}async findClassic(e,r={}){const s=tr(e),{allowableStates:o,signal:i}=r;return ji((async()=>{const a=await V(this,ce,ea).call(this,s);if(!o&&(await a.whenReady([st,Pe]),a.state===Pe&&!(i!=null&&i.aborted)))throw new Error(`Document ${e} is unavailable`);return a})(),i)}delete(e){const r=tr(e);V(this,ce,Ct).call(this,{documentId:r}).delete(),delete h(this,we)[r],delete h(this,kt)[r],this.emit("delete-document",{documentId:r})}async export(e){const r=tr(e),s=V(this,ce,Ct).call(this,{documentId:r}).doc();return Ks(s)}import(e){const r=Pa(e),s=this.create();return s.update(()=>Nn(r)),s}async flush(e){if(!this.storageSubsystem)return;const r=e?e.map(s=>h(this,we)[s]):Object.values(h(this,we));await Promise.all(r.map(async s=>this.storageSubsystem.saveDoc(s.documentId,s.doc())))}async removeFromCache(e){if(!h(this,we)[e]){h(this,Te).call(this,`WARN: removeFromCache called but handle not found in handleCache for documentId: ${e}`);return}const r=V(this,ce,Ct).call(this,{documentId:e});await r.whenReady([st,Gh,ur,Pe]),r.doc()?(r.isReady()?r.unload():h(this,Te).call(this,`WARN: removeFromCache called but handle for documentId: ${e} in unexpected state: ${r.state}`),delete h(this,we)[e],delete h(this,kt)[e],this.synchronizer.removeDocument(e)):h(this,Te).call(this,`WARN: removeFromCache called but doc undefined for documentId: ${e}`)}shutdown(){return this.networkSubsystem.adapters.forEach(e=>{e.disconnect()}),this.flush()}metrics(){return{documents:this.synchronizer.metrics()}}}Te=new WeakMap,un=new WeakMap,Nt=new WeakMap,we=new WeakMap,Me=new WeakMap,Ye=new WeakMap,kt=new WeakMap,ce=new WeakSet,Ln=function(e){this.storageSubsystem&&(e.listeners("heads-changed").some(r=>r===h(this,Nt))||e.on("heads-changed",h(this,Nt))),this.synchronizer.addDocument(e)},Qi=function(e){switch(e.type){case"remote-subscription-change":h(this,Ye)&&h(this,Me).handleControlMessage(e);break;case"remote-heads-changed":h(this,Ye)&&h(this,Me).handleRemoteHeads(e);break;case"sync":case"request":case"ephemeral":case"doc-unavailable":this.synchronizer.receiveMessage(e).catch(r=>{console.log("error receiving message",{err:r,message:e})})}},Un=new WeakMap,Zi=function(e){if(!this.storageSubsystem)return;const{storageId:r,isEphemeral:s}=this.peerMetadataByPeerId[e.peerId]||{};if(!r||s)return;let o=h(this,Un)[r];o||(o=h(this,Un)[r]=_s(({documentId:i,syncState:a})=>{this.storageSubsystem.saveSyncState(i,r,a)},h(this,un))),o(e)},Ct=function({documentId:e}){if(h(this,we)[e])return h(this,we)[e];if(!e)throw new Error(`Invalid documentId ${e}`);const r=new ws(e);return h(this,we)[e]=r,r},Xi=async function(e,r,s,o,i){try{o.notify({state:"loading",progress:25,handle:s});const a=await(this.storageSubsystem?this.storageSubsystem.loadDoc(s.documentId):Promise.resolve(null)),c=await Promise.race([a,i]);if(c?(s.update(()=>c),s.doneLoading(),o.notify({state:"loading",progress:50,handle:s})):(await Promise.race([this.networkSubsystem.whenReady(),i]),s.request(),o.notify({state:"loading",progress:75,handle:s})),V(this,ce,Ln).call(this,s),await Promise.race([s.whenReady([st,Pe]),i]),s.state===Pe){const d={state:"unavailable",handle:s};o.notify(d);return}if(s.state===ur)throw new Error(`Document ${e} was deleted`);o.notify({state:"ready",handle:s})}catch(a){o.notify({state:"failed",error:a instanceof Error?a:new Error(String(a)),handle:V(this,ce,Ct).call(this,{documentId:r})})}},ea=async function(e){if(h(this,we)[e])return h(this,we)[e];const r=V(this,ce,Ct).call(this,{documentId:e}),s=await(this.storageSubsystem?this.storageSubsystem.loadDoc(r.documentId):Promise.resolve(null));return s?(r.update(()=>s),r.doneLoading()):(await this.networkSubsystem.whenReady(),r.request()),V(this,ce,Ln).call(this,r),r};class mu extends jt{constructor(){super(...arguments);Z(this,"peerId");Z(this,"peerMetadata")}}class wu{constructor(t="automerge",e="documents"){Z(this,"database");Z(this,"store");Z(this,"dbPromise");this.database=t,this.store=e,this.dbPromise=this.createDatabasePromise()}createDatabasePromise(){return new Promise((t,e)=>{const r=indexedDB.open(this.database,1);r.onerror=()=>{e(r.error)},r.onupgradeneeded=s=>{s.target.result.createObjectStore(this.store)},r.onsuccess=s=>{const o=s.target.result;t(o)}})}async load(t){const e=(await this.dbPromise).transaction(this.store),r=e.objectStore(this.store).get(t);return new Promise((s,o)=>{e.onerror=()=>{o(r.error)},r.onsuccess=i=>{const a=i.target.result;a&&typeof a=="object"&&"binary"in a?s(a.binary):s(void 0)}})}async save(t,e){const r=(await this.dbPromise).transaction(this.store,"readwrite");return r.objectStore(this.store).put({key:t,binary:e},t),new Promise((s,o)=>{r.onerror=()=>{o(r.error)},r.oncomplete=()=>{s()}})}async remove(t){const e=(await this.dbPromise).transaction(this.store,"readwrite");return e.objectStore(this.store).delete(t),new Promise((r,s)=>{e.onerror=()=>{s(e.error)},e.oncomplete=()=>{r()}})}async loadRange(t){const e=await this.dbPromise,r=t,s=[...t,"\uFFFF"],o=IDBKeyRange.bound(r,s),i=e.transaction(this.store),a=i.objectStore(this.store).openCursor(o),c=[];return new Promise((d,l)=>{i.onerror=()=>{l(a.error)},a.onsuccess=g=>{const f=g.target.result;f?(c.push({data:f.value.binary,key:f.key}),f.continue()):d(c)}})}async removeRange(t){const e=await this.dbPromise,r=t,s=[...t,"\uFFFF"],o=IDBKeyRange.bound(r,s),i=e.transaction(this.store,"readwrite");return i.objectStore(this.store).delete(o),new Promise((a,c)=>{i.onerror=()=>{c(i.error)},i.oncomplete=()=>{a()}})}}var tn=null;typeof WebSocket<"u"?tn=WebSocket:typeof MozWebSocket<"u"?tn=MozWebSocket:typeof global<"u"?tn=global.WebSocket||global.MozWebSocket:typeof window<"u"?tn=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(tn=self.WebSocket||self.MozWebSocket);const xs=tn,_u=n=>n.type==="peer",vu=n=>n.type==="error",xu="1";function bt(n,t="Assertion failed"){if(n===!1||n===null||n===void 0){const e=new Error(Su(t));throw e.stack=Iu(e.stack,"assert.ts"),e}}const Su=n=>n.split(`
`).map(t=>t.trim()).join(`
`),Iu=(n="",t)=>n.split(`
`).filter(e=>!e.includes(t)).join(`
`),Au=n=>{const{buffer:t,byteOffset:e,byteLength:r}=n;return t.slice(e,e+r)};class Eu extends mu{constructor(){super(...arguments);Z(this,"socket")}}class ku extends Eu{constructor(e,r=5e3){super();z(this,Dn);Z(this,"url");Z(this,"retryInterval");z(this,dn,!1);z(this,Pn);z(this,yr,new Promise(e=>{te(this,Pn,e)}));z(this,wt);z(this,je,lt("automerge-repo:websocket:browser"));Z(this,"remotePeerId");Z(this,"onOpen",()=>{h(this,je).call(this,"open"),clearInterval(h(this,wt)),te(this,wt,void 0),this.join()});Z(this,"onClose",()=>{h(this,je).call(this,"close"),this.remotePeerId&&this.emit("peer-disconnected",{peerId:this.remotePeerId}),this.retryInterval>0&&!h(this,wt)&&setTimeout(()=>(bt(this.peerId),this.connect(this.peerId,this.peerMetadata)),this.retryInterval)});Z(this,"onMessage",e=>{this.receiveMessage(e.data)});Z(this,"onError",e=>{if("error"in e&&e.error.code!=="ECONNREFUSED")throw e.error;h(this,je).call(this,"Connection failed, retrying...")});this.url=e,this.retryInterval=r,te(this,je,h(this,je).extend(e))}isReady(){return h(this,dn)}whenReady(){return h(this,yr)}connect(e,r){!this.socket||!this.peerId?(h(this,je).call(this,"connecting"),this.peerId=e,this.peerMetadata=r??{}):(h(this,je).call(this,"reconnecting"),bt(e===this.peerId),this.socket.removeEventListener("open",this.onOpen),this.socket.removeEventListener("close",this.onClose),this.socket.removeEventListener("message",this.onMessage),this.socket.removeEventListener("error",this.onError)),h(this,wt)||te(this,wt,setInterval(()=>{this.connect(e,r)},this.retryInterval)),this.socket=new xs(this.url),this.socket.binaryType="arraybuffer",this.socket.addEventListener("open",this.onOpen),this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("message",this.onMessage),this.socket.addEventListener("error",this.onError),setTimeout(()=>V(this,Dn,Rs).call(this),1e3),this.join()}join(){bt(this.peerId),bt(this.socket),this.socket.readyState===xs.OPEN&&this.send(Cu(this.peerId,this.peerMetadata))}disconnect(){bt(this.peerId),bt(this.socket);const e=this.socket;e&&(e.removeEventListener("open",this.onOpen),e.removeEventListener("close",this.onClose),e.removeEventListener("message",this.onMessage),e.removeEventListener("error",this.onError),e.close()),clearInterval(h(this,wt)),this.remotePeerId&&this.emit("peer-disconnected",{peerId:this.remotePeerId}),this.socket=void 0}send(e){var s;if("data"in e&&((s=e.data)==null?void 0:s.byteLength)===0)throw new Error("Tried to send a zero-length message");if(bt(this.peerId),!this.socket){h(this,je).call(this,"Tried to send on a disconnected socket.");return}if(this.socket.readyState!==xs.OPEN)throw new Error(`Websocket not ready (${this.socket.readyState})`);const r=xi(e);this.socket.send(Au(r))}peerCandidate(e,r){bt(this.socket),V(this,Dn,Rs).call(this),this.remotePeerId=e,this.emit("peer-candidate",{peerId:e,peerMetadata:r})}receiveMessage(e){let r;try{r=Vh(new Uint8Array(e))}catch(s){h(this,je).call(this,"error decoding message:",s);return}if(bt(this.socket),e.byteLength===0)throw new Error("received a zero-length message");if(_u(r)){const{peerMetadata:s}=r;h(this,je).call(this,`peer: ${r.senderId}`),this.peerCandidate(r.senderId,s)}else vu(r)?h(this,je).call(this,`error: ${r.message}`):this.emit("message",r)}}dn=new WeakMap,Pn=new WeakMap,yr=new WeakMap,Dn=new WeakSet,Rs=function(){var e;h(this,dn)||(te(this,dn,!0),(e=h(this,Pn))==null||e.call(this))},wt=new WeakMap,je=new WeakMap;function Cu(n,t){return{type:"join",senderId:n,peerMetadata:t,supportedProtocolVersions:[xu]}}lt("WebsocketServer"),await Ea(re);const Ri=document.getElementById("status"),Ou=document.getElementById("document"),Hu=document.getElementById("updateButton"),Ui=new bu({storage:new wu,network:[new ku("ws://localhost:1323/ws")],sharePolicy:async(n,t)=>!0}),ju="automerge:9k54321Abcde",Ss=Ui.find(ju);Ri.textContent="Repo initialized. Waiting for document...",Ss.on("change",({doc:n})=>{console.log("Document changed:",n),Ou.textContent=JSON.stringify(n,null,2),Ri.textContent=`Connected. Last change: ${new Date().toLocaleTimeString()}`}),Hu.addEventListener("click",()=>{if(!Ss.isReady()){alert("Document not ready yet. Please wait.");return}Ss.change(n=>{n.timestamp=new Date().toISOString(),n.counter=(n.counter||0)+1,console.log("Making a change...")})}),console.log("Automerge Repo setup complete.",Ui)})();export{Du as __tla};
